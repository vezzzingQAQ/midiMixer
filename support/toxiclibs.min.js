/*!
* toxiclibsjs - v0.3.3
* http://haptic-data.com/toxiclibsjs
* Created by [Kyle Phillips](http://haptic-data.com),
* based on original work by [Karsten Schmidt](http://toxiclibs.org).
* Licensed [GPLv2](http://www.gnu.org/licenses/lgpl-2.1.html) 
*/
!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;(g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).toxi=f()}}((function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,(function(e){var n=t[o][1][e];return s(n||e)}),l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){module.exports={ToxiclibsSupport:require("./THREE/ToxiclibsSupport")}},{"./THREE/ToxiclibsSupport":2}],2:[function(require,module,exports){var is=require("../internals/is"),ToxiclibsSupport=function(scene){if(void 0===THREE)throw new Error("THREE.js has not been loaded");this.scene=scene,this.objectDictionary={}};ToxiclibsSupport.createLineGeometry=function(line3d,geometry){return ToxiclibsSupport.createMeshGeometry({vertices:[line3d.a,line3d.b]},geometry)},ToxiclibsSupport.createMeshGeometry=function createMeshGeometry(obj,geometry){geometry=geometry||new THREE.Geometry;var idIndexMap={},v,i,f,len,vertices;if(len=(vertices=is.Array(obj)?obj:obj.vertices).length,!vertices)throw new Error("no vertices found");for(i=0;i<len;i++)v=vertices[i],geometry.vertices[i]=new THREE.Vector3(v.x,v.y,v.z),idIndexMap[v.id]=i;if(obj.faces)for(len=obj.faces.length,i=0;i<len;i++)f=obj.faces[i],geometry.faces[i]=new THREE.Face3(idIndexMap[f.a.id],idIndexMap[f.b.id],idIndexMap[f.c.id],new THREE.Vector3(f.normal.x,f.normal.y,f.normal.z));return geometry.computeCentroids(),geometry.computeVertexNormals(),geometry},ToxiclibsSupport.createMesh=function(triangleMesh,material){void 0===material&&(material=new THREE.MeshBasicMaterial);var geometry=ToxiclibsSupport.createMeshGeometry(triangleMesh);return new THREE.Mesh(geometry,material)},ToxiclibsSupport.createParticle=function(position,materials){var particle=new THREE.Particle(materials);return particle.position.x=position.x,particle.position.y=position.y,particle.position.z=position.z,particle},ToxiclibsSupport.prototype={addLine:function(line3d,material){void 0===material&&(material=new THREE.LineBasicMaterial);var geom=ToxiclibsSupport.createLineGeometry(line3d),line=new THREE.Line(geom,material);return this.scene.add(line),line},addMesh:function(obj_or_mesh,threeMaterials){var toxiTriangleMesh;1==arguments.length?(toxiTriangleMesh=obj_or_mesh.geometry,threeMaterials=obj_or_mesh.materials):toxiTriangleMesh=obj_or_mesh;var threeMesh=this.createMesh(toxiTriangleMesh,threeMaterials);return this.scene.add(threeMesh),threeMesh},addParticles:function(positions,material){void 0===material&&(material=new THREE.ParticleBasicMaterial),positions=is.Array(positions)?positions:[positions];for(var particle=new THREE.Geometry,pos,i=0,len=positions.length;i<len;i++)pos=positions[i],particle.vertices[i]=new THREE.Vector3(pos.x,pos.y,pos.z);var particleSystem=new THREE.ParticleSystem(particle,material);return this.scene.add(particleSystem),particle},createMeshGeometry:function(triangleMesh){return ToxiclibsSupport.createMeshGeometry(triangleMesh)},createMesh:function(triangleMesh,material){return ToxiclibsSupport.createMesh(triangleMesh,material)}},module.exports=ToxiclibsSupport},{"../internals/is":106}],3:[function(require,module,exports){exports.accessCriteria=require("./color/accessCriteria"),exports.AccessCriteria=exports.accessCriteria,exports.AlphaAccessor=require("./color/AlphaAccessor"),exports.CMYKAccessor=require("./color/CMYKAccessor"),exports.CMYKDDistanceProxy=require("./color/CMYKDistanceProxy"),exports.ColorGradient=require("./color/ColorGradient"),exports.ColorList=require("./color/ColorList"),exports.ColorRange=require("./color/ColorRange"),exports.ColorTheme=require("./color/ColorTheme"),exports.createListUsingStrategy=require("./color/createListUsingStrategy"),exports.HistEntry=require("./color/HistEntry"),exports.Histogram=require("./color/Histogram"),exports.HSVAccessor=require("./color/HSVAccessor"),exports.HSVDistanceProxy=require("./color/HSVDistanceProxy"),exports.Hue=require("./color/Hue"),exports.LuminanceAccessor=require("./color/LuminanceAccessor"),exports.namedColor=require("./color/namedColor"),exports.NamedColor=exports.namedColor,exports.ProximityComparator=require("./color/ProximityComparator"),exports.RGBAccessor=require("./color/RGBAccessor"),exports.RGBDistanceProxy=require("./color/RGBDistanceProxy"),exports.TColor=require("./color/TColor"),exports.theory=require("./color/theory"),exports.ToneMap=require("./color/ToneMap")},{"./color/AlphaAccessor":4,"./color/CMYKAccessor":5,"./color/CMYKDistanceProxy":6,"./color/ColorGradient":7,"./color/ColorList":8,"./color/ColorRange":9,"./color/ColorTheme":10,"./color/HSVAccessor":11,"./color/HSVDistanceProxy":12,"./color/HistEntry":13,"./color/Histogram":14,"./color/Hue":15,"./color/LuminanceAccessor":16,"./color/ProximityComparator":17,"./color/RGBAccessor":18,"./color/RGBDistanceProxy":19,"./color/TColor":20,"./color/ToneMap":21,"./color/accessCriteria":22,"./color/createListUsingStrategy":24,"./color/namedColor":26,"./color/theory":27}],4:[function(require,module,exports){module.exports=require("./accessors").AlphaAccessor},{"./accessors":23}],5:[function(require,module,exports){module.exports=require("./accessors").CMYKAccessor},{"./accessors":23}],6:[function(require,module,exports){module.exports=require("./distanceProxies").CMYKDistanceProxy},{"./distanceProxies":25}],7:[function(require,module,exports){var filter=require("../internals").filter,numberComparator=require("../internals").numberComparator,mathUtils=require("../math/mathUtils"),LinearInterpolation=require("../math/LinearInterpolation"),ColorList=require("./ColorList"),_GradPoint=function(p,c){this.pos=p,this.color=c};_GradPoint.prototype={compareTo:function(p){return 0===numberComparator(p.pos,this.pos)?0:this.pos<p.pos?-1:1},getColor:function(){return this.color},getPosition:function(){return this.pos}};var ColorGradient=function(){this.gradient=[],this.interpolator=new LinearInterpolation,this.maxDither=0};ColorGradient.prototype={addColorAt:function(p,c){this.gradient.push(new _GradPoint(p,c))},calcGradient:function(pos,width){if(0===arguments.length){pos=this.gradient[0].getPosition();var last=this.gradient[this.gradient.length-1].getPosition();width=Math.floor(last-pos)}var result=new ColorList;if(0===this.gradient.length)return result;var frac=0,currPoint,nextPoint,endPos=pos+width,i=0,l=this.gradient.length;for(i=0;i<l;i++)this.gradient[i].pos<pos&&(currPoint=this.gradient[i]);var isPremature=void 0===currPoint,activeGradient;isPremature?(activeGradient=this.gradient,currPoint=this.gradient[0]):activeGradient=filter(this.gradient,(function(g){return g.pos>=currPoint.pos}));var currWidth=0;if(i=0,l=activeGradient.length,currPoint!==activeGradient[l-1])if(nextPoint=activeGradient[i],isPremature){var d=currPoint.pos-pos;currWidth=mathUtils.abs(d)>0?1/d:1}else nextPoint.pos-currPoint.pos>0&&(currWidth=1/(nextPoint.pos-currPoint.pos));for(;pos<endPos;){if((frac=isPremature?1-(currPoint.pos-pos)*currWidth:(pos-currPoint.pos)*currWidth)>1&&(currPoint=nextPoint,isPremature=!1,++i<activeGradient.length&&(nextPoint=activeGradient[i],currWidth=currPoint!==activeGradient[l-1]?1/(nextPoint.pos-currPoint.pos):0,frac=(pos-currPoint.pos)*currWidth)),currPoint!==activeGradient[l-1]){var ditheredFrac=mathUtils.clip(frac+mathUtils.normalizedRandom()*this.maxDither,0,1);ditheredFrac=this.interpolator.interpolate(0,1,ditheredFrac),result.add(currPoint.color.getBlended(nextPoint.color,ditheredFrac))}else result.add(currPoint.color.copy());pos++}return result},getGradientPoints:function(){return this.gradient},getInterpolator:function(){return this.interpolator},getMaxDither:function(){return this.maxDither},setInterpolator:function(interpolator){this.interpolator=interpolator},setMaxDither:function(maxDither){this.maxDither=mathUtils.clip(maxDither,0,1)}},module.exports=ColorGradient},{"../internals":98,"../math/LinearInterpolation":119,"../math/mathUtils":125,"./ColorList":8}],8:[function(require,module,exports){var is=require("../internals/is"),each=require("../internals/each"),Iterator=require("../internals/Iterator"),mathUtils=require("../math/mathUtils"),TColor=require("./TColor"),HSVDistanceProxy=require("./HSVDistanceProxy"),RGBDistanceProxy=require("./RGBDistanceProxy"),ProximityComparator=require("./ProximityComparator"),AccessCriteria=require("./accessCriteria"),ColorList=function(colors){if(arguments.length>1)return ColorList.call(this,arguments);this.colors=[];var i=0;if(is.Array(colors)&&colors.length)if("number"==typeof colors[0])for(i=0,l=colors.length;i<l;i++)this.colors.push(TColor.newARGB(colors[i]));else this.addAll(colors);else if(is.ColorList(colors))for(i=0,l=colors.size();i<l;i++)this.add(colors.get(i));else is.TColor(colors)&&this.add(colors)};ColorList.prototype={constructor:ColorList,add:function(c){return this.colors.push(c.copy()),this},addAll:function(collection){var self=this;return is.Array(collection)?each(collection,(function(color){self.colors.push(color)})):this.colors.push(collection),this},adjustBrightness:function(step){return each(this.colors,(function(c){c.lighten(step)})),this},adjustSaturation:function(step){return each(this.colors,(function(c){c.saturate(step)})),this},clusterSort:function(clusterCriteria,subClusterCriteria,numClusters,isReversed){var sorted=this.colors.slice(0),clusters=[],d=1,i=0,num=sorted.length,slice;sorted.sort(clusterCriteria.compare).reverse();for(var j=0;j<num;j++){var c;sorted[j].getComponentValue(clusterCriteria)<d&&((slice=sorted.slice(i,j)).sort(subClusterCriteria.compare),clusters.push.apply(clusters,slice),d-=1/numClusters,i=j)}return slice=[],Array.prototype.push.apply(slice,sorted.slice(i,sorted.length)),slice.sort(subClusterCriteria.compare),clusters.push.apply(clusters,slice),isReversed&&clusters.reverse(),this.colors=clusters,this},complement:function(){return this.each((function(c){c.complement()})),this},contains:function(color){for(var i=0,l=this.colors.length;i<l;i++)if(this.colors[i].equals(color))return!0;return!1},each:function(fn){return each(this.colors,fn),this},get:function(i){return i<0&&(i+=this.colors.length),this.colors[i]},getAverage:function(){var r=0,g=0,b=0,a=0;this.each((function(c){r+=c.rgb[0],g+=c.rgb[1],b+=c.rgb[2],a+=c.alpha()}));var num=this.colors.length;if(num>0)return TColor.newRGBA(r/num,g/num,b/num,a/num)},getBlended:function(amount){for(var clrs=[],len=this.colors.length,i=0;i<len;i++){var index=i>0?i-1:clrs.length-1,c=this.colors[index];clrs.push(this.colors[i].getBlended(c,amount))}return new ColorList(clrs)},getDarkest:function(){var darkest,minBrightness=Number.MAX_VALUE;return this.each((function(c){var luma=c.luminance();luma<minBrightness&&(darkest=c,minBrightness=luma)})),darkest},getLightest:function(){var lightest,maxBrightness=Number.MIN_VALUE;return this.each((function(c){var luma=c.luminance();luma>maxBrightness&&(lightest=c,maxBrightness=luma)})),lightest},getRandom:function(){var index=Math.floor(mathUtils.random(this.colors.length));return this.colors[index]},getReverse:function(){return new ColorList(this.colors).reverse()},invert:function(){return this.each((function(c){c.invert()})),this},iterator:function(){return new Iterator(this.colors)},reverse:function(){return this.colors.reverse(),this},rotateRYB:function(theta,isRadians){var angle;return angle=theta!==Math.floor(theta)||isRadians?mathUtils.degrees(theta):theta,this.each((function(c){c.rotateRYB(angle)})),this},size:function(){return this.colors.length},sort:function(){return this.sortByCriteria(AccessCriteria.HUE,!1)},sortByComparator:function(comp,isReversed){return"function"==typeof comp&&void 0===comp.compare&&(comp={compare:comp}),this.colors.sort(comp.compare),isReversed&&this.colors.reverse(),this},sortByCriteria:function(criteria,isReversed){return this.sortByComparator(criteria,isReversed)},sortByDistance:function(proxy,isReversed){if(1===arguments.length&&(isReversed=arguments[0],proxy=new HSVDistanceProxy),0===this.colors.length)return this;var root=this.getDarkest(),stack=this.colors.slice(0),sorted=[];stack.splice(stack.indexOf(root),1),sorted.push(root);for(var sortedCount=0;stack.length>1;){for(var closest=stack[0],lastSorted=sorted[sortedCount],distance=proxy.distanceBetween(closest,lastSorted),i=stack.length-1;i>=0;i--){var c=stack[i],d=proxy.distanceBetween(c,lastSorted);d<distance&&(closest=c,distance=d)}stack.splice(stack.indexOf(closest),1),sorted.push(closest),sortedCount++}return sorted.push(stack[0]),isReversed&&sorted.reverse(),this.colors=sorted,this},sortByProximityTo:function(target,proxy,isReversed){return 2==arguments.length&&(target=arguments[0],proxy=new RGBDistanceProxy,isReversed=arguments[1]),this.sortByComparator(new ProximityComparator(target,proxy),isReversed)},toARGBArray:function(){var array=[];return this.each((function(c){array.push(c.toARGB())})),array}},ColorList.createFromARGBArray=function(pixels,num,uniqueOnly,maxIterations){if(maxIterations=maxIterations||100,num=mathUtils.min(num,pixels.length),!uniqueOnly&&num==pixels.length)return new ColorList(pixels);var colors=[],temp=TColor.BLACK.copy(),i=0,isUnique=!0,numTries=0,idx;for(i=0;i<num;i++)if(uniqueOnly){isUnique=!0,numTries=0;do{idx=mathUtils.random(pixels.length),temp.setARGB(pixels[idx]),isUnique=!(colors.indexOf(temp)>=0)}while(!isUnique&&++numTries<maxIterations);if(!(numTries<maxIterations))break;colors.push(temp.copy())}else idx=mathUtils.random(pixels.length),colors.push(TColor.newARGB(pixels[idx]));return new ColorList(colors)},ColorList.createUsingStrategy=function(){throw new Error("Not allowed, use toxi/color/createListUsingStrategy instead")},module.exports=ColorList},{"../internals/Iterator":99,"../internals/each":102,"../internals/is":106,"../math/mathUtils":125,"./HSVDistanceProxy":12,"./ProximityComparator":17,"./RGBDistanceProxy":19,"./TColor":20,"./accessCriteria":22}],9:[function(require,module,exports){var TColor=require("./TColor"),ColorList=require("./ColorList"),FloatRange=require("../util/datatypes/FloatRange"),is=require("../internals/is"),each=require("../internals/each"),MathUtils=require("../math/mathUtils"),ColorRange,UNTITLED_ID=1,addRange,addAll,pickRandom,FR,un;addAll=function(arr,elementsArr){arr.push.apply(arr,elementsArr)},pickRandom=function(arr){return arr[Math.floor(Math.random()*arr.length)]},(ColorRange=function(hue,sat,bri,alpha,black,white,name){var self=this,list;if(0===arguments.length)return this;is.ColorList(hue)&&(hue=(list=hue).get(0)),is.Hue(hue)&&(hue=new FloatRange(hue.getHue(),hue.getHue())),is.TColor(hue)&&(hue=new FloatRange(hue.hue(),hue.hue())),this.hueConstraint=[is.FloatRange(hue)?hue:new FloatRange(0,1)],this.saturationConstraint=[is.FloatRange(sat)?sat:new FloatRange(0,1)],this.brightnessConstraint=[is.FloatRange(bri)?bri:new FloatRange(0,1)],this.alphaConstraint=[is.FloatRange(alpha)?alpha:new FloatRange(1,1)],this.black=is.FloatRange(black)?black:new FloatRange(0,1),this.white=is.FloatRange(white)?white:new FloatRange(0,1),list&&(this.hueConstraint=[],list.each((function(c){self.add(c)})));for(var i=arguments.length-1;i>=0;i--)if("string"==typeof arguments[i]){this.name=arguments[i];break}this.name||(this.name="untitled"+UNTITLED_ID++)}).prototype={constructor:ColorRange,add:function(rc){return is.ColorRange(rc)?(addAll(this.hueConstraint,rc.hueConstraint),addAll(this.saturationConstraint,rc.saturationConstraint),addAll(this.brightnessConstraint,rc.brightnessConstraint),addAll(this.alphaConstraint,rc.alphaConstraint),this.black.min=Math.min(this.black.min,rc.black.min),this.black.max=Math.max(this.black.max,rc.black.max),this.white.min=Math.min(this.white.min,rc.white.min),this.white.max=Math.max(this.white.max,rc.white.max)):(this.hueConstraint.push(new FloatRange(rc.hue(),rc.hue())),this.saturationConstraint.push(new FloatRange(rc.saturation(),rc.saturation())),this.brightnessConstraint.push(new FloatRange(rc.brightness(),rc.brightness())),this.alphaConstraint.push(new FloatRange(rc.alpha(),rc.alpha()))),this},addAlphaRange:(addRange=function(attr){return function(min,max){return this[attr.toLowerCase()+"Constraint"].push(is.FloatRange(min)?min:new FloatRange(min,max)),this}})("alpha"),addBrightnessRange:addRange("brightness"),addHue:function(hue){return this.hueConstraint.push(new FloatRange(hue.getHue(),hue.getHue())),this},addHueRange:addRange("hue"),addSaturationRange:addRange("saturation"),contains:function(c){var isInRange=this.isValueInConstraint(c.hue(),this.hueConstraint);return isInRange&=this.isValueInConstraint(c.saturation(),this.saturationConstraint),isInRange&=this.isValueInConstraint(c.brightness(),this.brightnessConstraint),(isInRange&=this.isValueInConstraint(c.alpha(),this.alphaConstraint))||!1},copy:function(c,variance){variance="number"==typeof variance?variance:0;var range=new ColorRange;if(range.name=this.name,c){var hue=c.hue()+variance*MathUtils.normalizedRandom();range.hueConstraint=[new FloatRange(hue,hue)],range.alphaConstraint=[new FloatRange(c.alpha(),c.alpha())]}else range.hueConstraint=[].concat(this.hueConstraint),range.alphaConstraint=[].concat(this.alphaConstraint);return range.saturationConstraint=[].concat(this.saturationConstraint),range.brightnessConstraint=[].concat(this.brightnessConstraint),range.black=this.black.copy(),range.white=this.white.copy(),range},getColor:function(hue_c,variance){if(is.Hue(hue_c))return TColor.newHSVA(hue_c.getHue(),pickRandom(this.saturationConstraint).pickRandom(),pickRandom(this.brightnessConstraint).pickRandom(),pickRandom(this.alphaConstraint).pickRandom());var c=hue_c,h,s,b,a;if(c){if(c.isBlack())return TColor.newHSVA(c.hue(),0,this.black.pickRandom(),c.alpha());if(c.isWhite())return TColor.newHSVA(c.hue(),0,this.white.pickRandom(),c.alpha());if(c.isGrey())return TColor.newHSVA(c.hue(),0,MathUtils.flipCoin()?this.black.pickRandom():this.white.pickRandom(),c.alpha());h=c.hue()+variance*MathUtils.normalizedRandom(),a=c.alpha()}else h=pickRandom(this.hueConstraint).pickRandom(),a=pickRandom(this.alphaConstraint).pickRandom();return s=pickRandom(this.saturationConstraint).pickRandom(),b=pickRandom(this.brightnessConstraint).pickRandom(),TColor.newHSVA(h,s,b,a)},getColors:function(c,num,variance){arguments.length<3&&(variance=ColorRange.DEFAULT_VARIANCE),1===arguments.length&&(num=c,c=void 0);for(var list=new ColorList,i=0;i<num;i++)list.add(this.getColor(c,variance));return list},getGrayscale:function(brightness,variance){return this.getColor(TColor.newGray(brightness),variance)},getName:function(){return this.name},getSum:function(range){return this.copy().add(range)},isValueInConstraint:function(val,rangeSet){var isValid=!1;return each(rangeSet,(function(r){isValid|=r.isValueInRange(val)})),isValid}},ColorRange.DEFAULT_VARIANCE=.035,FR=FloatRange,un=void 0,ColorRange.PRESETS={},each({light:[un,new FR(.3,.7),new FR(.9,1),un,new FR(.15,.3),un],dark:[un,new FR(.7,1),new FR(.15,.4),un,un,new FR(.5,.75)],bright:[un,new FR(.8,1),new FR(.8,1)],weak:[un,new FR(.15,.3),new FR(.7,1),un,new FR(.2,.2),un],neutral:[un,new FR(.25,.35),new FR(.3,.7),un,new FR(.15,.15),new FR(.9,1)],fresh:[un,new FR(.4,.8),new FR(.8,1),un,new FR(.05,.3),new FR(.8,1)],soft:[un,new FR(.2,.3),new FR(.6,.9),un,new FR(.05,.15),new FR(.6,.9)],hard:[un,new FR(.9,1),new FR(.4,1)],warm:[un,new FR(.6,.9),new FR(.4,.9),un,new FR(.2,.2),new FR(.8,1)],cool:[un,new FR(.05,.2),new FR(.9,1),un,un,new FR(.95,1)],intense:[un,new FR(.9,1),new FR(.2,.35)]},(function(args,name){args.push(name);var nameUC=name.toUpperCase();ColorRange[nameUC]=new ColorRange,ColorRange.apply(ColorRange[nameUC],args),ColorRange.PRESETS[nameUC]=ColorRange[nameUC]})),ColorRange.INTENSE.addBrightnessRange(new FR(.8,1)),ColorRange.getPresetForName=function(name){return ColorRange.PRESETS[name.toUpperCase()]},module.exports=ColorRange},{"../internals/each":102,"../internals/is":106,"../math/mathUtils":125,"../util/datatypes/FloatRange":165,"./ColorList":8,"./TColor":20}],10:[function(require,module,exports){var each=require("../internals/each"),MathUtils=require("../math/mathUtils"),ColorRange=require("./ColorRange"),NamedColor=require("./namedColor"),ColorList=require("./ColorList"),ColorTheme,_ThemePart;(_ThemePart=function(range,color,weight){this.range=range,this.color=color,this.weight=weight}).prototype.getColor=function(){return this.range.getColor(this.color,ColorRange.DEFAULT_VARIANCE)},(ColorTheme=function(name){this.name=name,this.parts=[],this._weightedSum=0}).prototype={constructor:ColorTheme,addRange:function(range_or_descriptor,color_or_weight,weight){var self=this,_range,_col;return 3===arguments.length?(this.parts.push(new _ThemePart(range_or_descriptor,color_or_weight,weight)),this._weightedSum+=weight):(each(range_or_descriptor.split(" "),(function(item){ColorRange.getPresetForName(item)?_range=ColorRange.getPresetForName(item):NamedColor.getForName(item)&&(_col=NamedColor.getForName(item))})),_range&&self.addRange(_range,_col,color_or_weight)),this},getColor:function(){for(var self=this,rnd=Math.random(),t,currWeight,i=0,l=this.parts.length;i<l;i++){if((currWeight=(t=this.parts[i]).weight/this._weightedSum)>=rnd)return t.getColor();rnd-=currWeight}return null},getColors:function(num){for(var list=new ColorList,i=0;i<num;i++)list.add(this.getColor());return list},getName:function(){return this.name}},module.exports=ColorTheme},{"../internals/each":102,"../math/mathUtils":125,"./ColorList":8,"./ColorRange":9,"./namedColor":26}],11:[function(require,module,exports){module.exports=require("./accessors").HSVAccessor},{"./accessors":23}],12:[function(require,module,exports){module.exports=require("./distanceProxies").HSVDistanceProxy},{"./distanceProxies":25}],13:[function(require,module,exports){var HistEntry=function(c){this.col=c,this.freq=1};HistEntry.prototype={constructor:HistEntry,compareTo:function(entry){return parseInt(entry.freq-this.freq,10)},getColor:function(){return this.col},getFrequency:function(){return this.freq}},module.exports=HistEntry},{}],14:[function(require,module,exports){var each=require("../internals").each,Iterator=require("../internals").Iterator,HistEntry=require("./HistEntry"),ColorList=require("./ColorList"),Histogram=function(palette){this.palette=palette};Histogram.prototype={constructor:Histogram,compute:function(tolerance,blendCols){var self=this;this.entries=[];var maxFreq=1;return this.palette.each((function(c){var existing,e,i=0,l=self.entries.length;for(i=0;i<l;i++)if((e=self.entries[i]).col.distanceToRGB(c)<tolerance){blendCols&&e.col.blend(c,1/(e.freq+1)),existing=e;break}void 0!==existing?(existing.freq++,existing.freq>maxFreq&&(maxFreq=existing.freq)):self.entries.push(new HistEntry(c))})),this.entries.sort(),maxFreq=1/this.palette.size(),each(this.entries,(function(e){e.freq*=maxFreq})),this.entries},getEntries:function(){return this.entries},getPalette:function(){return this.palette},iterator:function(){return new Iterator(this.entries)},setPalette:function(palette){this.palette=palette}},Histogram.newFromARGBArray=function(pixels,numSamples,tolerance,blendCols){var h=new Histogram(ColorList.createFromARGBArray(pixels,numSamples,!1));return h.compute(tolerance,blendCols),h},module.exports=Histogram},{"../internals":98,"./ColorList":8,"./HistEntry":13}],15:[function(require,module,exports){var LinkedMap=require("../internals/LinkedMap"),each=require("../internals/each"),namedHues=new LinkedMap,primaryHues=[],Hue;(Hue=function(name,hue,isPrimary){this._isPrimary=!0===isPrimary,this.name=name,this.hue=hue,namedHues.put(name,this),this._isPrimary&&primaryHues.push(this)}).prototype={constructor:Hue,getHue:function(){return this.hue},getName:function(){return this.name},isPrimary:function(){return this._isPrimary},toString:function(){return"Hue: ID:"+this.name+" @ "+parseInt(360*this.hue,10)+" degrees"}},Hue.PRESETS={},each([["red",!0],["orange",!0],["yellow",!0],["lime"],["green",!0],["teal"],["cyan"],["azure"],["blue",!0],["indigo"],["purple",!0],["pink",!0]],(function(item,i){var name=item[0],nameUC=name.toUpperCase(),isPrimary=item[1];Hue[nameUC]=new Hue(name,30*i/360,isPrimary),Hue.PRESETS[nameUC]=Hue[nameUC]})),Hue.PRIMARY_VARIANCE=.01,Hue.getClosest=function(hue,primaryOnly){hue%=1,primaryOnly=!0===primaryOnly;var dist=Number.MAX_VALUE,closest,hues=primaryOnly?primaryHues:namedHues.getArray();return each(hues,(function(h){var d=Math.min(Math.abs(h.getHue()-hue),Math.abs(1+h.getHue()-hue));d<dist&&(dist=d,closest=h)})),closest},Hue.getForName=function(name){return namedHues.get(name)},Hue.isPrimary=function(hue,variance){variance="number"==typeof variance?variance:Hue.PRIMARY_VARIANCE;for(var isPrimary=!1,i=0,len=primaryHues.length;i<len;i++){var h=primaryHues[i];if(Math.abs(hue-h.getHue())<variance){isPrimary=!0;break}}return isPrimary},module.exports=Hue},{"../internals/LinkedMap":100,"../internals/each":102}],16:[function(require,module,exports){module.exports=require("./accessors").LuminanceAccessor},{"./accessors":23}],17:[function(require,module,exports){var ProximityComparator=function(col,proxy){this.col=col,this.proxy=proxy};ProximityComparator.prototype.compare=function(a,b){var da=this.proxy.distanceBetween(this.col,a),db=this.proxy.distanceBetween(this.col,b);return da<db?-1:da>db?1:0},module.exports=ProximityComparator},{}],18:[function(require,module,exports){module.exports=require("./accessors").RGBAccessor},{"./accessors":23}],19:[function(require,module,exports){module.exports=require("./distanceProxies").RGBDistanceProxy},{"./distanceProxies":25}],20:[function(require,module,exports){var numberComparator=require("../internals/numberComparator"),is=require("../internals/is"),mathUtils=require("../math/mathUtils"),vectors=require("../geom/vectors"),Vec2D=vectors.Vec2D,Vec3D=vectors.Vec3D,Hue=require("./Hue"),dec2hex=function decimalToHexString(number){return number<0&&(number=4294967295+number+1),number.toString(16)},TColor=function(tcolor){if(this.rgb=[],this.hsv=[],this.cmyk=[],this._alpha=1,void 0!==tcolor){var buffer=tcolor.toCMYKAArray();this.cmyk=buffer.splice(0,4),this.hsv=tcolor.toHSVAArray().splice(0,3),this.rgb=tcolor.toRGBAArray().splice(0,3),this._alpha=tcolor._alpha}};TColor.prototype={add:function(c){return this.copy().addSelf(c)},addSelf:function(c){return this.rgb[0]=mathUtils.min(this.rgb[0]+c.rgb[0],1),this.rgb[1]=mathUtils.min(this.rgb[1]+c.rgb[1],1),this.rgb[2]=mathUtils.min(this.rgb[2]+c.rgb[2],1),this.setRGB(this.rgb)},adjustConstrast:function(amount){return this.hsv[2]<.5?this.darken(amount):this.lighten(amount)},adjustHSV:function(h,s,v){return this.setHSV([this.hsv[0]+h,this.hsv[1]+s,this.hsv[2]+v])},adjustRGB:function(r,g,b){return this.setRGB([this.rgb[0]+r,this.rgb[1]+g,this.rgb[2]+b])},alpha:function(){return this._alpha},analog:function(theta,delta){var angle=mathUtils.degrees(theta);return this.rotateRYB(angle*mathUtils.normalizedRandom()),this.hsv[1]+=delta*mathUtils.normalizedRandom(),this.hsv[2]+=delta*mathUtils.normalizedRandom(),this.setHSV(this.hsv)},black:function(){return this.cmyk[3]},blend:function(c,t){void 0===t&&(t=.5);var crgb=c.toRGBAArray();return this.rgb[0]+=(crgb[0]-this.rgb[0])*t,this.rgb[1]+=(crgb[1]-this.rgb[1])*t,this.rgb[2]+=(crgb[2]-this.rgb[2])*t,this._alpha+=(c._alpha-this._alpha)*t,this.setRGB(this.rgb)},blue:function(){return this.rgb[2]},brightness:function(){return this.hsv[2]},complement:function(){return this.rotateRYB(180)},copy:function(){return new TColor(this)},cyan:function(){return this.cmyk[0]},darken:function(step){return this.hsv[2]=mathUtils.clip(this.hsv[2]-step,0,1),this.setHSV(this.hsv)},desaturate:function(step){return this.hsv[1]=mathUtils.clip(this.hsv[1]-step,0,1),this.setHSV(this.hsv)},differenceTo:function(c){return TColor.newRGB(Math.abs(this.rgb[0]-c.rgb[0]),Math.abs(this.rgb[1]-c.rgb[1]),Math.abs(this.rgb[2]-c.rgb[2]))},distanceToCMYK:function(c){var ccmyk=c.toCMYKAArray(),dc=this.cmyk[0]-ccmyk[0],dm=this.cmyk[1]-ccmyk[1],dy=this.cmyk[2]-ccmyk[2],dk=this.cmyk[3]-ccmyk[3];return Math.sqrt(dc*dc+dm*dm+dy*dy+dk*dk)},distanceToHSV:function(c){var hue=this.hsv[0]*mathUtils.TWO_PI,hue2=c.hue()*mathUtils.TWO_PI,v1=new Vec3D(mathUtils.cos(hue)*this.hsv[1],mathUtils.sin(hue)*this.hsv[1],this.hsv[2]),v2=new Vec3D(mathUtils.cos(hue2)*c.saturation(),mathUtils.sin(hue2)*c.saturation(),c.brightness());return v1.distanceTo(v2)},distanceToRGB:function(c){var crgb=c.toRGBAArray(),dr=this.rgb[0]-crgb[0],dg=this.rgb[1]-crgb[1],db=this.rgb[2]-crgb[2];return Math.sqrt(dr*dr+dg*dg+db*db)},equals:function(o){if(is.TColor(o)){var c=o,dr=c.rgb[0]-this.rgb[0],dg=c.rgb[1]-this.rgb[1],db=c.rgb[2]-this.rgb[2],da=c.alpha()-this._alpha,d;return Math.sqrt(dr*dr+dg*dg+db*db+da*da)<TColor.EPS}return!1},getAnalog:function(theta,delta){return new TColor(this).analog(theta,delta)},getBlended:function(c,t){return new TColor(this).blend(c,t)},getClosestHue:function(primaryOnly){return Hue.getClosest(this.hsv[0],!0===primaryOnly)},getComplement:function(){return new TColor(this).complement()},getComponentValue:function(criteria){return criteria.getComponentValueFor(this)},getDarkened:function(step){return new TColor(this).darken(step)},getDesaturated:function(step){return new TColor(this).desaturate(step)},getDifferenceTo:function(c){return this.copy().differenceTo(c)},getInverted:function(){return new TColor(this).invert()},getLightened:function(step){return new TColor(this).lighten(step)},getRotatedRYB:function(theta){return new TColor(this).rotateRYB(theta)},getSaturated:function(step){return new TColor(this).saturate(step)},green:function(){return this.rgb[1]},hue:function(){return this.hsv[0]},invert:function(){return this.rgb[0]=1-this.rgb[0],this.rgb[1]=1-this.rgb[1],this.rgb[2]=1-this.rgb[2],this.setRGB(this.rgb)},isBlack:function(){return this.rgb[0]<=TColor.BLACK_POINT&&this.rgb[0]===this.rgb[1]&&this.rgb[0]===this.rgb[2]},isGrey:function(){return this.hsv[1]<TColor.GREY_THRESHOLD},isWhite:function(){return this.rgb[0]>=TColor.WHITE_POINT&&this.rgb[0]===this.rgb[1]&&this.rgb[0]===this.rgb[2]},lighten:function(step){return this.hsv[2]=mathUtils.clip(this.hsv[2]+step,0,1),this.setHSV(this.hsv)},luminance:function(){return.299*this.rgb[0]+.587*this.rgb[1]+.114*this.rgb[2]},magenta:function(){return this.cmyk[1]},red:function(){return this.rgb[0]},rotateRYB:function(theta){var deg=parseInt(mathUtils.degrees(theta),10),h=360*this.hsv[0],i=0,p,q;theta%=360;var resultHue=0;for(i=0;i<TColor.RYB_WHEEL.length-1;i++)if(p=TColor.RYB_WHEEL[i],(q=TColor.RYB_WHEEL[i+1]).y<p.y&&(q.y+=360),p.y<=h&&h<=q.y){resultHue=p.x+(q.x-p.x)*(h-p.y)/(q.y-p.y);break}for(resultHue=(resultHue+theta)%360,i=0;i<TColor.RYB_WHEEL.length-1;i++)if(p=TColor.RYB_WHEEL[i],(q=TColor.RYB_WHEEL[i+1]).y<p.y&&(q.y+=360),p.x<=resultHue&&resultHue<=q.x){h=p.y+(q.y-p.y)*(resultHue-p.x)/(q.x-p.x);break}return this.hsv[0]=h%360/360,this.setHSV(this.hsv)},saturate:function(step){return this.hsv[1]=mathUtils.clip(this.hsv[1]+step,0,1),this.setHSV(this.hsv)},saturation:function(){return this.hsv[1]},setAlpha:function(alpha){return this._alpha=alpha,this},setARGB:function(argb){return this.setRGB((argb>>16&255)*TColor.INV8BIT,(argb>>8&255)*TColor.INV8BIT,(255&argb)*TColor.INV8BIT),this._alpha=(argb>>>24)*TColor.INV8BIT,this},setBlack:function(val){return this.cmyk[3]=val,this.setCMYK(this.cmyk)},setBlue:function(blue){return this.rgb[2]=blue,this.setRGB(this.rgb)},setBrightness:function(brightness){return this.hsv[2]=mathUtils.clip(brightness,0,1),this.setHSV(this.hsv)},setCMYK:function(c,m,y,k){return is.Array(c)&&(m=c[1],y=c[2],k=c[3],c=c[0]),this.cmyk[0]=c,this.cmyk[1]=m,this.cmyk[2]=y,this.cmyk[3]=k,this.rgb=TColor.cmykToRGB(this.cmyk[0],this.cmyk[1],this.cmyk[2],this.cmyk[3]),this.hsv=TColor.rgbToHSV(this.rgb[0],this.rgb[1],this.rgb[2]),this},setComponent:function(criteria,val){return criteria.setComponentValueFor(this,val),this},setCyan:function(val){return this.cmyk[0]=val,this.setCMYK(this.cmyk)},setGreen:function(green){return this.rgb[1]=green,this.setRGB(this.rgb)},setHSV:function(h,s,v){is.Array(h)&&(s=h[1],v=h[2],h=h[0]);var newHSV=[h,s,v];return this.hsv[0]=newHSV[0]%1,this.hsv[0]<0&&this.hsv[0]++,this.hsv[1]=mathUtils.clip(newHSV[1],0,1),this.hsv[2]=mathUtils.clip(newHSV[2],0,1),this.rgb=TColor.hsvToRGB(this.hsv[0],this.hsv[1],this.hsv[2]),this.cmyk=TColor.rgbToCMYK(this.rgb[0],this.rgb[1],this.rgb[2]),this},setHue:function(hue){return(hue%=1)<0&&hue++,this.hsv[0]=hue,this.setHSV(this.hsv)},setMagenta:function(val){return this.cmyk[1]=val,this.setCMYK(this.cmyk)},setRed:function(red){return this.rgb[0]=red,this.setRGB(this.rgb)},setRGB:function(r,g,b){return is.Array(r)&&(g=r[1],b=r[2],r=r[0]),this.rgb[0]=mathUtils.clip(r,0,1),this.rgb[1]=mathUtils.clip(g,0,1),this.rgb[2]=mathUtils.clip(b,0,1),this.cmyk=TColor.rgbToCMYK(this.rgb[0],this.rgb[1],this.rgb[2]),this.hsv=TColor.rgbToHSV(this.rgb[0],this.rgb[1],this.rgb[2]),this},setSaturation:function(saturation){return this.hsv[1]=mathUtils.clip(saturation,0,1),this.setHSV(this.hsv)},setYellow:function(val){return this.cmyk[2]=val,this.setCMYK(this.cmyk)},sub:function(c){return this.copy().subSelf(c)},subSelf:function(c){return this.rgb[0]=mathUtils.max(this.rgb[0]-c.rgb[0],0),this.rgb[1]=mathUtils.max(this.rgb[1]-c.rgb[1],0),this.rgb[2]=mathUtils.max(this.rgb[2]-c.rgb[2],0),this.setRGB(this.rgb)},toARGB:function(){var r,g,b,a;return parseInt(255*this.rgb[0],10)<<16|parseInt(255*this.rgb[1],10)<<8|parseInt(255*this.rgb[2],10)|parseInt(255*this._alpha,10)<<24},toCMYKAArray:function(cmyka){return void 0===cmyka&&(cmyka=[]),cmyka[0]=this.cmyk[0],cmyka[1]=this.cmyk[1],cmyka[2]=this.cmyk[2],cmyka[3]=this.cmyk[3],cmyka[4]=this._alpha,cmyka},toHex:function(){var hex=dec2hex(this.toARGB());return hex.length>6&&(hex=hex.substring(2)),hex},toHexCSS:function(){return"#"+this.toHex()},toHSVAArray:function(hsva){return void 0===hsva&&(hsva=[]),hsva[0]=this.hsv[0],hsva[1]=this.hsv[1],hsva[2]=this.hsv[2],hsva[3]=this._alpha,hsva},toHSLCSS:function(){var hsv=this.hsv,h,s,v;return"hsl("+Math.floor(360*hsv[0])+","+Math.floor(100*hsv[1])+"%,"+Math.floor(100*hsv[2])+"%)"},toHSLACSS:function(){var hsv=this.hsv,h,s,v;return"hsla("+Math.floor(360*hsv[0])+","+Math.floor(100*hsv[1])+"%,"+Math.floor(100*hsv[2])+"%,"+this._alpha+")"},toInt:function(){return Number("0x"+this.toHex())},toRGBAArray:function(rgba,offset){return offset=offset||0,(rgba=rgba||[])[offset++]=this.rgb[0],rgba[offset++]=this.rgb[1],rgba[offset++]=this.rgb[2],rgba[offset]=this._alpha,rgba},toRGBADecimalArray:function(rgba,offset){return offset=offset||0,(rgba=rgba||[])[offset++]=255*this.rgb[0],rgba[offset++]=255*this.rgb[1],rgba[offset++]=255*this.rgb[2],rgba[offset]=255*this._alpha,rgba},toRGBCSS:function(asPercents){var rgb=this.rgb,mult=asPercents?100:255,u=asPercents?"%":"",f=Math.floor;return"rgb("+f(rgb[0]*mult)+u+","+f(rgb[1]*mult)+u+","+f(rgb[2]*mult)+u+")"},toRGBACSS:function(asPercents){var rgb=this.rgb,mult=asPercents?100:255,u=asPercents?"%":"",f=Math.floor;return"rgba("+f(rgb[0]*mult)+u+","+f(rgb[1]*mult)+u+","+f(rgb[2]*mult)+u+","+this._alpha+")"},toString:function(){return"TColor: rgb: "+this.rgb[0]+", "+this.rgb[1]+", "+this.rgb[2]+" hsv: "+this.hsv[0]+","+this.hsv[1]+","+this.hsv[2]+" cmyk: "+this.cmyk[0]+", "+this.cmyk[1]+","+this.cmyk[2]+","+this.cmyk[3]+" alpha: "+this._alpha},yellow:function(){return this.cmyk[2]}},TColor.INV60DEGREES=60/360,TColor.INV8BIT=1/255,TColor.EPS=.001,TColor.BLACK_POINT=.08,TColor.WHITE_POINT=1,TColor.GREY_THRESHOLD=.01,TColor.cmykToRGB=function(c,m,y,k,rgb){return void 0===rgb&&(rgb=[0,0,0]),rgb[0]=1-Math.min(1,c+k),rgb[1]=1-Math.min(1,m+k),rgb[2]=1-Math.min(1,y+k),rgb},TColor.hexToRGB=function(hexRGB,rgb){return void 0===rgb&&(rgb=[]),hexRGB="#"==hexRGB.charAt(0)?hexRGB.substring(1,7):hexRGB,rgb[0]=parseInt(hexRGB.substring(0,2),16)*TColor.INV8BIT,rgb[1]=parseInt(hexRGB.substring(2,4),16)*TColor.INV8BIT,rgb[2]=parseInt(hexRGB.substring(4,6),16)*TColor.INV8BIT,rgb},TColor.hsvToRGB=function(h,s,v,rgb){if(void 0===rgb&&(rgb=[]),0===s)rgb[0]=rgb[1]=rgb[2]=v;else{h/=TColor.INV60DEGREES;var i=parseInt(h,10),f=h-i,p=v*(1-s),q=v*(1-s*f),t=v*(1-s*(1-f));0===i?(rgb[0]=v,rgb[1]=t,rgb[2]=p):1==i?(rgb[0]=q,rgb[1]=v,rgb[2]=p):2==i?(rgb[0]=p,rgb[1]=v,rgb[2]=t):3==i?(rgb[0]=p,rgb[1]=q,rgb[2]=v):4==i?(rgb[0]=t,rgb[1]=p,rgb[2]=v):(rgb[0]=v,rgb[1]=p,rgb[2]=q)}return rgb},TColor.labToRGB=function(l,a,b,rgb){void 0===rgb&&(rgb=[]);var y=(l+16)/116,x=a/500+y,z=y-b/200,i=0;for(rgb[0]=x,rgb[1]=y,rgb[2]=z,i=0;i<3;i++){var p=Math.pow(rgb[i],3);rgb[i]=p>.008856?p:(rgb[i]-16/116)/7.787}x=.95047*rgb[0],y=rgb[1],z=1.08883*rgb[2],rgb[0]=3.2406*x+-1.5372*y+-.4986*z,rgb[1]=-.9689*x+1.8758*y+.0415*z,rgb[2]=.0557*x+-.204*y+1.057*z;var tpow=1/2.4;for(i=0;i<3;i++)rgb[i]>.0031308?rgb[i]=1.055*Math.pow(rgb[i],tpow)-.055:rgb[i]=12.92*rgb[i];return rgb},TColor.newARGB=function(argb){return TColor.newRGBA((argb>>16&255)*TColor.INV8BIT,(argb>>8&255)*TColor.INV8BIT,(255&argb)*TColor.INV8BIT,(argb>>>24)*TColor.INV8BIT)},TColor.newCMYK=function(c,m,y,k){return TColor.newCMYKA(c,m,y,k,1)},TColor.newCMYKA=function(c,m,y,k,a){var col=new TColor;return col.setCMYK([c,m,y,k]),col.setAlpha(mathUtils.clip(a,0,1)),col},TColor.newCSS=function(css){for(;css.indexOf(" ")>-1;)css=css.replace(" ","");function digits(colorFnStr){var str=css.substr(0,css.length-1);return str.substr(colorFnStr.length+1,str.length).split(",")}function makeNumbers(digits){var i=0,l=digits.length;for(i=0;i<l;i++)digits[i]=Number(digits[i]);return digits}css=css.toLowerCase();var conversions={"#":function(){return TColor.newHex(css.substr(1,css.length))},rgba:function(){var vals=makeNumbers(digits("rgba"));return TColor.newRGBA(vals[0]/255,vals[1]/255,vals[2]/255,vals[3])},rgb:function(){var vals=makeNumbers(digits("rgb"));return TColor.newRGBA(vals[0]/255,vals[1]/255,vals[2]/255,1)},hsla:function(vals){return(vals=vals||digits("hsla"))[0]=Number(vals[0])/360,vals[1]=Number(vals[1].substr(0,vals[1].length-1))/100,vals[2]=Number(vals[2].substr(0,vals[2].length-1))/100,vals[3]=Number(vals[3]),TColor.newHSVA(vals[0],vals[1],vals[2],vals[3])},hsl:function(){var vals=digits("hsl");return vals.push(1),conversions.hsla(vals)}};if(void 0!==TColor.X11[css])return TColor.X11[css].copy();for(var method in conversions)if(css.indexOf(method)>-1)return conversions[method]()},TColor.newGray=function(gray){return TColor.newGrayAlpha(gray,1)},TColor.newGrayAlpha=function(gray,alpha){var c=new TColor;return c.setRGB([gray,gray,gray]),c.setAlpha(alpha),c},TColor.newHex=function(hexRGB){var c=new TColor;return c.setRGB(TColor.hexToRGB(hexRGB)),c.setAlpha(1),c},TColor.newHSV=function(h,s,v){return TColor.newHSVA(h,s,v,1)},TColor.newHSVA=function(h,s,v,a){var c=new TColor;return c.setHSV(h,s,v),c.setAlpha(mathUtils.clip(a,0,1)),c},TColor.newRandom=function(){return TColor.newRGBA(Math.random(),Math.random(),Math.random(),1)},TColor.newRGB=function(r,g,b){return TColor.newRGBA(r,g,b,1)},TColor.newRGBA=function(r,g,b,a){var c=new TColor;return c.setRGB(r,g,b),c.setAlpha(mathUtils.clip(a,0,1)),c},TColor.rgbToCMYK=function(r,g,b,cmyk){return void 0===cmyk&&(cmyk=[]),cmyk[0]=1-r,cmyk[1]=1-g,cmyk[2]=1-b,cmyk[3]=mathUtils.min(cmyk[0],cmyk[1],cmyk[2]),cmyk[0]=mathUtils.clip(cmyk[0]-cmyk[3],0,1),cmyk[1]=mathUtils.clip(cmyk[1]-cmyk[3],0,1),cmyk[2]=mathUtils.clip(cmyk[2]-cmyk[3],0,1),cmyk[3]=mathUtils.clip(cmyk[3],0,1),cmyk},TColor.rgbToHex=function(r,g,b){var hex;return dec2hex(255*mathUtils.clip(r,0,1))+dec2hex(255*mathUtils.clip(g,0,1))+dec2hex(255*mathUtils.clip(b,0,1))},TColor.rgbToHSV=function(r,g,b,hsv){void 0===hsv&&(hsv=[]);var h=0,s=0,v=mathUtils.max(r,g,b),d=v-mathUtils.min(r,g,b);return 0!==v&&(s=d/v),0!==s&&(h=0===numberComparator(r,v)?(g-b)/d:0===numberComparator(g,v)?2+(b-r)/d:4+(r-g)/d),(h*=TColor.INV60DEGREES)<0&&(h+=1),hsv[0]=h,hsv[1]=s,hsv[2]=v,hsv},TColor.RED=TColor.newRGB(1,0,0),TColor.RYB_WHEEL=[new Vec2D(0,0),new Vec2D(15,8),new Vec2D(30,17),new Vec2D(45,26),new Vec2D(60,34),new Vec2D(75,41),new Vec2D(90,48),new Vec2D(105,54),new Vec2D(120,60),new Vec2D(135,81),new Vec2D(150,103),new Vec2D(165,123),new Vec2D(180,138),new Vec2D(195,155),new Vec2D(210,171),new Vec2D(225,187),new Vec2D(240,204),new Vec2D(255,219),new Vec2D(270,234),new Vec2D(285,251),new Vec2D(300,267),new Vec2D(315,282),new Vec2D(330,298),new Vec2D(345,329),new Vec2D(360,0)],TColor.GREEN=TColor.newRGB(0,1,0),TColor.BLUE=TColor.newRGB(0,0,1),TColor.CYAN=TColor.newRGB(0,1,1),TColor.MAGENTA=TColor.newRGB(1,0,1),TColor.YELLOW=TColor.newRGB(1,1,0),TColor.BLACK=TColor.newRGB(0,0,0),TColor.WHITE=TColor.newRGB(1,1,1),TColor.X11={},function(){var x11={indianred:[205,92,92],lightcoral:[240,128,128],salmon:[250,128,114],darksalmon:[233,150,122],lightsalmon:[255,160,122],red:[255,0,0],crimson:[220,20,60],fireBrick:[178,34,34],darkred:[139,0,0],pink:[255,192,203],lightpink:[255,182,193],hotpink:[255,105,180],deeppink:[255,20,147],mediumvioletred:[199,21,133],palevioletred:[219,112,147],coral:[255,127,80],tomato:[255,99,71],orangered:[255,69,0],darkorange:[255,140,0],orange:[255,165,0],gold:[255,215,0],yellow:[255,255,0],lightyellow:[255,255,224],lemonchiffon:[255,250,205],lightgoldenrodyellow:[250,250,210],papayawhip:[255,239,213],moccasin:[255,228,181],peachpuff:[255,218,185],palegoldenrod:[238,232,170],khaki:[240,230,140],darkkhaki:[189,183,107],lavender:[230,230,250],thistle:[216,191,216],plum:[221,160,221],violet:[238,130,238],orchid:[218,112,214],fuchsia:[255,0,255],Magenta:[255,0,255],mediumorchid:[186,85,211],mediumpurple:[147,112,219],blueviolet:[138,43,226],darkviolet:[148,0,211],darkorchid:[153,50,204],darkmagenta:[139,0,139],purple:[128,0,128],indigo:[75,0,130],darkslateblue:[72,61,139],slateblue:[106,90,205],mediumslateblue:[123,104,238],greenyellow:[173,255,47],chartreuse:[127,255,0],lawngreen:[124,252,0],lime:[0,255,0],limegreen:[50,205,50],palegreen:[152,251,152],lightgreen:[144,238,144],mediumspringgreen:[0,250,154],springgreen:[0,255,127],mediumseagreen:[60,179,113],seagreen:[46,139,87],forestgreen:[34,139,34],green:[0,128,0],darkgreen:[0,100,0],yellowgreen:[154,205,50],olivedrab:[107,142,35],olive:[128,128,0],darkolivegreen:[85,107,47],mediumaquamarine:[102,205,170],darkseagreen:[143,188,143],lightseagreen:[32,178,170],darkcyan:[0,139,139],teal:[0,128,128],aqua:[0,255,255],cyan:[0,255,255],lightcyan:[224,255,255],paleturquoise:[175,238,238],aquamarine:[127,255,212],turquoise:[64,224,208],mediumturquoise:[72,209,204],darkturquoise:[0,206,209],cadetblue:[95,158,160],steelblue:[70,130,180],lightsteelblue:[176,196,222],powderblue:[176,224,230],lightblue:[173,216,230],skyblue:[135,206,235],lightskyblue:[135,206,250],deepskyblue:[0,191,255],dodgerblue:[30,144,255],cornflowerblue:[100,149,237],royalblue:[65,105,225],blue:[0,0,255],mediumblue:[0,0,205],darkblue:[0,0,139],navy:[0,0,128],midnightblue:[25,25,112],cornsilk:[255,248,220],blanchedalmond:[255,235,205],bisque:[255,228,196],navajowhite:[255,222,173],wheat:[245,222,179],burlywood:[222,184,135],tan:[210,180,140],rosybrown:[188,143,143],sandybrown:[244,164,96],goldenrod:[218,165,32],darkgoldenrod:[184,134,11],Peru:[205,133,63],chocolate:[210,105,30],saddlebrown:[139,69,19],sienna:[160,82,45],brown:[165,42,42],maroon:[128,0,0],white:[255,255,255],snow:[255,250,250],honeydew:[240,255,240],mintcream:[245,255,250],azure:[240,255,255],aliceblue:[240,248,255],ghostwhite:[248,248,255],whitesmoke:[245,245,245],seashell:[255,245,238],beige:[245,245,220],oldlace:[253,245,230],floralwhite:[255,250,240],ivory:[255,255,240],antiquewhite:[250,235,215],linen:[250,240,230],lavenderblush:[255,240,245],mistyrose:[255,228,225],gainsboro:[220,220,220],lightgray:[211,211,211],silver:[192,192,192],darkgray:[169,169,169],gray:[128,128,128],dimgray:[105,105,105],lightslategray:[119,136,153],slategray:[112,128,144],darkslategray:[47,79,79],black:[0,0,0],bark:[64,48,33]},name,clr;for(name in x11)x11.hasOwnProperty(name)&&(clr=x11[name],TColor.X11[name]=TColor.newRGB(clr[0]/255,clr[1]/255,clr[2]/255),name.indexOf("gray")>=0&&(TColor.X11[name.replace("gray","grey")]=TColor.X11[name]));TColor.X11.transparent=TColor.newRGBA(0,0,0,0)}(),module.exports=TColor},{"../geom/vectors":96,"../internals/is":106,"../internals/numberComparator":109,"../math/mathUtils":125,"./Hue":15}],21:[function(require,module,exports){var is=require("../internals/is"),ScaleMap=require("../math/ScaleMap"),ColorList=require("./ColorList"),ColorGradient=require("./ColorGradient"),ToneMap;(ToneMap=function(min,max,list,colorB,resolution){var al=arguments.length;if(al>3)if(4===al)list=new ColorList(list,colorB);else{var colA=list;(list=new ColorGradient).addColorAt(0,colA),list.addColorAt(resolution-1,colorB),list=list.calcGradient(0,resolution)}is.ColorGradient(list)&&(list=list.calcGradient()),this.map=new ScaleMap(min,max,0,list.size()-1),this.colors=list}).prototype={constructor:ToneMap,getARGBToneFor:function(t){return this.getToneFor(t).toARGB()},getToneFor:function(t){var idx;return idx=this.colors.size()>2?Math.floor(this.map.getClippedValueFor(t)+.5):t>=this.map.getInputMedian()?1:0,this.colors.get(idx)},getToneMappedArray:function(src,pixels,offset){if("number"!=typeof offset)offset=0;else if(offset<0)throw new Error("offset into target pixel array is negative");pixels=pixels||new Array(src.length);for(var i=0,l=src.length;i<l;i++)pixels[offset++]=this.getToneFor(src[i]).toARGB();return pixels},setMapFunction:function(func){this.map.setMapFunction(func)}},module.exports=ToneMap},{"../internals/is":106,"../math/ScaleMap":120,"./ColorGradient":7,"./ColorList":8}],22:[function(require,module,exports){var HSVAccessor=require("./HSVAccessor"),RGBAccessor=require("./RGBAccessor"),CMYKAccessor=require("./CMYKAccessor"),AlphaAccessor=require("./AlphaAccessor"),LuminanceAccessor=require("./LuminanceAccessor");exports.HUE=new HSVAccessor(0),exports.SATURATION=new HSVAccessor(1),exports.BRIGHTNESS=new HSVAccessor(2),exports.RED=new RGBAccessor(0),exports.GREEN=new RGBAccessor(1),exports.BLUE=new RGBAccessor(2),exports.CYAN=new CMYKAccessor(0),exports.MAGENTA=new CMYKAccessor(1),exports.YELLOW=new CMYKAccessor(2),exports.BLACK=new CMYKAccessor(3),exports.ALPHA=new AlphaAccessor,exports.LUMINANCE=new LuminanceAccessor},{"./AlphaAccessor":4,"./CMYKAccessor":5,"./HSVAccessor":11,"./LuminanceAccessor":16,"./RGBAccessor":18}],23:[function(require,module,exports){var numberComparator=require("../internals").numberComparator,bind=require("../internals").bind;function make(type,setters){var name=type+"Accessor",arry=type.toLowerCase();exports[name]=function(comp){this.component=comp,this.compare=bind(this.compare,this)},exports[name].prototype.compare=function(a,b){var ca=a[arry][this.component],cb=b[arry][this.component];return numberComparator(ca,cb)},exports[name].prototype.getComponentValueFor=function(col){return col[arry][this.component]},exports[name].prototype.setComponentValueFor=function(col,val){col["set"+setters[this.component]](val)}}make("RGB",["Red","Green","Blue"]),make("HSV",["Hue","Saturation","Brightness"]),make("CMYK",["Cyan","Magenta","Yellow","Black"]);var LuminanceAccessor=function(){};LuminanceAccessor.prototype.compare=function(a,b){return numberComparator(a.luminance(),b.luminance())},LuminanceAccessor.prototype.getComponentValueFor=function(col){return col.luminance()},LuminanceAccessor.prototype.setComponentValueFor=function(){};var AlphaAccessor=function(){};AlphaAccessor.prototype.compare=function(a,b){return numberComparator(a.alpha(),b.alpha())},AlphaAccessor.prototype.getComponentValueFor=function(col){return col.alpha()},AlphaAccessor.prototype.setComponentValueFor=function(col,value){col.setAlpha(value)},exports.LuminanceAccessor=LuminanceAccessor,exports.AlphaAccessor=AlphaAccessor},{"../internals":98}],24:[function(require,module,exports){var ColorTheoryRegistry=require("./theory/colorTheoryRegistry");module.exports=function(strategy,c){var list;return"string"==typeof strategy&&(strategy=ColorTheoryRegistry.getStrategyForName(strategy)),void 0!==strategy&&(list=strategy.createListFromColor(c)),list}},{"./theory/colorTheoryRegistry":38}],25:[function(require,module,exports){function makeProxy(type){var name=type+"DistanceProxy";exports[name]=function(){},exports[name].prototype.distanceBetween=function(a,b){return a["distanceTo"+type](b)}}makeProxy("HSV"),makeProxy("RGB"),makeProxy("CMYK")},{}],26:[function(require,module,exports){var TColor=require("./TColor"),internals,each=require("../internals").each,names=[],namedColorMap={};each(TColor.X11,(function(value,key){var upkey=key.toUpperCase();names.push(upkey),namedColorMap[upkey]=value,namedColorMap[key]=value,exports[upkey]=value})),exports.getForName=function(name){return namedColorMap[name]||namedColorMap[name.toLowerCase()]},exports.getNames=function(){return names.slice(0)}},{"../internals":98,"./TColor":20}],27:[function(require,module,exports){exports.AnalagousStrategy=require("./theory/AnalagousStrategy"),exports.colorTheoryRegistry=require("./theory/colorTheoryRegistry"),exports.ColorTheoryRegistry=exports.colorTheoryRegistry,exports.ComplementaryStrategy=require("./theory/ComplementaryStrategy"),exports.CompoundTheoryStrategy=require("./theory/CompoundTheoryStrategy"),exports.LeftSplitComplementaryStrategy=require("./theory/LeftSplitComplementaryStrategy"),exports.MonochromeTheoryStrategy=require("./theory/MonochromeTheoryStrategy"),exports.RightSplitComplementaryStrategy=require("./theory/RightSplitComplementaryStrategy"),exports.SingleComplementStrategy=require("./theory/SingleComplementStrategy"),exports.SplitComplementaryStrategy=require("./theory/SplitComplementaryStrategy"),exports.TetradTheoryStrategy=require("./theory/TetradTheoryStrategy"),exports.TriadTheoryStrategy=require("./theory/TriadTheoryStrategy"),exports.strategies=require("./theory/strategies")},{"./theory/AnalagousStrategy":28,"./theory/ComplementaryStrategy":29,"./theory/CompoundTheoryStrategy":30,"./theory/LeftSplitComplementaryStrategy":31,"./theory/MonochromeTheoryStrategy":32,"./theory/RightSplitComplementaryStrategy":33,"./theory/SingleComplementStrategy":34,"./theory/SplitComplementaryStrategy":35,"./theory/TetradTheoryStrategy":36,"./theory/TriadTheoryStrategy":37,"./theory/colorTheoryRegistry":38,"./theory/strategies":39}],28:[function(require,module,exports){var strategies=require("./strategies"),vectors=require("../../geom/vectors"),MathUtils=require("../../math/mathUtils"),internals=require("../../internals"),ColorList=require("../ColorList"),each=internals.each,Vec2D=vectors.Vec2D,_tones=[new Vec2D(1,2.2),new Vec2D(2,1),new Vec2D(-1,-.5),new Vec2D(-2,1)];module.exports=strategies.create("Analagous",(function(theta,contrast){this.contrast="number"==typeof contrast?contrast:.25,this.theta=MathUtils.radians("number"==typeof theta?theta:10)}),{createListFromColor:function(src){var self=this;this.contrast=MathUtils.clipNormalized(this.contrast);var colors=new ColorList(src);return each(_tones,(function(currTone){var c=src.getRotatedRYB(self.theta*currTone.x),t=.44-.1*currTone.y;src.brightness()-self.contras*currTone.y<t?c.setBrightness(t):c.setBrightness(src.brightness()-self.contrast*currTone.y),c.desaturate(.05),colors.add(c)})),colors},toString:function(){return"analagous contrast: "+this.contrast+" theta: "+MathUtils.degrees(this.theta)}})},{"../../geom/vectors":96,"../../internals":98,"../../math/mathUtils":125,"../ColorList":8,"./strategies":39}],29:[function(require,module,exports){var strategies=require("./strategies"),ColorList=require("../ColorList"),adjust=function(c,thresh){var b=c.brightness();return b>thresh?c.setBrightness(.1+.25*b):c.setBrightness(1-.25*b),c};module.exports=strategies.create("Complementary",{createListFromColor:function(src){var colors=new ColorList(src),c;return colors.add(adjust(src.copy(),.4)),(c=src.copy()).lighten(.3),c.setSaturation(.1+.3*c.saturation()),colors.add(c),colors.add(adjust(src.getComplement(),.3)),colors.add(src.getComplement()),(c=src.getComplement()).lighten(.3),c.setSaturation(.1+.25*c.saturation()),colors.add(c),colors}})},{"../ColorList":8,"./strategies":39}],30:[function(require,module,exports){var strategies=require("./strategies"),ColorList=require("../ColorList"),wrap=strategies.wrap;module.exports=strategies.create("Compound",(function(flipped){this._isFlipped=!0===flipped}),{createListFromColor:function(src){var colors=new ColorList(src),direction=this._isFlipped?-1:1,c;return(c=src.getRotatedRYB(30*direction)).setBrightness(wrap(c.brightness(),.25,.6,.25)),colors.add(c),(c=src.getRotatedRYB(30*direction)).setSaturation(wrap(c.saturation(),.4,.1,.4)),c.setBrightness(wrap(c.brightness(),.4,.2,.4)),colors.add(c),(c=src.getRotatedRYB(160*direction)).setSaturation(wrap(c.saturation(),.25,.1,.25)),c.setBrightness(Math.max(.2,c.brightness())),colors.add(c),(c=src.getRotatedRYB(150*direction)).setSaturation(wrap(c.saturation(),.1,.8,.1)),c.setBrightness(wrap(c.brightness(),.3,.6,.3)),colors.add(c),colors},isFlipped:function(){return this._isFlipped},setFlipped:function(state){this._isFlipped=state},toString:function(){return"Compound"+(this.isFlipped()?"_flipped":"")}})},{"../ColorList":8,"./strategies":39}],31:[function(require,module,exports){var strategies=require("./strategies"),ColorList=require("../ColorList"),ComplementaryStrategy=require("./ComplementaryStrategy"),complementary;module.exports=strategies.create("LeftSplitComplementary",{createListFromColor:function(src){complementary=complementary||new ComplementaryStrategy;for(var left=src.getComplement().rotateRYB(-30).lighten(.1),colors=complementary.createListFromColor(src),c,i=3;i<6;i++)(c=colors.get(i)).setHue(left.hue());return colors}})},{"../ColorList":8,"./ComplementaryStrategy":29,"./strategies":39}],32:[function(require,module,exports){var strategies=require("./strategies"),ColorList=require("../ColorList"),wrap=strategies.wrap;module.exports=strategies.create("Monochrome",{createListFromColor:function(src){var colors=new ColorList(src),c=src.copy();return c.setBrightness(wrap(c.brightness(),.5,.2,.3)),c.setSaturation(wrap(c.saturation(),.3,.1,.3)),colors.add(c),(c=src.copy()).setBrightness(wrap(c.brightness(),.2,.2,.6)),colors.add(c),(c=src.copy()).setBrightness(Math.max(.2,c.brightness()+.2*(1-c.brightness()))),c.setSaturation(wrap(c.saturation(),.3,.1,.3)),colors.add(c),(c=src.copy()).setBrightness(wrap(c.brightness(),.5,.2,.3)),colors.add(c),colors}})},{"../ColorList":8,"./strategies":39}],33:[function(require,module,exports){var strategies=require("./strategies"),ColorList=require("../ColorList"),ComplementaryStrategy=require("./ComplementaryStrategy"),complementary;module.exports=strategies.create("RightSplitComplementary",{createListFromColor:function(src){complementary=complementary||new ComplementaryStrategy;for(var left=src.getComplement().rotateRYB(30).lighten(.1),colors=complementary.createListFromColor(src),c,i=3;i<6;i++)(c=colors.get(i)).setHue(left.hue());return colors}})},{"../ColorList":8,"./ComplementaryStrategy":29,"./strategies":39}],34:[function(require,module,exports){var strategies=require("./strategies"),ColorList=require("../ColorList"),getName=function(){return"complement"};module.exports=strategies.create("SingleComplement",{createListFromColor:function(src){var list=new ColorList(src);return list.add(src.getComplement()),list},getName:getName,toString:getName})},{"../ColorList":8,"./strategies":39}],35:[function(require,module,exports){var strategies=require("./strategies"),ColorList=require("../ColorList");module.exports=strategies.create("SplitComplementary",{createListFromColor:function(src){var colors=new ColorList(src);return colors.add(src.getRotatedRYB(150).lighten(.1)),colors.add(src.getRotatedRYB(210).lighten(.1)),colors}})},{"../ColorList":8,"./strategies":39}],36:[function(require,module,exports){var strategies=require("./strategies"),ColorList=require("../ColorList"),getName=function(){return"tetrad"},adjust=function(c){return c[c.brightness()<.5?"lighten":"darken"](.2)};module.exports=strategies.create("TetradTheory",(function(theta){this.theta="number"==typeof theta?theta:90}),{createListFromColor:function(src){var colors=new ColorList(src);return colors.add(adjust(src.getRotatedRYB(this.theta))),colors.add(adjust(src.getRotatedRYB(2*this.theta))),colors.add(src.getRotatedRYB(3*this.theta).lighten(.1)),colors},getName:getName,toString:getName})},{"../ColorList":8,"./strategies":39}],37:[function(require,module,exports){var strategies=require("./strategies"),ColorList=require("../ColorList"),getName=function(){return"triad"};module.exports=strategies.create("TriadTheory",{createListFromColor:function(src){var colors=new ColorList(src);return colors.add(src.getRotatedRYB(120).lighten(.1)),colors.add(src.getRotatedRYB(-120).lighten(.1)),colors},getName:getName,toString:toString})},{"../ColorList":8,"./strategies":39}],38:[function(require,module,exports){var internals=require("../../internals"),each=internals.each,keys=internals.keys,values=internals.values,implementations={},strats={SINGLE_COMPLEMENT:require("./SingleComplementStrategy"),COMPLEMENTARY:require("./ComplementaryStrategy"),SPLIT_COMPLEMENTARY:require("./SplitComplementaryStrategy"),LEFT_SPLIT_COMPLEMENTARY:require("./LeftSplitComplementaryStrategy"),RIGHT_SPLIT_COMPLEMENTARY:require("./RightSplitComplementaryStrategy"),ANALAGOUS:require("./AnalagousStrategy"),MONOCHROME:require("./MonochromeTheoryStrategy"),TRIAD:require("./TriadTheoryStrategy"),TETRAD:require("./TetradTheoryStrategy"),COMPOUND:require("./CompoundTheoryStrategy")};exports.getRegisteredNames=function(){return keys(implementations)},exports.getRegisteredStrategies=function(){return values(implementations)},exports.getStrategyForName=function(id){return implementations[id]},exports.registerImplementation=function(impl){implementations[impl.getName()]=impl},each(strats,(function(Constructor,type){exports[type]=new strats[type],exports.registerImplementation(exports[type])}))},{"../../internals":98,"./AnalagousStrategy":28,"./ComplementaryStrategy":29,"./CompoundTheoryStrategy":30,"./LeftSplitComplementaryStrategy":31,"./MonochromeTheoryStrategy":32,"./RightSplitComplementaryStrategy":33,"./SingleComplementStrategy":34,"./SplitComplementaryStrategy":35,"./TetradTheoryStrategy":36,"./TriadTheoryStrategy":37}],39:[function(require,module,exports){var has=require("../../internals/has"),is=require("../../internals/is"),has=has.all,isTColor=is.TColor;exports.create=function(name,constructor,extend){2===arguments.length&&(extend=constructor,constructor=function(){});var _NAME=name.charAt(0).toLowerCase()+name.slice(1,name.length),createList;for(var prop in constructor.prototype.constructor=constructor,constructor.prototype.getName=function(){return _NAME},constructor.prototype.toString=constructor.prototype.getName,extend)constructor.prototype[prop]=extend[prop];return createList=constructor.prototype.createListFromColor,constructor.prototype.createListFromColor=function(src){if(!isTColor(src))throw new Error("src color was not a valid TColor");return createList.call(this,src)},constructor},exports.wrap=function(x,min,threshold,plus){return x-min<threshold?x+plus:x-min}},{"../../internals/has":105,"../../internals/is":106}],40:[function(require,module,exports){module.exports=require("./index")},{"./index":97}],41:[function(require,module,exports){exports.AABB=require("./geom/AABB"),exports.mesh=require("./geom/mesh"),exports.BernsteinPolynomial=require("./geom/BernsteinPolynomial"),exports.Circle=require("./geom/Circle"),exports.CircleIntersector=require("./geom/CircleIntersector"),exports.Cone=require("./geom/Cone"),exports.ConvexPolygonClipper=require("./geom/ConvexPolygonClipper"),exports.Ellipse=require("./geom/Ellipse"),exports.IsectData2D=require("./geom/IsectData2D"),exports.IsectData3D=require("./geom/IsectData3D"),exports.Line2D=require("./geom/Line2D"),exports.Line3D=require("./geom/Line3D"),exports.LineStrip3D=require("./geom/LineStrip3D"),exports.Matrix4x4=require("./geom/Matrix4x4"),exports.Plane=require("./geom/Plane"),exports.Polygon2D=require("./geom/Polygon2D"),exports.Quaternion=require("./geom/Quaternion"),exports.Ray2D=require("./geom/Ray2D"),exports.Ray3D=require("./geom/Ray3D"),exports.Ray3DIntersector=require("./geom/Ray3DIntersector"),exports.Rect=require("./geom/Rect"),exports.Sphere=require("./geom/Sphere"),exports.Spline2D=require("./geom/Spline2D"),exports.Spline3D=require("./geom/Spline3D"),exports.SutherlandHodgemanClipper=require("./geom/SutherlandHodgemanClipper"),exports.Triangle2D=require("./geom/Triangle2D"),exports.Triangle3D=require("./geom/Triangle3D"),exports.Vec2D=require("./geom/Vec2D"),exports.Vec3D=require("./geom/Vec3D"),exports.XAxisCylinder=require("./geom/XAxisCylinder"),exports.YAxisCylinder=require("./geom/YAxisCylinder"),exports.ZAxisCylinder=require("./geom/ZAxisCylinder")},{"./geom/AABB":42,"./geom/BernsteinPolynomial":44,"./geom/Circle":45,"./geom/CircleIntersector":46,"./geom/Cone":47,"./geom/ConvexPolygonClipper":48,"./geom/Ellipse":49,"./geom/IsectData2D":50,"./geom/IsectData3D":51,"./geom/Line2D":52,"./geom/Line3D":53,"./geom/LineStrip3D":54,"./geom/Matrix4x4":55,"./geom/Plane":56,"./geom/Polygon2D":57,"./geom/Quaternion":58,"./geom/Ray2D":59,"./geom/Ray3D":60,"./geom/Ray3DIntersector":61,"./geom/Rect":62,"./geom/Sphere":63,"./geom/Spline2D":64,"./geom/Spline3D":65,"./geom/SutherlandHodgemanClipper":66,"./geom/Triangle2D":67,"./geom/Triangle3D":68,"./geom/Vec2D":70,"./geom/Vec3D":71,"./geom/XAxisCylinder":72,"./geom/YAxisCylinder":73,"./geom/ZAxisCylinder":74,"./geom/mesh":75}],42:[function(require,module,exports){var internals=require("../internals"),Vec3D=require("./Vec3D"),Vec2D=require("./Vec2D"),mathUtils=require("../math/mathUtils"),AABB=function(a,b){void 0===a?(Vec3D.call(this),this.setExtent(new Vec3D)):"number"==typeof a?(Vec3D.call(this,new Vec3D),this.setExtent(a)):internals.has.XYZ(a)&&(Vec3D.call(this,a),void 0===b&&internals.is.AABB(a)?this.setExtent(a.getExtent()):"number"==typeof b?this.setExtent(new Vec3D(b,b,b)):this.setExtent(b))};internals.extend(AABB,Vec3D),AABB.fromMinMax=function(min,max){var a=Vec3D.min(min,max),b=Vec3D.max(min,max);return new AABB(a.interpolateTo(b,.5),b.sub(a).scaleSelf(.5))},AABB.prototype.containsPoint=function(p){return p.isInAABB(this)},AABB.prototype.copy=function(){return new AABB(this)},AABB.prototype.getExtent=function(){return this.extent.copy()},AABB.prototype.getMax=function(){return this.max.copy()},AABB.prototype.getMin=function(){return this.min.copy()},AABB.prototype.getNormalForPoint=function(p){p=p.sub(this);var pabs=this.extent.sub(p.getAbs()),psign=p.getSignum(),normal=Vec3D.X_AXIS.scale(psign.x),minDist=pabs.x;return pabs.y<minDist&&(minDist=pabs.y,normal=Vec3D.Y_AXIS.scale(psign.y)),pabs.z<minDist&&(normal=Vec3D.Z_AXIS.scale(psign.z)),normal},AABB.prototype.includePoint=function(p){return this.min.minSelf(p),this.max.maxSelf(p),this.set(this.min.interpolateTo(this.max,.5)),this.extent.set(this.max.sub(this.min).scaleSelf(.5)),this},AABB.prototype.intersectsBox=function(box){var t=box.sub(this);return Math.abs(t.x)<=this.extent.x+box.extent.x&&Math.abs(t.y)<=this.extent.y+box.extent.y&&Math.abs(t.z)<=this.extent.z+box.extent.z},AABB.prototype.intersectsRay=function(ray,minDist,maxDist){var invDir=ray.getDirection().reciprocal(),signDirX=invDir.x<0,signDirY=invDir.y<0,signDirZ=invDir.z<0,bbox=signDirX?this.max:this.min,tmin=(bbox.x-ray.x)*invDir.x,tmax=((bbox=signDirX?this.min:this.max).x-ray.x)*invDir.x,tymin=((bbox=signDirY?this.max:this.min).y-ray.y)*invDir.y,tymax=((bbox=signDirY?this.min:this.max).y-ray.y)*invDir.y;if(tmin>tymax||tymin>tmax)return null;tymin>tmin&&(tmin=tymin),tymax<tmax&&(tmax=tymax);var tzmin=((bbox=signDirZ?this.max:this.min).z-ray.z)*invDir.z,tzmax=((bbox=signDirZ?this.min:this.max).z-ray.z)*invDir.z;return tmin>tzmax||tzmin>tmax?null:(tzmin>tmin&&(tmin=tzmin),tzmax<tmax&&(tmax=tzmax),tmin<maxDist&&tmax>minDist?ray.getPointAtDistance(tmin):void 0)},AABB.prototype.intersectsSphere=function(c,r){1==arguments.length&&(r=c.radius);var s,d=0;return c.x<this.min.x?d=(s=c.x-this.min.x)*s:c.x>this.max.x&&(d+=(s=c.x-this.max.x)*s),c.y<this.min.y?d+=(s=c.y-this.min.y)*s:c.y>this.max.y&&(d+=(s=c.y-this.max.y)*s),c.z<this.min.z?d+=(s=c.z-this.min.z)*s:c.z>this.max.z&&(d+=(s=c.z-this.max.z)*s),d<=r*r},AABB.prototype.intersectsTriangle=function(tri){var v0,v1,v2,normal,e0,e1,e2,f;if(v0=tri.a.sub(this),v1=tri.b.sub(this),v2=tri.c.sub(this),e0=v1.sub(v0),e1=v2.sub(v1),e2=v0.sub(v2),f=e0.getAbs(),this.testAxis(e0.z,-e0.y,f.z,f.y,v0.y,v0.z,v2.y,v2.z,this.extent.y,this.extent.z))return!1;if(this.testAxis(-e0.z,e0.x,f.z,f.x,v0.x,v0.z,v2.x,v2.z,this.extent.x,this.extent.z))return!1;if(this.testAxis(e0.y,-e0.x,f.y,f.x,v1.x,v1.y,v2.x,v2.y,this.extent.x,this.extent.y))return!1;if(f=e1.getAbs(),this.testAxis(e1.z,-e1.y,f.z,f.y,v0.y,v0.z,v2.y,v2.z,this.extent.y,this.extent.z))return!1;if(this.testAxis(-e1.z,e1.x,f.z,f.x,v0.x,v0.z,v2.x,v2.z,this.extent.x,this.extent.z))return!1;if(this.testAxis(e1.y,-e1.x,f.y,f.x,v0.x,v0.y,v1.x,v1.y,this.extent.x,this.extent.y))return!1;if(f=e2.getAbs(),this.testAxis(e2.z,-e2.y,f.z,f.y,v0.y,v0.z,v1.y,v1.z,this.extent.y,this.extent.z))return!1;if(this.testAxis(-e2.z,e2.x,f.z,f.x,v0.x,v0.z,v1.x,v1.z,this.extent.x,this.extent.z))return!1;if(this.testAxis(e2.y,-e2.x,f.y,f.x,v1.x,v1.y,v2.x,v2.y,this.extent.x,this.extent.y))return!1;if(mathUtils.min(v0.x,v1.x,v2.x)>this.extent.x||mathUtils.max(v0.x,v1.x,v2.x)<-this.extent.x)return!1;if(mathUtils.min(v0.y,v1.y,v2.y)>this.extent.y||mathUtils.max(v0.y,v1.y,v2.y)<-this.extent.y)return!1;if(mathUtils.min(v0.z,v1.z,v2.z)>this.extent.z||mathUtils.max(v0.z,v1.z,v2.z)<-this.extent.z)return!1;var d=-(normal=e0.cross(e1)).dot(v0);return!!this.planeBoxOverlap(normal,d,this.extent)},AABB.prototype.planeBoxOverlap=function(normal,d,maxbox){var vmin=new Vec3D,vmax=new Vec3D;return normal.x>0?(vmin.x=-maxbox.x,vmax.x=maxbox.x):(vmin.x=maxbox.x,vmax.x=-maxbox.x),normal.y>0?(vmin.y=-maxbox.y,vmax.y=maxbox.y):(vmin.y=maxbox.y,vmax.y=-maxbox.y),normal.z>0?(vmin.z=-maxbox.z,vmax.z=maxbox.z):(vmin.z=maxbox.z,vmax.z=-maxbox.z),!(normal.dot(vmin)+d>0)&&normal.dot(vmax)+d>=0},AABB.prototype.set=function(a,b,c){return internals.is.AABB(a)?(this.extent.set(a.extent),Vec3D.set.apply(this,[a])):(internals.has.XYZ(a)&&(b=a.y,c=a.z,a=a.a),this.x=a,this.y=b,this.z=c,this.updateBounds(),this)},AABB.prototype.setExtent=function(extent){return this.extent=extent.copy(),this.updateBounds()},AABB.prototype.testAxis=function(a,b,fa,fb,va,vb,wa,wb,ea,eb){var p0=a*va+b*vb,p2=a*wa+b*wb,min,max;p0<p2?(min=p0,max=p2):(min=p2,max=p0);var rad=fa*ea+fb*eb;return min>rad||max<-rad},AABB.prototype.toMesh=function(mesh){var TriangleMesh;void 0===mesh&&(mesh=new(0,require("./mesh/meshCommon").TriangleMesh)("aabb",8,12));var a=this.min,g=this.max,b=new Vec3D(a.x,a.y,g.z),c=new Vec3D(g.x,a.y,g.z),d=new Vec3D(g.x,a.y,a.z),e=new Vec3D(a.x,g.y,a.z),f=new Vec3D(a.x,g.y,g.z),h=new Vec3D(g.x,g.y,a.z),ua=new Vec2D(0,0),ub=new Vec2D(1,0),uc=new Vec2D(1,1),ud=new Vec2D(0,1);return mesh.addFace(a,b,f,ud,uc,ub),mesh.addFace(a,f,e,ud,ub,ua),mesh.addFace(b,c,g,ud,uc,ub),mesh.addFace(b,g,f,ud,ub,ua),mesh.addFace(c,d,h,ud,uc,ub),mesh.addFace(c,h,g,ud,ub,ua),mesh.addFace(d,a,e,ud,uc,ub),mesh.addFace(d,e,h,ud,ub,ua),mesh.addFace(e,f,h,ua,ud,ub),mesh.addFace(f,g,h,ud,uc,ub),mesh.addFace(a,d,b,ud,uc,ua),mesh.addFace(b,d,c,ua,uc,ub),mesh},AABB.prototype.toString=function(){return"<aabb> pos: "+Vec3D.prototype.toString.call(this)+" ext: "+this.extent.toString()},AABB.prototype.updateBounds=function(){return void 0!==this.extent&&(this.min=this.sub(this.extent),this.max=this.add(this.extent)),this},module.exports=AABB},{"../internals":98,"../math/mathUtils":125,"./Vec2D":70,"./Vec3D":71,"./mesh/meshCommon":92}],43:[function(require,module,exports){var Cone=require("./Cone"),AxisAlignedCylinder=function(pos,radius,length){this.pos=void 0===pos?void 0:pos.copy(),this.setRadius(radius),this.setLength(length)};AxisAlignedCylinder.prototype={containsPoint:function(p){throw Error("AxisAlignedCylinder.containsPoint(): not implmented")},getLength:function(){return this.length},getMajorAxis:function(){throw Error("AxisAlignedCylinder.getMajorAxis(): not implemented")},getPosition:function(){return this.pos.copy()},getRadius:function(){return this.radius},setLength:function(length){this.length=length},setPosition:function(pos){this.pos.set(pos)},setRadius:function(radius){this.radius=radius,this.radiusSquared=radius*radius},toMesh:function(a,b,c){var opts={mesh:void 0,steps:12,thetaOffset:0};if(1==arguments.length&&"object"==typeof arguments[0])for(var prop in arguments[0])opts[prop]=arguments[0][prop];else 2==arguments.length&&(opts.steps=arguments[0],opts.thetaOffset=arguments[1]);var cone=new Cone(this.pos,this.getMajorAxis().getVector(),this.radius,this.radius,this.length);return cone.toMesh(opts.mesh,opts.steps,opts.thetaOffset,!0,!0)}},module.exports=AxisAlignedCylinder},{"./Cone":47}],44:[function(require,module,exports){var BernsteinPolynomial=function(res){this.resolution=res;for(var b0=[],b1=[],b2=[],b3=[],t=0,dt=1/(res-1),i=0;i<res;i++){var t1=1-t,t12=t1*t1,t2=t*t;b0[i]=t1*t12,b1[i]=3*t*t12,b2[i]=3*t2*t1,b3[i]=t*t2,t+=dt}this.b0=b0,this.b1=b1,this.b2=b2,this.b3=b3};module.exports=BernsteinPolynomial},{}],45:[function(require,module,exports){module.exports=require("./Ellipse").Circle},{"./Ellipse":49}],46:[function(require,module,exports){var CircleIntersector=function(circle){this.circle=circle,this.isec=void 0};CircleIntersector.prototype={getIntersectionData:function(){return this.isec},intersectsRay:function(ray){this.isec.clear();var q=circle.sub(ray),distSquared=q.magSquared(),v=q.dot(ray.getDirection()),r=circle.getRadius(),d=r*r-(distSquared-v*v);return d>=0&&(this.isec.isIntersection=!0,this.isec.dist=v-Math.sqrt(d),this.isec.pos=ray.getPointAtDistance(isec.dist),this.isec.normal=this.isec.pos.sub(this.circle).normalize()),this.isec.isIntersection}},module.exports=CircleIntersector},{}],47:[function(require,module,exports){var extend=require("../internals").extend,Vec3D=require("./Vec3D"),TriangleMesh=require("./mesh/TriangleMesh");function err(param){throw Error("Missing parameter: "+param)}var Cone=function(pos,dir,rNorth,rSouth,len){var self=this;function process(pos,dir,radiusNorth,radiusSouth,length){Vec3D.apply(self,[pos]),self.dir=dir.getNormalized(),self.radiusNorth=radiusNorth,self.radiusSouth=radiusSouth,self.length=length}"object"==typeof pos&&1===arguments.length?process(pos.pos||pos.position||new Vec3D,pos.dir||pos.direction||err("direction"),pos.rNorth||pos.radiusNorth||err("radiusNorth"),pos.rSouth||pos.radiusSouth||err("radiusSouth"),pos.len||pos.length||err("length")):process(pos,dir,rNorth,rSouth,len)};extend(Cone,Vec3D),Cone.prototype.toMesh=function(args){var opts={mesh:void 0,steps:NaN,thetaOffset:0,topClosed:!0,bottomClosed:!0};if(1==arguments.length)if("object"==typeof arguments[0]){var optionsObject=arguments[0];opts.mesh=optionsObject.mesh,opts.steps=optionsObject.steps||optionsObject.resolution||optionsObject.res,opts.thetaOffset=optionsObject.thetaOffset||opts.thetaOffset,opts.topClosed=optionsObject.topClosed||opts.topClosed,opts.bottomClosed=optionsObject.bottomClosed||opts.bottomClosed}else opts.steps=arguments[0];else 2==arguments.length?(opts.steps=arguments[0],opts.thetaOffset=arguments[1]):5==arguments.length&&(opts.mesh=arguments[0],opts.steps=arguments[1],opts.thetaOffset=arguments[2],opts.topClosed=arguments[3],opts.bottomClosed=arguments[4]);var c=this.add(.01,.01,.01),n=c.cross(this.dir.getNormalized()).normalize(),halfAxis=this.dir.scale(.5*this.length),p=this.sub(halfAxis),q=this.add(halfAxis),south=[],north=[],phi=2*Math.PI/opts.steps,i=0,j=1;for(i=0;i<opts.steps;i++){var theta=i*phi+opts.thetaOffset,nr=n.getRotatedAroundAxis(this.dir,theta);south[i]=nr.scale(this.radiusSouth).addSelf(p),north[i]=nr.scale(this.radiusNorth).addSelf(q)}var numV=2*opts.steps+2,numF=2*opts.steps+(opts.topClosed?opts.steps:0)+(opts.bottomClosed?opts.steps:0),mesh=opts.mesh||new TriangleMesh("cone",numV,numF);for(i=0;i<opts.steps;i++,j++)j==opts.steps&&(j=0),mesh.addFace(south[i],north[i],south[j],void 0,void 0,void 0,void 0),mesh.addFace(south[j],north[i],north[j],void 0,void 0,void 0,void 0),opts.bottomClosed&&mesh.addFace(p,south[i],south[j],void 0,void 0,void 0,void 0),opts.topClosed&&mesh.addFace(north[i],q,north[j],void 0,void 0,void 0,void 0);return mesh},module.exports=Cone},{"../internals":98,"./Vec3D":71,"./mesh/TriangleMesh":87}],48:[function(require,module,exports){var Line2D=require("./Line2D"),Polygon2D=require("./Polygon2D"),ConvexPolygonClipper=function(polygonBounds){this.setBounds(polygonBounds)};ConvexPolygonClipper.prototype={constructor:ConvexPolygonClipper,clipPolygon:function(poly){var points=poly.vertices.slice(0),clipped,boundsEdges=this.bounds.getEdges(),clipEdge,i=0,j=0,_tmp,sign,p,q;for(points.push(points[0]),i=0;i<boundsEdges.length;i++){for(clipped=[],sign=(clipEdge=boundsEdges[i]).classifyPoint(this.boundsCentroid),j=0;j<points.length-1;j++)p=points[j],q=points[j+1],clipEdge.classifyPoint(p)!==sign?clipEdge.classifyPoint(q)===sign&&(clipped.push(this._getClippedPosOnEdge(clipEdge,p,q)),clipped.push(q.copy())):clipEdge.classifyPoint(q)===sign?clipped.push(q.copy()):clipped.push(this._getClippedPosOnEdge(clipEdge,p,q));clipped.length>0&&clipped[0]!==clipped[clipped.length-1]&&clipped.push(clipped[0]),_tmp=points,points=clipped,clipped=_tmp}return new Polygon2D(points).removeDuplicates(.001)},getBounds:function(){return this.bounds},_getClippedPosOnEdge:function(clipEdge,p,q){return clipEdge.intersectLine(new Line2D(p,q)).getPos()},_isKnownVertex:function(list,q){for(var i=0,l=list.length;i<l;i++)if(list[i].equalsWitTolerance(q,.001))return!0;return!1},setBounds:function(bounds){this.bounds=bounds,this.boundsCentroid=this.bounds.getCentroid()}},module.exports=ConvexPolygonClipper},{"./Line2D":52,"./Polygon2D":57}],49:[function(require,module,exports){var extend=require("../internals/extend"),has=require("../internals/has"),is=require("../internals/is"),mathUtils=require("../math/mathUtils"),Vec2D=require("./Vec2D"),Ellipse,Circle;extend(Ellipse=function(a,b,c,d){this.radius=new Vec2D,0===arguments.length?(Vec2D.apply(this,[0,0]),this.setRadii(1,1)):has.XY(a)?(Vec2D.apply(this,[a.x,a.y]),has.XY(b)?this.setRadii(b.x,b.y):this.setRadii(b,c)):void 0===d?void 0===c?(Vec2D.call(this,0,0),this.setRadii(a,b)):(Vec2D.call(this,a,b),this.setRadii(c,c)):(Vec2D.call(this,a,b),this.setRadii(c,d))},Vec2D),Ellipse.prototype.containsPoint=function(p){if(mathUtils.abs(p.x-this.x)>this.radius.x||mathUtils.abs(p.y-this.y)>this.radius.y)return!1;var foci=this.getFoci();return p.distanceTo(foci[0])+p.distanceTo(foci[1])<2*mathUtils.max(this.radius.x,this.radius.y)},Ellipse.prototype.getArea=function(){return mathUtils.PI*this.radius.x*this.radius.y},Ellipse.prototype.getCircumference=function(){return Math.sqrt(.5*this.radius.magSquared())*mathUtils.TWO_PI},Ellipse.prototype.getFoci=function(){return this.radius.x>this.radius.y?[this.sub(this.focus,0),this.add(this.focus,0)]:[this.sub(0,this.focus),this.add(0,this.focus)]},Ellipse.prototype.getRadii=function(){return this.radius.copy()},Ellipse.prototype.setRadii=function(rx,ry){return has.XY(rx)&&(ry=rx.y,rx=rx.x),this.radius.set(rx,ry),this.radius.x>this.radius.y?this.focus=Math.sqrt(this.radius.x*this.radius.x-this.radius.y*this.radius.y):this.focus=Math.sqrt(this.radius.y*this.radius.y-this.radius.x*this.radius.x),this},Ellipse.prototype.toPolygon2D=function(res){for(var Polygon2D,poly=new(require("./Polygon2D")),step=mathUtils.TWO_PI/res,i=0;i<res;i++){var v=Vec2D.fromTheta(i*step).scaleSelf(this.radius).addSelf(this);poly.add(v)}return poly},exports=module.exports=Ellipse,extend(Circle=function(a,b,c){1==arguments.length?is.Circle(a)?Ellipse.apply(this,[a,a.radius.x]):Ellipse.apply(this,[0,0,a]):2==arguments.length?Ellipse.apply(this,[a,b]):Ellipse.apply(this,[a,b,c,c])},Ellipse),Circle.from2Points=function(p1,p2){var m=p1.interpolateTo(p2,.5),distanceTo=m.distanceTo(p1);return new Circle(m,distanceTo)},Circle.from3Points=function(p1,p2,p3){var circle,deltaA=p2.sub(p1),deltaB=p3.sub(p2),centroid,radius;if(mathUtils.abs(deltaA.x)<=1e-7&&mathUtils.abs(deltaB.y)<=1e-7)radius=(centroid=new Vec2D(p2.x+p3.x,p1.y+p2.y).scaleSelf(.5)).distanceTo(p1),circle=new Circle(centroid,radius);else{var aSlope=deltaA.y/deltaA.x,bSlope=deltaB.y/deltaB.x;if(mathUtils.abs(aSlope-bSlope)>1e-7&&0!==aSlope){var x=(aSlope*bSlope*(p1.y-p3.y)+bSlope*(p1.x+p2.x)-aSlope*(p2.x+p3.x))/(2*(bSlope-aSlope)),y=-(x-(p1.x+p2.x)/2)/aSlope+(p1.y+p2.y)/2;radius=(centroid=new Vec2D(x,y)).distanceTo(p1),circle=new Circle(centroid,radius)}}return circle},Circle.newBoundingCircle=function(vertices){for(var origin=new Vec2D,maxD=0,i=0,l=vertices.length;i<l;i++)origin.addSelf(vertices[i]);for(origin.scaleSelf(1/vertices.length),i=0;i<l;i++){var d=origin.distanceToSquared(vertices[i]);d>maxD&&(maxD=d)}return new Circle(origin,Math.sqrt(maxD))},Circle.prototype.containsPoint=function(p){return this.distanceToSquared(p)<=this.radius.x*this.radius.x},Circle.prototype.getCircumference=function(){return mathUtils.TWO_PI*this.radius.x},Circle.prototype.getRadius=function(){return this.radius.x},Circle.prototype.getTangentPoints=function(p){var m=this.interpolateTo(p,.5);return this.intersectsCircle(new Circle(m,m.distanceTo(p)))},Circle.prototype.intersectsCircle=function(c){var res,delta=c.sub(this),d=delta.magnitude(),r1=this.radius.x,r2=c.radius.x;if(d<=r1+r2&&d>=Math.abs(r1-r2)){var a=(r1*r1-r2*r2+d*d)/(2*d);d=1/d;var p=this.add(delta.scale(a*d)),h=Math.sqrt(r1*r1-a*a),i1,i2;delta.perpendicular().scaleSelf(h*d),res=[p.add(delta),p.sub(delta)]}return res},Circle.prototype.setRadius=function(r){return this.setRadii(r,r),this},exports.Circle=Circle},{"../internals/extend":103,"../internals/has":105,"../internals/is":106,"../math/mathUtils":125,"./Polygon2D":57,"./Vec2D":70}],50:[function(require,module,exports){var Vec2D=require("./Vec2D"),IsectData2D=function(isec){void 0!==isec?(this.isIntersection=isec.isIntersection,this.dist=isec.dist,this.pos=isec.pos.copy(),this.dir=isec.dir.copy(),this.normal=isec.normal.copy()):this.clear()};IsectData2D.prototype={clear:function(){this.isIntersection=!1,this.dist=0,this.pos=new Vec2D,this.dir=new Vec2D,this.normal=new Vec2D},toString:function(){var s="isec: "+this.isIntersection;return this.isIntersection&&(s+=" at:"+this.pos+" dist:"+this.dist+" normal:"+this.normal),s}},module.exports=IsectData2D},{"./Vec2D":70}],51:[function(require,module,exports){var Vec3D=require("./Vec3D"),IsectData3D=function(isec){void 0!==isec?(this.isIntersection=isec.isIntersection,this.dist=isec.dist,this.pos=isec.pos.copy(),this.dir=isec.dir.copy(),this.normal=isec.normal.copy()):this.clear()};IsectData3D.prototype={clear:function(){this.isIntersection=!1,this.dist=0,this.pos=new Vec3D,this.dir=new Vec3D,this.normal=new Vec3D},toString:function(){var s="isec: "+this.isIntersection;return this.isIntersection&&(s+=" at:"+this.pos+" dist:"+this.dist+" normal:"+this.normal),s}},module.exports=IsectData3D},{"./Vec3D":71}],52:[function(require,module,exports){var Ray2D=require("./Ray2D"),internals=require("../internals"),mathUtils=require("../math/mathUtils"),Line2D=function(a,b){this.a=a,this.b=b};Line2D.prototype={constructor:Line2D,classifyPoint:function(p){var normal=this.b.sub(this.a).perpendicular(),d=p.sub(this.a).dot(normal);return mathUtils.sign(d)},closestPointTo:function(p){var v=this.b.sub(this.a),t=p.sub(this.a).dot(v)/v.magSquared();return t<0?this.a.copy():t>1?this.b.copy():this.a.add(v.scaleSelf(t))},copy:function(){return new Line2D(this.a.copy(),this.b.copy())},distanceToPoint:function(p){return this.closestPointTo(p).distanceTo(p)},distanceToPointSquared:function(p){return this.closestPointTo(p).distanceToSquared(p)},equals:function(obj){if(this==obj)return!0;if(!internals.is.Line2D(obj))return!1;var l=obj;return(this.a.equals(l.a)||this.a.equals(l.b))&&(this.b.equals(l.b)||this.b.equals(l.a))},getDirection:function(){return this.b.sub(this.a).normalize()},getHeading:function(){return this.b.sub(this.a).heading()},getLength:function(){return this.a.distanceTo(this.b)},getLengthSquared:function(){return this.a.distanceToSquared(this.b)},getMidPoint:function(){return this.a.add(this.b).scaleSelf(.5)},getNormal:function(){return this.b.sub(this.a).perpendicular()},getTheta:function(){return this.a.angleBetween(this.b,!0)},hasEndPoint:function(p){return this.a.equals(p)||this.b.equals(p)},intersectLine:function(l){var Type=Line2D.LineIntersection.Type,isec,denom=(l.b.y-l.a.y)*(this.b.x-this.a.x)-(l.b.x-l.a.x)*(this.b.y-this.a.y),na=(l.b.x-l.a.x)*(this.a.y-l.a.y)-(l.b.y-l.a.y)*(this.a.x-l.a.x),nb=(this.b.x-this.a.x)*(this.a.y-l.a.y)-(this.b.y-this.a.y)*(this.a.x-l.a.x);if(0!==denom){var ua=na/denom,ub=nb/denom,vecI=this.a.interpolateTo(this.b,ua);isec=new Line2D.LineIntersection(ua>=0&&ua<=1&&ub>=0&&ub<=1?Type.INTERSECTING:Type.NON_INTERSECTING,vecI,ua,ub)}else isec=0===na&&0===nb?0===this.distanceToPoint(l.a)?new Line2D.LineIntersection(Type.COINCIDENT,void 0):new Line2D.LineIntersection(Type.COINCIDENT_NO_INTERSECT,void 0):new Line2D.LineIntersection(Type.PARALLEL,void 0);return isec},offsetAndGrowBy:function(offset,scale,ref){var m=this.getMidPoint(),d=this.getDirection(),n=d.getPerpendicular();return void 0!==ref&&m.sub(ref).dot(n)<0&&n.invert(),n.normalizeTo(offset),this.a.addSelf(n),this.b.addSelf(n),d.scaleSelf(scale),this.a.subSelf(d),this.b.addSelf(d),this},scale:function(scale){var delta=.5*(1-scale),newA=this.a.interpolateTo(this.b,delta);return this.b.interpolateToSelf(this.a,delta),this.a.set(newA),this},set:function(a,b){return this.a=a,this.b=b,this},splitIntoSegments:function(segments,stepLength,addFirst){return Line2D.splitIntoSegments(this.a,this.b,stepLength,segments,addFirst)},toRay2D:function(){var Ray2D;return new(require("./Ray2D"))(this.a.copy(),this.b.sub(this.a).normalize())}},Line2D.splitIntoSegments=function(a,b,stepLength,segments,addFirst){void 0===segments&&(segments=[]),addFirst&&segments.push(a.copy());var dist=a.distanceTo(b);if(dist>stepLength)for(var pos=a.copy(),step=b.sub(a).limit(stepLength);dist>stepLength;)pos.addSelf(step),segments.push(pos.copy()),dist-=stepLength;return segments.push(b.copy()),segments},(Line2D.LineIntersection=function(type,pos,ua,ub){this.type=type,this.pos=pos,this.coeff=[ua,ub]}).prototype={getPos:function(){return this.pos?this.pos.copy():void 0},getCoefficients:function(){return this.coeff},getType:function(){return this.type},toString:function(){return"type: "+this.type+" pos: "+this.pos}},Line2D.LineIntersection.Type={COINCIDENT:0,COINCIDENT_NO_INTERSECT:4,PARALLEL:1,NON_INTERSECTING:2,INTERSECTING:3},module.exports=Line2D},{"../internals":98,"../math/mathUtils":125,"./Ray2D":59}],53:[function(require,module,exports){var mathUtils=require("../math/mathUtils"),Ray3D=require("./Ray3D"),Line3D=function(vec_a,vec_b){this.a=vec_a,this.b=vec_b};Line3D.prototype={constructor:Line3D,closestLineTo:function(l){var p43=l.a.sub(l.b);if(p43.isZeroVector())return new Line3D.LineIntersection(Line3D.LineIntersection.Type.NON_INTERSECTING);var p21=this.b.sub(this.a);if(p21.isZeroVector())return new Line3D.LineIntersection(Line3D.LineIntersection.Type.NON_INTERSECTING);var p13=this.a.sub(l.a),d1343=p13.x*p43.x+p13.y*p43.y+p13.z*p43.z,d4321=p43.x*p21.x+p43.y*p21.y+p43.z*p21.z,d1321=p13.x*p21.x+p13.y*p21.y+p13.z*p21.z,d4343=p43.x*p43.x+p43.y*p43.y+p43.z*p43.z,d2121,denom=(p21.x*p21.x+p21.y*p21.y+p21.z*p21.z)*d4343-d4321*d4321;if(Math.abs(denom)<mathUtils.EPS)return new Line3D.LineIntersection(Line3D.LineIntersection.Type.NON_INTERSECTING);var numer,mua=(d1343*d4321-d1321*d4343)/denom,mub=(d1343+d4321*mua)/d4343,pa=this.a.add(p21.scaleSelf(mua)),pb=l.a.add(p43.scaleSelf(mub));return new Line3D.LineIntersection(Line3D.LineIntersection.Type.INTERSECTING,new Line3D(pa,pb),mua,mub)},closestPointTo:function(p){var v=this.b.sub(this.a),t=p.sub(this.a).dot(v)/v.magSquared();return t<0?this.a.copy():t>1?this.b.copy():this.a.add(v.scaleSelf(t))},copy:function(){return new Line3D(this.a.copy(),this.b.copy())},equals:function(obj){return this==obj||typeof obj==Line3D&&((this.a.equals(obj.a)||this.a.equals(l.b))&&(this.b.equals(l.b)||this.b.equals(l.a)))},getDirection:function(){return this.b.sub(this.a).normalize()},getLength:function(){return this.a.distanceTo(this.b)},getLengthSquared:function(){return this.a.distanceToSquared(this.b)},getMidPoint:function(){return this.a.add(this.b).scaleSelf(.5)},getNormal:function(){return this.b.cross(this.a)},hasEndPoint:function(p){return this.a.equals(p)||this.b.equals(p)},offsetAndGrowBy:function(offset,scale,ref){var m=this.getMidPoint(),d=this.getDirection(),n=this.a.cross(d).normalize();return void 0!==ref&&m.sub(ref).dot(n)<0&&n.invert(),n.normalizeTo(offset),this.a.addSelf(n),this.b.addSelf(n),d.scaleSelf(scale),this.a.subSelf(d),this.b.addSelf(d),this},set:function(vec_a,vec_b){return this.a=vec_a,this.b=vec_b,this},splitIntoSegments:function(segments,stepLength,addFirst){return Line3D.splitIntoSegments(this.a,this.b,stepLength,segments,addFirst)},toRay3D:function(){return new Ray3D(this.a.copy(),this.getDirection())},toString:function(){return this.a.toString()+" -> "+this.b.toString()}},Line3D.splitIntoSegments=function(vec_a,vec_b,stepLength,segments,addFirst){void 0===segments&&(segments=[]),addFirst&&segments.push(vec_a.copy());var dist=vec_a.distanceTo(vec_b);if(dist>stepLength)for(var pos=vec_a.copy(),step=vec_b.sub(vec_a).limit(stepLength);dist>stepLength;)pos.addSelf(step),segments.push(pos.copy()),dist-=stepLength;return segments.push(vec_b.copy()),segments},(Line3D.LineIntersection=function(type,line,mua,mub){this.type=type,void 0===mua&&(mua=0),void 0===mub&&(mub=0),this.line=line,this.coeff=[mua,mub]}).prototype={getCoefficient:function(){return this.coeff},getLength:function(){if(void 0!==this.line)return this.line.getLength()},getLine:function(){if(void 0!==this.line)return this.line.copy()},getType:function(){return this.type},isIntersectionInside:function(){return this.type==Line3D.LineIntersection.Type.INTERSECTING&&this.coeff[0]>=0&&this.coeff[0]<=1&&this.coeff[1]>=0&&this.coeff[1]<=1},toString:function(){return"type: "+this.type+" line: "+this.line}},Line3D.LineIntersection.Type={NON_INTERSECTING:0,INTERSECTING:1},module.exports=Line3D},{"../math/mathUtils":125,"./Ray3D":60}],54:[function(require,module,exports){var Vec3D=require("./vectors").Vec3D,Line3D=require("./Line3D"),hasXYZ=require("../internals/has").XYZ,Iterator=require("../internals/Iterator"),LineStrip3D=function(vertices){this.vertices=vertices||[]};LineStrip3D.prototype={constructor:LineStrip3D,add:function(x,y,z){return hasXYZ(x)?this.vertices.push(new Vec3D(x)):this.vertices.push(new Vec3D(x,y,z)),this},get:function(i){return i<0&&(i+=this.vertices.length),this.vertices[i]},getDecimatedVertices:function(step,doAddFinalVertex){!1!==doAddFinalVertex&&(doAddFinalVertex=!0);var uniform=[];if(this.vertices.length<3){if(2!==this.vertices.length)return;new Line3D(this.vertices[0],this.vertices[1]).splitIntoSegments(uniform,step,!0),doAddFinalVertex||uniform.pop()}var arcLen=this.getEstimatedArcLength(),delta=step/arcLen,currIdx=0,currT,t,p,q,frac,i;for(t=0;t<1;t+=delta){for(currT=t*arcLen;currT>=this.arcLenIndex[currIdx];)currIdx++;p=this.get(currIdx-1),q=this.get(currIdx),frac=(currT-this.arcLenIndex[currIdx-1])/(this.arcLenIndex[currIdx]-this.arcLenIndex[currIdx-1]),i=p.interpolateTo(q,frac),uniform.push(i)}return doAddFinalVertex&&uniform.push(this.get(-1).copy()),uniform},getEstimatedArcLength:function(){void 0!==this.arcLenIndex&&this.arcLenIndex.length===this.vertices.length||(this.arcLenIndex=[0]);for(var arcLen=0,p,q,i=1,l=this.vertices.length;i<l;i++)p=this.vertices[i-1],q=this.vertices[i],arcLen+=p.distanceTo(q),this.arcLenIndex[i]=arcLen;return arcLen},getSegments:function(){for(var i=1,num=this.vertices.length,segments=[];i<num;i++)segments.push(new Line3D(this.get(i-1),this.get(i)));return segments},getVertices:function(){return vertices},iterator:function(){return new Iterator(this.vertices)},setVertices:function(vertices){this.vertices=vertices}},module.exports=LineStrip3D},{"../internals/Iterator":99,"../internals/has":105,"./Line3D":53,"./vectors":96}],55:[function(require,module,exports){var mathUtils=require("../math/mathUtils"),internals=require("../internals"),Vec3D=require("./Vec3D"),Matrix4x4=function(v11,v12,v13,v14,v21,v22,v23,v24,v31,v32,v33,v34,v41,v42,v43,v44){this.temp=[],this.matrix=[];var self=this;if(0===arguments.length)this.matrix[0]=[1,0,0,0],this.matrix[1]=[0,1,0,0],this.matrix[2]=[0,0,1,0],this.matrix[3]=[0,0,0,1];else if("number"==typeof v11){var m1=[v11,v12,v13,v14],m2=[v21,v22,v23,v24],m3=[v31,v32,v33,v34],m4=[v41,v42,v43,v44];this.matrix=[m1,m2,m3,m4]}else if(internals.is.Array(v11)){var array=v11;if(9!=array.length&&16!=array.length)throw new Error("Matrix4x4: Array length must == 9 or 16");16==array.length?(this.matrix=[],this.matrix[0]=array.slice(0,4),this.matrix[1]=array.slice(4,8),this.matrix[2]=array.slice(8,12),this.matrix[3]=array.slice(12)):(this.matrix[0]=array.slice(0,3),this.matrix[0][3]=NaN,this.matrix[1]=array.slice(3,6),this.matrix[1][3]=NaN,this.matrix[2]=array.slice(6,9),this.matrix[2][3]=NaN,this.matrix[3]=[NaN,NaN,NaN,NaN])}else if(internals.is.Matrix4x4(v11)){var m=v11,i=0,j=0,lenM,lenMM;if(16==m.matrix.length)for(i=0;i<4;i++)this.matrix[i]=[m.matrix[i][0],m.matrix[i][1],m.matrix[i][2],m.matrix[i][3]];else if(4==m.matrix.length)for(lenM=m.matrix.length,i=0;i<lenM;i++)for(lenMM=m.matrix[i].length,self.matrix[i]=[],j=0;j<lenMM;j++)self.matrix[i][j]=m.matrix[i][j]}else console.error("Matrix4x4: incorrect parameters used to construct new instance")};Matrix4x4.prototype={add:function(rhs){var result;return new Matrix4x4(this).addSelf(rhs)},addSelf:function(m){for(var i=0;i<4;i++){var mi=this.matrix[i],rhsm=m.matrix[i];mi[0]+=rhsm[0],mi[1]+=rhsm[1],mi[2]+=rhsm[2],mi[3]+=rhsm[3]}return this},applyTo:function(v){return this.applyToSelf(new Vec3D(v))},applyToSelf:function(v){for(var i=0;i<4;i++){var m=this.matrix[i];this.temp[i]=v.x*m[0]+v.y*m[1]+v.z*m[2]+m[3]}return v.set(this.temp[0],this.temp[1],this.temp[2]).scaleSelf(1/this.temp[3]),v},copy:function(){return new Matrix4x4(this)},getInverted:function(){return new Matrix4x4(this).invert()},getRotatedAroundAxis:function(axis,theta){return new Matrix4x4(this).rotateAroundAxis(axis,theta)},getRotatedX:function(theta){return new Matrix4x4(this).rotateX(theta)},getRotatedY:function(theta){return new Matrix4x4(this).rotateY(theta)},getRotatedZ:function(theta){return new Matrix4x4(this).rotateZ(theta)},getTransposed:function(){return new Matrix4x4(this).transpose()},identity:function(){var m=this.matrix[0];return m[1]=m[2]=m[3]=0,(m=this.matrix[1])[0]=m[2]=m[3]=0,(m=this.matrix[2])[0]=m[1]=m[3]=0,(m=this.matrix[3])[0]=m[1]=m[2]=0,this.matrix[0][0]=1,this.matrix[1][1]=1,this.matrix[2][2]=1,this.matrix[3][3]=1,this},invert:function(){var tmp=[],src=[],dst=[],mat=this.toArray(),i=0;for(i=0;i<4;i++){var i4=i<<2;src[i]=mat[i4],src[i+4]=mat[i4+1],src[i+8]=mat[i4+2],src[i+12]=mat[i4+3]}tmp[0]=src[10]*src[15],tmp[1]=src[11]*src[14],tmp[2]=src[9]*src[15],tmp[3]=src[11]*src[13],tmp[4]=src[9]*src[14],tmp[5]=src[10]*src[13],tmp[6]=src[8]*src[15],tmp[7]=src[11]*src[12],tmp[8]=src[8]*src[14],tmp[9]=src[10]*src[12],tmp[10]=src[8]*src[13],tmp[11]=src[9]*src[12];var src0=src[0],src1=src[1],src2=src[2],src3=src[3],src4=src[4],src5=src[5],src6=src[6],src7=src[7];dst[0]=tmp[0]*src5+tmp[3]*src6+tmp[4]*src7,dst[0]-=tmp[1]*src5+tmp[2]*src6+tmp[5]*src7,dst[1]=tmp[1]*src4+tmp[6]*src6+tmp[9]*src7,dst[1]-=tmp[0]*src4+tmp[7]*src6+tmp[8]*src7,dst[2]=tmp[2]*src4+tmp[7]*src5+tmp[10]*src7,dst[2]-=tmp[3]*src4+tmp[6]*src5+tmp[11]*src7,dst[3]=tmp[5]*src4+tmp[8]*src5+tmp[11]*src6,dst[3]-=tmp[4]*src4+tmp[9]*src5+tmp[10]*src6,dst[4]=tmp[1]*src1+tmp[2]*src2+tmp[5]*src3,dst[4]-=tmp[0]*src1+tmp[3]*src2+tmp[4]*src3,dst[5]=tmp[0]*src0+tmp[7]*src2+tmp[8]*src3,dst[5]-=tmp[1]*src0+tmp[6]*src2+tmp[9]*src3,dst[6]=tmp[3]*src0+tmp[6]*src1+tmp[11]*src3,dst[6]-=tmp[2]*src0+tmp[7]*src1+tmp[10]*src3,dst[7]=tmp[4]*src0+tmp[9]*src1+tmp[10]*src2,dst[7]-=tmp[5]*src0+tmp[8]*src1+tmp[11]*src2,tmp[0]=src2*src7,tmp[1]=src3*src6,tmp[2]=src1*src7,tmp[3]=src3*src5,tmp[4]=src1*src6,tmp[5]=src2*src5,tmp[6]=src0*src7,tmp[7]=src3*src4,tmp[8]=src0*src6,tmp[9]=src2*src4,tmp[10]=src0*src5,tmp[11]=src1*src4,src0=src[8],src1=src[9],src2=src[10],src3=src[11],src4=src[12],src5=src[13],src6=src[14],src7=src[15],dst[8]=tmp[0]*src5+tmp[3]*src6+tmp[4]*src7,dst[8]-=tmp[1]*src5+tmp[2]*src6+tmp[5]*src7,dst[9]=tmp[1]*src4+tmp[6]*src6+tmp[9]*src7,dst[9]-=tmp[0]*src4+tmp[7]*src6+tmp[8]*src7,dst[10]=tmp[2]*src4+tmp[7]*src5+tmp[10]*src7,dst[10]-=tmp[3]*src4+tmp[6]*src5+tmp[11]*src7,dst[11]=tmp[5]*src4+tmp[8]*src5+tmp[11]*src6,dst[11]-=tmp[4]*src4+tmp[9]*src5+tmp[10]*src6,dst[12]=tmp[2]*src2+tmp[5]*src3+tmp[1]*src1,dst[12]-=tmp[4]*src3+tmp[0]*src1+tmp[3]*src2,dst[13]=tmp[8]*src3+tmp[0]*src0+tmp[7]*src2,dst[13]-=tmp[6]*src2+tmp[9]*src3+tmp[1]*src0,dst[14]=tmp[6]*src1+tmp[11]*src3+tmp[3]*src0,dst[14]-=tmp[10]*src3+tmp[2]*src0+tmp[7]*src1,dst[15]=tmp[10]*src2+tmp[4]*src0+tmp[9]*src1,dst[15]-=tmp[8]*src1+tmp[11]*src2+tmp[5]*src0;var det=1/(src[0]*dst[0]+src[1]*dst[1]+src[2]*dst[2]+src[3]*dst[3]);for(i=0,k=0;i<4;i++)for(var m=this.matrix[i],j=0;j<4;j++)m[j]=dst[k++]*det;return this},multiply:function(a){return"number"==typeof a?new Matrix4x4(this).multiply(a):new Matrix4x4(this).multiplySelf(a)},multiplySelf:function(a){var i=0,m;if("number"==typeof a){for(i=0;i<4;i++)(m=this.matrix[i])[0]*=a,m[1]*=a,m[2]*=a,m[3]*=a;return this}var mm0=a.matrix[0],mm1=a.matrix[1],mm2=a.matrix[2],mm3=a.matrix[3];for(i=0;i<4;i++){m=this.matrix[i];for(var j=0;j<4;j++)this.temp[j]=m[0]*mm0[j]+m[1]*mm1[j]+m[2]*mm2[j]+m[3]*mm3[j];m[0]=this.temp[0],m[1]=this.temp[1],m[2]=this.temp[2],m[3]=this.temp[3]}return this},rotateAroundAxis:function(axis,theta){var x,y,z,s,c,t,tx,ty;return x=axis.x,y=axis.y,z=axis.z,s=Math.sin(theta),tx=(t=1-(c=Math.cos(theta)))*x,ty=t*y,_TEMP.set(tx*x+c,tx*y+s*z,tx*z-s*y,0,tx*y-s*z,ty*y+c,ty*z+s*x,0,tx*z+s*y,ty*z-s*x,t*z*z+c,0,0,0,0,1),this.multiplySelf(_TEMP)},rotateX:function(theta){return _TEMP.identity(),_TEMP.matrix[1][1]=_TEMP.matrix[2][2]=Math.cos(theta),_TEMP.matrix[2][1]=Math.sin(theta),_TEMP.matrix[1][2]=-_TEMP.matrix[2][1],this.multiplySelf(_TEMP)},rotateY:function(theta){return _TEMP.identity(),_TEMP.matrix[0][0]=_TEMP.matrix[2][2]=Math.cos(theta),_TEMP.matrix[0][2]=Math.sin(theta),_TEMP.matrix[2][0]=-_TEMP.matrix[0][2],this.multiplySelf(_TEMP)},rotateZ:function(theta){return _TEMP.identity(),_TEMP.matrix[0][0]=_TEMP.matrix[1][1]=Math.cos(theta),_TEMP.matrix[1][0]=Math.sin(theta),_TEMP.matrix[0][1]=-_TEMP.matrix[1][0],this.multiplySelf(_TEMP)},scale:function(a,b,c){return new Matrix4x4(this).scaleSelf(a,b,c)},scaleSelf:function(a,b,c){return internals.has.XYZ(a)?(b=a.y,c=a.z,a=a.x):void 0!==b&&void 0!==c||(b=a,c=a),_TEMP.identity(),_TEMP.matrix[0][0]=a,_TEMP.matrix[1][1]=b,_TEMP.matrix[2][2]=c,this.multiplySelf(_TEMP)},set:function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var mat;if("number"==typeof a)(mat=this.matrix[0])[0]=a,mat[1]=b,mat[2]=c,mat[3]=d,(mat=this.matrix[1])[0]=e,mat[1]=f,mat[2]=g,mat[3]=h,(mat=this.matrix[2])[0]=i,mat[1]=j,mat[2]=k,mat[3]=l,(mat=this.matrix[3])[0]=m,mat[1]=n,mat[2]=o,mat[3]=p;else for(var it_n=0;it_n<4;it_n++){var mat_n=(mat=this.matrix[it_n]).matrix[it_n];mat[0]=mat_n[0],mat[1]=mat_n[1],mat[2]=mat_n[2],mat[3]=mat_n[3]}return this},setFrustrum:function(left,right,top,bottom,near,far){var rl=right-left,tb=top-bottom,fn=far-near;return this.set(2*near/rl,0,(left+right)/rl,0,0,2*near/tb,(top+bottom)/tb,0,0,0,-(near+far)/fn,-2*near*far/fn,0,0,-1,0)},setOrtho:function(left,right,top,bottom,near,far){var mat=[2/(right-left),0,0,(left+right)/(right-left),0,2/(top-bottom),0,(top+bottom)/(top-bottom),0,0,-2/(far-near),(far+near)/(far-near),0,0,0,1];return this.set.apply(this,mat)},setPerspective:function(fov,aspect,near,far){var y=near*Math.tan(.5*mathUtils.radians(fov)),x=aspect*y;return this.setFrustrum(-x,x,y,-y,near,far)},setPosition:function(x,y,z){return this.matrix[0][3]=x,this.matrix[1][3]=y,this.matrix[2][3]=z,this},setScale:function(sX,sY,sZ){return this.matrix[0][0]=sX,this.matrix[1][1]=sY,this.matrix[2][2]=sZ,this},sub:function(m){return new Matrix4x4(this).subSelf(m)},subSelf:function(mat){for(var i=0;i<4;i++){var m=this.matrix[i],n=mat.matrix[i];m[0]-=n[0],m[1]-=n[1],m[2]-=n[2],m[3]-=n[3]}return this},toArray:function(result){void 0===result&&(result=[]);for(var i=0,k=0;i<4;i++)for(var m=this.matrix[i],j=0;j<4;j++)result[k++]=m[j];return result},toFloatArray:function(result){return new Float32Array(this.toArray(result))},toString:function(){return"| "+this.matrix[0][0]+" "+this.matrix[0][1]+" "+this.matrix[0][2]+" "+this.matrix[0][3]+" |\n| "+this.matrix[1][0]+" "+this.matrix[1][1]+" "+this.matrix[1][2]+" "+this.matrix[1][3]+" |\n| "+this.matrix[2][0]+" "+this.matrix[2][1]+" "+this.matrix[2][2]+" "+this.matrix[2][3]+" |\n| "+this.matrix[3][0]+" "+this.matrix[3][1]+" "+this.matrix[3][2]+" "+this.matrix[3][3]+" |"},toTransposedFloatArray:function(result){void 0===result&&(result=[]);for(var i=0,k=0;i<4;i++)for(var j=0;j<4;j++)result[k++]=this.matrix[j][i];return result},translate:function(dx,dy,dz){return new Matrix4x4(this).translateSelf(dx,dy,dz)},translateSelf:function(dx,dy,dz){return internals.has.XYZ(dx)&&(dy=dx.y,dz=dx.z,dx=dx.x),_TEMP.identity(),_TEMP.setPosition(dx,dy,dz),this.multiplySelf(_TEMP)},transpose:function(){return this.set(this.matrix[0][0],this.matrix[1][0],this.matrix[2][0],this.matrix[3][0],this.matrix[0][1],this.matrix[1][1],this.matrix[2][1],this.matrix[3][1],this.matrix[0][2],this.matrix[1][2],this.matrix[2][2],this.matrix[3][2],this.matrix[0][3],this.matrix[1][3],this.matrix[2][3],this.matrix[3][3])}};var _TEMP=new Matrix4x4;module.exports=Matrix4x4},{"../internals":98,"../math/mathUtils":125,"./Vec3D":71}],56:[function(require,module,exports){var extend=require("../internals").extend,mathUtils=require("../math/mathUtils"),Ray3D=require("./Ray3D"),vectors=require("./vectors"),Vec3D=vectors.Vec3D,Vec2D=vectors.Vec2D,TriangleMesh=require("./mesh/TriangleMesh"),Plane=function(tri_or_origin,norm){var origin,normal;0===arguments.length?(origin=new Vec3D,normal=Vec3D.Y_AXIS.copy()):1==arguments.length?(origin=arguments[0].computeCentroid(),normal=arguments[0].computeNormal()):(origin=arguments[0],normal=arguments[1].getNormalized()),Vec3D.apply(this,[origin]),this.normal=normal};extend(Plane,Vec3D),Plane.Classifier={FRONT:"front",BACK:"back",ON_PLANE:"on plane"},Plane.XY=new Plane(new Vec3D,Vec3D.Z_AXIS),Plane.XZ=new Plane(new Vec3D,Vec3D.Y_AXIS),Plane.YZ=new Plane(new Vec3D,Vec3D.X_AXIS),Plane.prototype.classifyPoint=function(p,tolerance){var d=this.sub(p).normalize().dot(this.normal);return d<-tolerance?Plane.Classifier.FRONT:d>tolerance?Plane.Classifier.BACK:Plane.Classifier.ON_PLANE},Plane.prototype.containsPoint=function(p){return this.classifyPoint(p,mathUtils.EPS)==Plane.Classifier.ON_PLANE},Plane.prototype.getDistanceToPoint=function(p){var sn=this.normal.dot(p.sub(this)),sd=this.normal.magSquared(),isec;return p.add(this.normal.scale(sn/sd)).distanceTo(p)},Plane.prototype.getIntersectionWithRay=function(r){var denom=this.normal.dot(r.getDirection()),u;return denom>mathUtils.EPS?(u=this.normal.dot(this.sub(r))/denom,r.getPointAtDistance(u)):void 0},Plane.prototype.getProjectedPoint=function(p){var dir,proj;return dir=this.normal.dot(this.sub(p))<0?this.normal.getInverted():this.normal,proj=new Ray3D(p,dir).getPointAtDistance(this.getDistanceToPoint(p))},Plane.prototype.intersectRayDistance=function(ray){var d=this.normal.dot(this),numer=this.normal.dot(ray)+d,denom=this.normal.dot(ray.dir);return mathUtils.abs(denom)<mathUtils.EPS?-1:-numer/denom},Plane.prototype.toMesh=function(mesh,size){1===arguments.length&&"number"==typeof arguments[0]&&(size=mesh,mesh=null),mesh=mesh||new TriangleMesh("plane",4,2);var p=this.equalsWithTolerance(Vec3D.ZERO,.01)?this.add(.01,.01,.01):this;size*=.5;var n=p.cross(this.normal).normalizeTo(size),m=n.cross(this.normal).normalizeTo(size),a=this.add(n).addSelf(m),b=this.add(n).subSelf(m),c=this.sub(n).subSelf(m),d=this.sub(n).addSelf(m);return mesh.addFace(a,d,b,void 0,void 0,void 0,void 0),mesh.addFace(b,d,c,void 0,void 0,void 0,void 0),mesh},module.exports=Plane},{"../internals":98,"../math/mathUtils":125,"./Ray3D":60,"./mesh/TriangleMesh":87,"./vectors":96}],57:[function(require,module,exports){var MathUtils=require("../math/mathUtils"),Vec2D=require("./Vec2D"),Line2D=require("./Line2D"),Circle=require("./Circle"),Rect=require("./Rect"),TriangleMesh=require("./mesh/TriangleMesh"),has=require("../internals/has"),is=require("../internals/is"),Polygon2D=function(){var i,l;if(this.vertices=[],arguments.length>1)for(i=0,l=arguments.length;i<l;i++)this.add(arguments[i].copy());else if(1==arguments.length){var arg=arguments[0];if(is.Array(arg))for(i=0,l=arg.length;i<l;i++)this.add(arg[i].copy())}};Polygon2D.prototype={constructor:Polygon2D,add:function(p){if(is.Array(p))for(var i=0,l=p.length;i<l;i++)this.vertices.indexOf(p[i])<0&&this.vertices.push(p[i]);else this.vertices.indexOf(p)<0&&this.vertices.push(p)},center:function(origin){for(var centroid=this.getCentroid(),delta=void 0!==origin?origin.sub(centroid):centroid.invert(),i=0,l=this.vertices.length;i<l;i++)this.vertices[i].addSelf(delta);return this},containsPoint:function(p){var num=this.vertices.length,i=0,j=num-1,oddNodes=!1,px=p.x,py=p.y;for(i=0;i<num;i++){var vi=this.vertices[i],vj=this.vertices[j];(vi.y<py&&vj.y>=py||vj.y<py&&vi.y>=py)&&vi.x+(py-vi.y)/(vj.y-vi.y)*(vj.x-vi.x)<px&&(oddNodes=!oddNodes),j=i}return oddNodes},containsPolygon:function(poly){for(var i=0,num=poly.vertices.length;i<num;i++)if(!this.containsPoint(poly.vertices[i]))return!1;return!0},copy:function(){return new Polygon2D(this.vertices)},flipVertexOrder:function(){return this.vertices.reverse(),this},get:function(i){return i<0&&(i+=this.vertices.length),this.vertices[i]},getApothem:function(){return this.vertices[0].interpolateTo(this.vertices[1],.5).distanceTo(this.getCentroid())},getArea:function(){for(var area=0,numPoints=this.vertices.length,i=0;i<numPoints;i++){var a=this.vertices[i],b=this.vertices[(i+1)%numPoints];area+=a.x*b.y,area-=a.y*b.x}return area*=.5},getBoundingCircle:function(){var Circle;return require("./Circle").newBoundingCircle(this.vertices)},getBounds:function(){var Rect;return require("./Rect").getBoundingRect(this.vertices)},getCentroid:function(){for(var res=new Vec2D,numPoints=this.vertices.length,i=0;i<numPoints;i++){var a=this.vertices[i],b=this.vertices[(i+1)%numPoints],factor=a.x*b.y-b.x*a.y;res.x+=(a.x+b.x)*factor,res.y+=(a.y+b.y)*factor}return res.scale(1/(6*this.getArea()))},getCircumference:function(){for(var circ=0,i=0,num=this.vertices.length;i<num;i++)circ+=this.vertices[i].distanceTo(this.vertices[(i+1)%num]);return circ},getClosestPointTo:function(p){for(var minD=Number.MAX_VALUE,q,c,d,edges=this.getEdges(),i=0,len=edges.length;i<len;i++)(d=(c=edges[i].closestPointTo(p)).distanceToSquared(p))<minD&&(q=c,minD=d);return q},getClosestVertexTo:function(p){for(var minD=Number.MAX_VALUE,q,d,i=0,len=this.vertices.length;i<len;i++)(d=this.vertices[i].distanceToSquared(p))<minD&&(q=this.vertices[i],minD=d);return q},getEdges:function(){for(var num=this.vertices.length,edges=[],i=0;i<num;i++)edges[i]=new Line2D(this.vertices[i],this.vertices[(i+1)%num]);return edges},getNumPoints:function(){return this.getNumVertices()},getNumVertices:function(){return this.vertices.length},getRandomPoint:function(){for(var edges=this.getEdges(),numEdges=edges.length,ea=edges[MathUtils.random(numEdges)],eb;void 0===eb||eb.equals(ea);)eb=edges[MathUtils.random(numEdges)];var p;return ea.a.interpolateTo(ea.b,Math.random()).interpolateToSelf(eb.a.interpolateTo(eb.b,Math.random()),Math.random())},increaseVertexCount:function(count){for(var num=this.vertices.length,longestID=0,maxD=0,i=0,d,m;num<count;){for(longestID=0,maxD=0,i=0;i<num;i++)(d=this.vertices[i].distanceToSquared(this.vertices[(i+1)%num]))>maxD&&(longestID=i,maxD=d);m=this.vertices[longestID].add(this.vertices[(longestID+1)%num]).scaleSelf(.5),this.vertices.splice(longestID+1,0,m),num++}return this},intersectsPolygon:function(poly){if(this.containsPolygon(poly))return!0;for(var edges=this.getEdges(),pedges=poly.getEdges(),i=0,n=edges.length;i<n;i++)for(var j=0,m=pedges.length,e=edges[i];j<m;j++)if(e.intersectLine(pedges[j]).getType()==Line2D.LineIntersection.Type.INTERSECTING)return!0;return!1},isClockwise:function(){return this.getArea()>0},isConvex:function(){for(var isPositive=!1,num=this.vertices.length,prev,next,d0,d1,newIsP,i=0;i<num;i++)if(prev=0===i?num-1:i-1,next=i===num-1?0:i+1,d0=this.vertices[i].sub(this.vertices[prev]),d1=this.vertices[next].sub(this.vertices[i]),newIsP=d0.cross(d1)>0,0===i)isPositive=!0;else if(isPositive!=newIsP)return!1;return!0},_offsetCorner:function(x1,y1,x2,y2,x3,y3,distance,out){var c1=x2,d1=y2,c2=x2,d2=y2,dx1,dy1,dist1,dx2,dy2,dist2,insetX,insetY;if(dx1=x2-x1,dy1=y2-y1,dist1=Math.sqrt(dx1*dx1+dy1*dy1),dx2=x3-x2,dy2=y3-y2,dist2=Math.sqrt(dx2*dx2+dy2*dy2),!(dist1<MathUtils.EPS||dist2<MathUtils.EPS))if(x1+=insetX=dy1*(dist1=distance/dist1),c1+=insetX,y1+=insetY=-dx1*dist1,d1+=insetY,x3+=insetX=dy2*(dist2=distance/dist2),y3+=insetY=-dx2*dist2,d2+=insetY,c1!==(c2+=insetX)||d1!==d2){var l1=new Line2D(new Vec2D(x1,y1),new Vec2D(c1,d1)),l2=new Line2D(new Vec2D(c2,d2),new Vec2D(x3,y3)),isec,ipos=l1.intersectLine(l2).getPos();null===ipos&&void 0===ipos||out.set(ipos)}else out.set(c1,d1)},offsetShape:function(distance){var v=this.vertices,num=v.length-1;if(num>1){for(var startX=v[0].x,startY=v[0].y,c=v[num].x,d=v[num].y,e=startX,f=startY,a,b,i=0;i<num;i++)a=c,b=d,c=e,d=f,e=v[i+1].x,f=v[i+1].y,this._offsetCorner(a,b,c,d,e,f,distance,v[i]);this._offsetCorner(c,d,e,f,startX,startY,distance,v[num])}return this},reduceVertices:function(minEdgeLen){minEdgeLen*=minEdgeLen;var vs=this.vertices,reduced=[],prev=vs[0],num=vs.length-1,vec;reduced.push(prev);for(var i=0;i<num;i++)vec=vs[i],prev.distanceToSquared(vec)>=minEdgeLen&&(reduced.push(vec),prev=vec);return vs[0].distanceToSquared(vs[num])>=minEdgeLen&&reduced.push(vs[num]),this.vertices=reduced,this},removeDuplicates:function(tolerance){for(var equals=tolerance?"equalsWithTolerance":"equals",p,prev,i=0,num=this.vertices.length,last;i<num;i++)(p=this.vertices[i])[equals](prev,tolerance)?(this.vertices.splice(i,1),i--,num--):prev=p;return(num=this.vertices.length)>0&&(last=this.vertices[num-1])[equals](this.vertices[0],tolerance)&&this.vertices.splice(num-1,1),this},rotate:function(theta){for(var i=0,num=this.vertices.length;i<num;i++)this.vertices[i].rotate(theta);return this},scale:function(x,y){if(1==arguments.length){var arg=arguments[0];has.XY(arg)?(x=arg.x,y=arg.y):(x=arg,y=arg)}else{if(2!=arguments.length)throw"Invalid argument(s) passed.";x=arguments[0],y=arguments[1]}for(var i=0,num=this.vertices.length;i<num;i++)this.vertices[i].scaleSelf(x,y);return this},scaleSize:function(x,y){var centroid;if(1===arguments.length){var arg=arguments[0];has.XY(arg)?(x=arg.x,y=arg.y):(x=arg,y=arg)}else{if(2!==arguments.length)throw new Error("Invalid argument(s) passed.");x=arguments[0],y=arguments[1]}centroid=this.getCentroid();for(var i=0,l=this.vertices.length;i<l;i++){var v=this.vertices[i];v.subSelf(centroid).scaleSelf(x,y).addSelf(centroid)}return this},smooth:function(amount,baseWeight){for(var centroid=this.getCentroid(),num=this.vertices.length,filtered=[],i=0,j=num-1,k=1;i<num;i++){var a=this.vertices[i],dir=this.vertices[j].sub(a).addSelf(this.vertices[k].sub(a)).addSelf(a.sub(centroid).scaleSelf(baseWeight));filtered.push(a.add(dir.scaleSelf(amount))),++j==num&&(j=0),++k==num&&(k=0)}return this.vertices=filtered,this},toMesh:function(mesh,centroid2D,extrude){mesh=mesh||new TriangleMesh;var num=this.vertices.length,centroid=(centroid2D=centroid2D||this.getCentroid()).to3DXY();centroid.z=extrude;for(var bounds=this.getBounds(),boundScale=new Vec2D(1/bounds.width,1/bounds.height),uvC=centroid2D.sub(bounds.getTopLeft()).scaleSelf(boundScale),a,b,uvA,uvB,i=1;i<=num;i++)a=this.vertices[i%num],b=this.vertices[i-1],uvA=a.sub(bounds.getTopLeft()).scaleSelf(boundScale),uvB=b.sub(bounds.getTopLeft()).scaleSelf(boundScale),mesh.addFace(centroid,a.to3DXY(),b.to3DXY(),uvC,uvA,uvB);return mesh},toPolygon2D:function(){return this},toString:function(){for(var s="",i=0;i<this.vertices.length;i++)s+=this.vertices[i],i<this.vertices.length-1&&(s+=", ");return s},translate:function(){var x,y;if(1==arguments.length&&has.XY(arguments[0]))x=arguments[0].x,y=arguments[0].y;else{if(2!=arguments.length)throw"Invalid argument(s) passed.";x=arguments[0],y=arguments[1]}for(var i=0,num=this.vertices.length;i<num;i++)this.vertices[i].addSelf(x,y);return this}},Polygon2D.fromBaseEdge=function(baseA,baseB,res){for(var theta=-(MathUtils.PI-MathUtils.PI*(res-2)/res),dir=baseB.sub(baseA),prev=baseB,poly=new Polygon2D(baseA,baseB),p,i=0;i<res-1;i++)p=prev.add(dir.getRotated(theta*i)),poly.add(p),prev=p;return poly},Polygon2D.fromEdgeLength=function(len,res){var Circle;return new(require("./Circle"))(Polygon2D.getRadiusForEdgeLength(len,res)).toPolygon2D(res)},Polygon2D.getRadiusForEdgeLength=function(len,res){return len/(2*MathUtils.sin(MathUtils.PI/res))},module.exports=Polygon2D},{"../internals/has":105,"../internals/is":106,"../math/mathUtils":125,"./Circle":45,"./Line2D":52,"./Rect":62,"./Vec2D":70,"./mesh/TriangleMesh":87}],58:[function(require,module,exports){var mathUtils=require("../math/mathUtils"),Matrix4x4=require("./Matrix4x4"),Quaternion=function(qw,vx,y,z){4==arguments.length?(this.w=qw,this.x=vx,this.y=y,this.z=z):2==arguments.length?(this.x=vx.x,this.y=vx.y,this.z=vx.z,this.w=qw):1==arguments.length&&(this.w=q.w,this.x=q.x,this.y=q.y,this.z=q.z)};Quaternion.prototype={add:function(q){return new Quaternion(this.x+q.x,this.y+q.y,this.z+q.z,this.w+q.w)},addSelf:function(q){return this.x+=q.x,this.y+=q.y,this.z+=q.z,this},copy:function(){return new Quaternion(this.w,this.x,this.y,this.z)},dot:function(q){return this.x*q.x+this.y*q.y+this.z*q.z+this.w*q.w},getConjugate:function(){var q=new Quaternion;return q.x=-this.x,q.y=-this.y,q.z=-this.z,q.w=w,q},identity:function(){return this.w=1,this.x=0,this.y=0,this.z=0,this},interpolateTo:function(target,t,is){return 3==arguments.length?this.copy().interpolateTo(target,is.interpolate(0,1,t)):this.copy().interpolateToSelf(target,t)},interpolateToSelf:function(target,t,is){3==arguments.length&&(t=is.interpolate(0,1,t));var scale,invscale,dot=mathUtils.clip(this.dot(target),-1,1);if(1-dot>=mathUtils.EPS){var theta=Math.acos(dot),invsintheta=1/Math.sin(theta);scale=Math.sin(theta*(1-t))*invsintheta,invscale=Math.sin(theta*t)*invsintheta}else scale=1-t,invscale=t;return dot<0?(this.w=scale*this.w-invscale*target.w,this.x=scale*this.x-invscale*target.x,this.y=scale*this.y-invscale*target.y,this.z=scale*this.z-invscale*target.z):(this.w=scale*w+invscale*target.w,this.x=scale*x+invscale*target.x,this.y=scale*y+invscale*target.y,this.z=scale*z+invscale*target.z),this},magnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},multiply:function(q2){var res=new Quaternion;return res.w=this.w*q2.w-x*q2.x-y*q2.y-z*q2.z,res.x=this.w*q2.x+x*q2.w+y*q2.z-z*q2.y,res.y=this.w*q2.y+y*q2.w+z*q2.x-x*q2.z,res.z=this.w*q2.z+z*q2.w+x*q2.y-y*q2.x,res},normalize:function(){var mag=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return mag>mathUtils.EPS&&(mag=1/mag,this.x*=mag,this.y*=mag,this.z*=mag,this.w*=mag),this},scale:function(t){return new Quaternion(this.x*t,this.y*t,this.z*t,this.w*t)},scaleSelf:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},set:function(w,x,y,z){return 4==arguments.length?(this.w=w,this.x=x,this.y=y,this.z=z):2==arguments.length?(this.w=w,this.x=v.x,this.y=v.y,this.z=v.z):(this.w=q.w,this.x=q.x,this.y=q.y,this.z=q.z),this},sub:function(q){return new Quaternion(this.x-q.x,this.y-q.y,this.z-q.z,this.w-q.w)},subSelf:function(q){return this.x-=q.x,this.y-=q.y,this.z-=q.z,this.w-=q.w,this},toArray:function(){return[this.w,this.x,this.y,this.z]},toAxisAngle:function(){var res=[],sa=Math.sqrt(1-this.w*this.w);return sa=sa<mathUtils.EPS?1:1/sa,res[0]=2*Math.acos(this.w),res[1]=this.x*sa,res[2]=this.y*sa,res[3]=this.z*sa,res},toMatrix4x4:function(result){void 0===result&&(result=new Matrix4x4);var x2=this.x+this.x,y2=this.y+this.y,z2=this.z+this.z,xx=this.x*x2,xy=this.x*y2,xz=this.x*z2,yy=this.y*y2,yz=this.y*z2,zz=this.z*z2,wx=this.w*x2,wy=this.w*y2,wz=this.w*z2,st=x2+","+y2+","+z2+","+xx+","+xy+","+xz+","+yy+","+yz+","+zz+","+wx+","+wy+","+wz;return result.set(1-(yy+zz),xy-wz,xz+wy,0,xy+wz,1-(xx+zz),yz-wx,0,xz-wy,yz+wx,1-(xx+yy),0,0,0,0,1)},toString:function(){return"{axis: ["+this.x+","+this.y+","+this.z+"], w: "+this.w+"}"}},Quaternion.DOT_THRESHOLD=.9995,Quaternion.createFromAxisAngle=function(axis,angle){angle*=.5;var sin=mathUtils.sin(angle),cos=mathUtils.cos(angle),q;return new Quaternion(cos,axis.getNormalizedTo(sin))},Quaternion.createFromEuler=function(pitch,yaw,roll){pitch*=.5,yaw*=.5,roll*=.5;var sinPitch=mathUtils.sin(pitch),cosPitch=mathUtils.cos(pitch),sinYaw=mathUtils.sin(yaw),cosYaw=mathUtils.cos(yaw),sinRoll=mathUtils.sin(roll),cosRoll=mathUtils.cos(roll),cosPitchCosYaw=cosPitch*cosYaw,sinPitchSinYaw=sinPitch*sinYaw,q=new Quaternion;return q.x=sinRoll*cosPitchCosYaw-cosRoll*sinPitchSinYaw,q.y=cosRoll*sinPitch*cosYaw+sinRoll*cosPitch*sinYaw,q.z=cosRoll*cosPitch*sinYaw-sinRoll*sinPitch*cosYaw,q.w=cosRoll*cosPitchCosYaw+sinRoll*sinPitchSinYaw,q},Quaternion.createFromMatrix=function(m){var s=0,q=[],trace=m.matrix[0][0]+m.matrix[1][1]+m.matrix[2][2];if(trace>0)s=Math.sqrt(trace+1),q[3]=.5*s,s=.5/s,q[0]=m.matrix[1][2]-m.matrix[2][1]*s,q[1]=m.matrix[2][0]-m.matrix[0][2]*s,q[2]=m.matrix[0][1]-m.matrix[1][0]*s;else{var nxt=[1,2,0],i=0,j=0,k=0;m.matrix[1][1]>m.matrix[0][0]&&(i=1),m.matrix[2][2]>m.matrix[i][i]&&(i=2),k=nxt[j=nxt[i]],s=Math.sqrt(m.matrix[i][i]-(m.matrix[j][j]+m.matrix[k][k])+1),q[i]=.5*s,s=.5/s,q[3]=(m.matrix[j][k]-m.matrix[k][j])*s,q[j]=(m.matrix[i][j]+m.matrix[j][i])*s,q[k]=(m.matrix[i][k]+m.matrix[k][i])*s}return new Quaternion(q[3],q[0],q[1],q[2])},Quaternion.getAlignmentQuat=function(dir,forward){var target=dir.getNormalized(),axis=forward.cross(target),length=axis.magnitude()+1e-4,angle=Math.atan2(length,forward.dot(target));return this.createFromAxisAngle(axis,angle)},module.exports=Quaternion},{"../math/mathUtils":125,"./Matrix4x4":55}],59:[function(require,module,exports){var extend=require("../internals").extend,Vec2D=require("./Vec2D"),Line2D=require("./Line2D"),Ray2D=function(a,b,d){var o,dir;3==arguments.length?(Vec2D.apply(this,[a,b]),this.dir=d.getNormalized()):2==arguments.length?(Vec2D.apply(this,[a]),this.dir=b.getNormalized()):0===arguments.length&&(Vec2D.apply(this),this.dir=Vec2D.Y_AXIS.copy())};extend(Ray2D,Vec2D),Ray2D.prototype.getDirection=function(){return this.dir.copy()},Ray2D.prototype.getDistanceToPoint=function(p){var sp=p.sub(this);return sp.distanceTo(this.dir.scale(sp.dot(this.dir)))},Ray2D.prototype.getPointAtDistance=function(dist){return this.add(this.dir.scale(dist))},Ray2D.prototype.setDirection=function(d){return this.dir.set(d).normalize(),this},Ray2D.prototype.toLine2DWithPointAtDistance=function(dist){var Line2D;return new(require("./Line2D"))(this,this.getPointAtDistance(dist))},Ray2D.prototype.toString=function(){return"origin: "+Vec2D.prototype.toString.apply(this)+" dir: "+this.dir},module.exports=Ray2D},{"../internals":98,"./Line2D":52,"./Vec2D":70}],60:[function(require,module,exports){var extend=require("../internals").extend,Vec3D=require("./Vec3D"),Line3D=require("./Line3D"),Ray3D=function(a,b,c,d){var o,dir;4==arguments.length?(o=new Vec3D(a,b,c),dir=d):2==arguments.length?(o=a,dir=b):(o=new Vec3D,dir=Vec3D.Y_AXIS.copy()),Vec3D.apply(this,[o]),this.dir=dir};extend(Ray3D,Vec3D),Ray3D.prototype.getDirection=function(){return this.dir.copy()},Ray3D.prototype.getDistanceToPoint=function(p){var sp=p.sub(this);return sp.distanceTo(this.dir.scale(sp.dot(this.dir)))},Ray3D.prototype.getPointAtDistance=function(dist){return this.add(this.dir.scale(dist))},Ray3D.prototype.setDirection=function(d){return this.dir.set(d).normalize(),this},Ray3D.prototype.toLine3DWithPointAtDistance=function(dist){return new(Line3D=require("./Line3D"))(this,this.getPointAtDistance(dist))},Ray3D.prototype.toString=function(){return"origin: "+this.parent.toString.call(this)+" dir: "+this.dir},module.exports=Ray3D},{"../internals":98,"./Line3D":53,"./Vec3D":71}],61:[function(require,module,exports){var IsectData3D=require("./IsectData3D"),mathUtils=require("../math/mathUtils"),Ray3DIntersector;(Ray3DIntersector=function(ray){this.ray=ray,this.isec=new IsectData3D}).prototype={getIntersectionData:function(){return this.isec},intersectsRay:function(other){var n=this.ray.dir.cross(other.dir),sr=this.ray.sub(other),absX=mathUtils.abs(n.x),absY=mathUtils.abs(n.y),absZ=mathUtils.abs(n.z),t;return t=absZ>absX&&absZ>absY?(sr.x*other.dir.y-sr.y*other.dir.x)/n.z:absX>absY?(sr.y*other.dir.z-sr.z*other.dir.y)/n.x:(sr.z*other.dir.x-sr.x*other.dir.z)/n.y,this.isec.isIntersection=t<=mathUtils.EPS&&!isFinite(t),this.isec.pos=this.ray.getPointAtDistance(-t),this.isec.isIntersection}},module.exports=Ray3DIntersector},{"../math/mathUtils":125,"./IsectData3D":51}],62:[function(require,module,exports){var internals=require("../internals"),mathUtils=require("../math/mathUtils"),Vec2D=require("./Vec2D"),Line2D=require("./Line2D"),Rect=function(a,b,width,height){if(2===arguments.length){if(!internals.has.XY(a))throw new Error("Rect received incorrect parameters");this.x=a.x,this.y=a.y,this.width=b.x-this.x,this.height=b.y-this.y}else if(4==arguments.length)this.x=a,this.y=b,this.width=width,this.height=height;else if(1===arguments.length){var o=arguments[0];internals.has.XYWidthHeight(o)&&(this.x=o.x,this.y=o.y,this.width=o.width,this.height=o.height)}else if(arguments.length>0)throw new Error("Rect received incorrect parameters")};Rect.fromCenterExtent=function(center,extent){return new Rect(center.sub(extent),center.add(extent))},Rect.getBoundingRect=function(points){for(var first=points[0],bounds=new Rect(first.x,first.y,0,0),i=1,num=points.length;i<num;i++)bounds.growToContainPoint(points[i]);return bounds},Rect.prototype={containsPoint:function(p){var px=p.x,py=p.y;return!(px<this.x||px>=this.x+this.width)&&!(py<this.y||py>=this.y+this.height)},copy:function(){return new Rect(this.x,this.y,this.width,this.height)},getArea:function(){return this.width*this.height},getAspect:function(){return this.width/this.height},getBottom:function(){return this.y+this.height},getBottomRight:function(){return new Vec2D(this.x+this.width,this.y+this.height)},getCentroid:function(){return new Vec2D(this.x+.5*this.width,this.y+.5*this.height)},getDimensions:function(){return new Vec2D(this.width,this.height)},getEdge:function(id){var edge;switch(id){case 0:edge=new Line2D(new Vec2D(this.x,this.y),new Vec2D(this.x+this.width,this.y));break;case 1:edge=new Line2D(new Vec2D(this.x+this.width,this.y),new Vec2D(this.x+this.width,this.y+this.height));break;case 2:edge=new Line2D(new Vec2D(this.x,this.y+this.height),new Vec2D(this.x+this.width,this.y+this.height));break;case 3:edge=new Line2D(new Vec2D(this.x,this.y),new Vec2D(this.x,this.y+this.height));break;default:throw new Error("edge ID needs to be 0...3")}return edge},getLeft:function(){return this.x},getRight:function(){return this.x+this.width},getTop:function(){return this.y},getTopLeft:function(){return new Vec2D(this.x,this.y)},growToContainPoint:function(p){return this.containsPoint(p)||(p.x<this.x?(this.width=this.getRight()-p.x,this.x=p.x):p.x>this.getRight()&&(this.width=p.x-this.x),p.y<this.y?(this.height=this.getBottom()-p.y,this.y=p.y):p.y>this.getBottom()&&(this.height=p.y-this.y)),this},intersectsRay:function(ray,minDist,maxDist){var invDir=ray.getDirection().reciprocal(),signDirX=invDir.x<0,signDirY=invDir.y<0,min=this.getTopLeft(),max=this.getBottomRight(),bbox=signDirX?max:min,tmin=(bbox.x-ray.x)*invDir.x,tmax=((bbox=signDirX?min:max).x-ray.x)*invDir.x,tymin=((bbox=signDirY?max:min).y-ray.y)*invDir.y,tymax=((bbox=signDirY?min:max).y-ray.y)*invDir.y;if(!(tmin>tymax||tymin>tmax))return tymin>tmin&&(tmin=tymin),tymax<tmax&&(tmax=tymax),tmin<maxDist&&tmax>minDist?ray.getPointAtDistance(tmin):void 0},intersectsRect:function(r){return!(this.x>r.x+r.width||this.x+this.width<r.x||this.y>r.y+r.height||this.y+this.height<r.y)},scale:function(s){var c=this.getCentroid();return this.width*=s,this.height*=s,this.x=c.x-.5*this.width,this.y=c.y-.5*this.height,this},set:function(x,y,width,height){if(1===arguments.length)this.y=x.y,this.width=x.width,this.height=x.height,this.x=x.x;else{if(4!==arguments.length)throw new Error("Rect set() received wrong parameters");this.x=x,this.y=y,this.width=width,this.height=height}},setDimensions:function(dim){return 2==arguments.length&&(dim={x:arguments[0],y:arguments[1]}),this.width=dim.x,this.height=dim.y,this},setPosition:function(pos){return this.x=pos.x,this.y=pos.y,this},toPolygon2D:function(){var Polygon2D,poly=new(require("./Polygon2D"));return poly.add(new Vec2D(this.x,this.y)),poly.add(new Vec2D(this.x+this.width,this.y)),poly.add(new Vec2D(this.x+this.width,this.y+this.height)),poly.add(new Vec2D(this.x,this.y+this.height)),poly},toString:function(){return"rect: {x: "+this.x+", y: "+this.y+", width: "+this.width+", height: "+this.height+"}"},union:function(r){var tmp=mathUtils.max(this.x+this.width,r.x+r.width);return this.x=mathUtils.min(this.x,r.x),this.width=tmp-this.x,tmp=mathUtils.max(this.y+this.height,r.y+r.height),this.y=mathUtils.min(this.y,r.y),this.height=tmp-this.y,this}},module.exports=Rect},{"../internals":98,"../math/mathUtils":125,"./Line2D":52,"./Polygon2D":57,"./Vec2D":70}],63:[function(require,module,exports){var Sphere,SphereFunction,internals,meshCommon,Vec3D;internals=require("../internals"),meshCommon=require("./mesh/meshCommon"),Vec3D=require("./Vec3D"),Sphere=function(a,b){void 0===a?(Vec3D.apply(this,[new Vec3D]),this.radius=1):internals.has.XYZ(a)?(Vec3D.apply(this,[a]),internals.is.Sphere(a)?this.radius=a.radius:this.radius=b):(Vec3D.apply(this,[new Vec3D]),this.radius=a)},internals.extend(Sphere,Vec3D),Sphere.prototype.containsPoint=function(p){var d;return this.sub(p).magSquared()<=this.radius*this.radius},Sphere.prototype.intersectRay=function(ray){var result,a,b,t,q=ray.sub(this),distSquared=q.magSquared(),v=-q.dot(ray.getDirection()),d=this.radius*this.radius-(distSquared-v*v);return d>=0&&(b=v-(d=Math.sqrt(d)),(a=v+d)<0&&b<0||(a>0&&b>0?a>b&&(t=a,a=b,b=t):b>0&&(t=a,a=b,b=t)),result=[a,b]),result},Sphere.prototype.intersectSphereTriangle=function(t,result){var v;return(result.set(t.closestPointOnSurface(this)),result.sub(this).magSquared()<=this.radius*this.radius)},Sphere.prototype.tangentPlaneNormalAt=function(q){return this.sub(q).normalize()},Sphere.prototype.toMesh=function(){var opts={mesh:void 0,resolution:0};1===arguments.length?"object"==typeof arguments[0]?(opts.mesh=arguments[0].mesh,opts.resolution=arguments[0].res||arguments[0].resolution):opts.resolution=arguments[0]:(opts.mesh=arguments[0],opts.resolution=arguments[1]);var builder=new meshCommon.SurfaceMeshBuilder(new SphereFunction(this));return builder.createMesh(opts.mesh,opts.resolution,1)},function(Sphere){var mathUtils=require("../math/mathUtils"),Vec3D=require("./Vec3D"),internals=require("../internals");(SphereFunction=function(sphere_or_radius){void 0===sphere_or_radius&&(this.sphere=new Sphere(new Vec3D,1)),internals.is.Sphere(sphere_or_radius)?this.sphere=sphere_or_radius:this.sphere=new Sphere(new Vec3D,sphere_or_radius),this.phiRange=mathUtils.PI,this.thetaRange=mathUtils.TWO_PI}).prototype={computeVertexFor:function(p,phi,theta){phi-=mathUtils.HALF_PI;var cosPhi=mathUtils.cos(phi),cosTheta=mathUtils.cos(theta),sinPhi=mathUtils.sin(phi),sinTheta=mathUtils.sin(theta),t=mathUtils.sign(cosPhi)*mathUtils.abs(cosPhi);return p.x=t*mathUtils.sign(cosTheta)*mathUtils.abs(cosTheta),p.y=mathUtils.sign(sinPhi)*mathUtils.abs(sinPhi),p.z=t*mathUtils.sign(sinTheta)*mathUtils.abs(sinTheta),p.scaleSelf(this.sphere.radius).addSelf(this.sphere)},getPhiRange:function(){return this.phiRange},getPhiResolutionLimit:function(res){return res},getThetaRange:function(){return this.thetaRange},getThetaResolutionLimit:function(res){return res},setMaxPhi:function(max){this.phiRange=mathUtils.min(max/2,mathUtils.PI)},setMaxTheta:function(max){this.thetaRange=mathUtils.min(max,mathUtils.TWO_PI)}}}(Sphere),Sphere.SphereFunction=SphereFunction,module.exports=Sphere},{"../internals":98,"../math/mathUtils":125,"./Vec3D":71,"./mesh/meshCommon":92}],64:[function(require,module,exports){var Vec2D=require("./Vec2D"),is=require("../internals/is"),BernsteinPolynomial=require("./BernsteinPolynomial"),Spline2D=function(points,bernsteinPoly,tightness){1===arguments.length&&!is.Array(points)&&is.Object(points)&&(bernsteinPoly=bernsteinPoly||points.bernsteinPoly,tightness=tightness||points.tightness,points=points.points);var i=0,l;if(this.pointList=[],"number"!=typeof tightness&&(tightness=Spline2D.DEFAULT_TIGHTNESS),this.setTightness(tightness),this.bernstein=bernsteinPoly,void 0!==points)for(i=0,l=points.length;i<l;i++)this.add(points[i].copy());for(this.coeffA=[],this.delta=[],this.bi=[],i=0;i<this.numP;i++)this.coeffA[i]=new Vec2D,this.delta[i]=new Vec2D,this.bi[i]=0;this.bi=[]};Spline2D.prototype={add:function(p){return this.pointList.push(p.copy()),this.numP=this.pointList.length,this},computeVertices:function(res){this.updateCoefficients(),res<1&&(res=1),res++,void 0!==this.bernstein&&this.bernstein.resolution==res||(this.bernstein=new BernsteinPolynomial(res));var bst=this.bernstein;this.findCPoints();var deltaP=new Vec2D,deltaQ=new Vec2D;res--;var verticeCount=(this.numP-1)*res+1;void 0!==this.vertices&&this.vertices.length==verticeCount||(this.vertices=Array.apply(null,Array(verticeCount)).map((function(){return new Vec2D})));for(var vertexIdx=0,i=0;i<this.numP-1;i++){var p=this.points[i],q=this.points[i+1];deltaP.x=this.delta[i].x+p.x,deltaP.y=this.delta[i].y+p.y,deltaQ.x=q.x-this.delta[i+1].x,deltaQ.y=q.y-this.delta[i+1].y;for(var k=0;k<res;k++){var x=p.x*bst.b0[k]+deltaP.x*bst.b1[k]+deltaQ.x*bst.b2[k]+q.x*bst.b3[k],y=p.y*bst.b0[k]+deltaP.y*bst.b1[k]+deltaQ.y*bst.b2[k]+q.y*bst.b3[k];this.vertices[vertexIdx].x=x,this.vertices[vertexIdx].y=y,vertexIdx++}}return this.vertices[vertexIdx].x=this.vertices[vertexIdx-1].x,this.vertices[vertexIdx].y=this.vertices[vertexIdx-1].y,this.vertices},findCPoints:function(){var i,p0,p2,d0;for(this.bi[1]=-.25,p0=this.pointList[0],p2=this.pointList[2],d0=this.delta[0],this.coeffA[1].x=(p2.x-p0.x-d0.x)*this.tightness,this.coeffA[1].y=(p2.y-p0.y-d0.y)*this.tightness,i=2;i<this.numP-1;i++)this.bi[i]=-1/(this.invTightness+this.bi[i-1]),this.coeffA[i].x=-(this.points[i+1].x-this.points[i-1].x-this.coeffA[i-1].x)*this.bi[i],this.coeffA[i].y=-(this.points[i+1].y-this.points[i-1].y-this.coeffA[i-1].y)*this.bi[i];for(i=this.numP-2;i>0;i--)this.delta[i].x=this.coeffA[i].x+this.delta[i+1].x*this.bi[i],this.delta[i].y=this.coeffA[i].y+this.delta[i+1].y*this.bi[i]},getDecimatedVertices:function(step,doAddFinalVertex){void 0===doAddFinalVertex&&(doAddFinalVertex=!0),(void 0===this.vertices||this.vertices.length<2)&&this.computeVertices(Spline2D.DEFAULT_RES);for(var arcLen=this.getEstimatedArcLength(),uniform=[],delta=step/arcLen,currIdx=0,t=0;t<1;t+=delta){for(var currT=t*arcLen;currT>=this.arcLenIndex[currIdx];)currIdx++;var p=this.vertices[currIdx-1],q=this.vertices[currIdx],frac=(currT-this.arcLenIndex[currIdx-1])/(this.arcLenIndex[currIdx]-this.arcLenIndex[currIdx-1]),i=p.interpolateTo(q,frac);uniform.push(i)}return doAddFinalVertex&&uniform.push(this.vertices[this.vertices.length-1]),uniform},getEstimatedArcLength:function(){var len,arcLen=0;void 0===this.arcLenIndex||void 0!==this.arcLenIndex&&this.arcLenIndex.length!=this.vertices.length?(this.arcLenIndex=[0],len=this.vertices.length):len=this.arcLenIndex.length;for(var i=1;i<len;i++){var p=this.vertices[i-1],q=this.vertices[i];arcLen+=p.distanceTo(q),this.arcLenIndex[i]=arcLen}return arcLen},getNumPoints:function(){return this.numP},getPointList:function(){return this.pointList},getTightness:function(){return this.tightness},setPointList:function(plist){return this.pointList=plist.slice(0),this},setTightness:function(tight){return this.tightness=tight,this.invTightness=1/this.tightness,this},updateCoefficients:function(){if(this.numP=this.pointList.length,void 0===this.points||void 0!==this.points&&this.points.length!=this.numP){this.coeffA=[],this.delta=[],this.bi=[];for(var i=0;i<this.numP;i++)this.coeffA[i]=new Vec2D,this.delta[i]=new Vec2D;this.setTightness(this.tightness)}this.points=this.pointList.slice(0)}},Spline2D.DEFAULT_TIGHTNESS=.25,Spline2D.DEFAULT_RES=16,module.exports=Spline2D},{"../internals/is":106,"./BernsteinPolynomial":44,"./Vec2D":70}],65:[function(require,module,exports){var Vec3D=require("./Vec3D"),is=require("../internals/is"),BernsteinPolynomial=require("./BernsteinPolynomial"),Spline3D=function(points,bernsteinPoly,tightness){1===arguments.length&&!is.Array(points)&&is.Object(points)&&(bernsteinPoly=bernsteinPoly||points.bernsteinPoly,tightness=tightness||points.tightness,points=points.points);var i=0,l;if(this.pointList=[],"number"!=typeof tightness&&(tightness=Spline3D.DEFAULT_TIGHTNESS),this.setTightness(tightness),this.bernstein=bernsteinPoly,void 0!==points)for(i=0,l=points.length;i<l;i++)this.add(points[i].copy());for(this.coeffA=[],this.delta=[],this.bi=[],i=0;i<this.numP;i++)this.coeffA[i]=new Vec3D,this.delta[i]=new Vec3D,this.bi[i]=0;this.bi=[]};Spline3D.prototype={add:function(p){return this.pointList.push(p.copy()),this.numP=this.pointList.length,this},computeVertices:function(res){this.updateCoefficients(),res<1&&(res=1),res++,void 0!==this.bernstein&&this.bernstein.resolution==res||(this.bernstein=new BernsteinPolynomial(res));var bst=this.bernstein;this.vertices=[],this.findCPoints();var deltaP=new Vec3D,deltaQ=new Vec3D;res--;for(var i=0;i<this.numP-1;i++){var p=this.points[i],q=this.points[i+1];deltaP.set(this.delta[i]).addSelf(p),deltaQ.set(q).subSelf(this.delta[i+1]);for(var k=0;k<res;k++){var x=p.x*bst.b0[k]+deltaP.x*bst.b1[k]+deltaQ.x*bst.b2[k]+q.x*bst.b3[k],y=p.y*bst.b0[k]+deltaP.y*bst.b1[k]+deltaQ.y*bst.b2[k]+q.y*bst.b3[k],z=p.z*bst.b0[k]+deltaP.z*bst.b1[k]+deltaQ.z*bst.b2[k]+q.z*bst.b3[k];this.vertices.push(new Vec3D(x,y,z))}}return this.vertices.push(this.points[this.points.length-1].copy()),this.vertices},findCPoints:function(){var i,p0,p2,d0;for(this.bi[1]=-.25,p0=this.pointList[0],p2=this.pointList[2],d0=this.delta[0],this.coeffA[1].set((p2.x-p0.x-d0.x)*this.tightness,(p2.y-p0.y-d0.y)*this.tightness,(p2.z-p0.z-d0.z)*this.tightness),i=2;i<this.numP-1;i++)this.bi[i]=-1/(this.invTightness+this.bi[i-1]),this.coeffA[i].set(-(this.points[i+1].x-this.points[i-1].x-this.coeffA[i-1].x)*this.bi[i],-(this.points[i+1].y-this.points[i-1].y-this.coeffA[i-1].y)*this.bi[i],-(this.points[i+1].z-this.points[i-1].z-this.coeffA[i-1].z)*this.bi[i]);for(i=this.numP-2;i>0;i--)this.delta[i].set(this.coeffA[i].x+this.delta[i+1].x*this.bi[i],this.coeffA[i].y+this.delta[i+1].y*this.bi[i],this.coeffA[i].z+this.delta[i+1].z*this.bi[i])},getDecimatedVertices:function(step,doAddFinalVertex){void 0===doAddFinalVertex&&(doAddFinalVertex=!0),(void 0===this.vertices||this.vertices.length<2)&&this.computeVertices(Spline3D.DEFAULT_RES);for(var arcLen=this.getEstimatedArcLength(),uniform=[],delta=step/arcLen,currIdx=0,t=0;t<1;t+=delta){for(var currT=t*arcLen;currT>=this.arcLenIndex[currIdx];)currIdx++;var p=this.vertices[currIdx-1],q=this.vertices[currIdx],frac=(currT-this.arcLenIndex[currIdx-1])/(this.arcLenIndex[currIdx]-this.arcLenIndex[currIdx-1]),i=p.interpolateTo(q,frac);uniform.push(i)}return doAddFinalVertex&&uniform.push(this.vertices[this.vertices.length-1]),uniform},getEstimatedArcLength:function(){var len,arcLen=0;void 0===this.arcLenIndex||void 0!==this.arcLenIndex&&this.arcLenIndex.length!=this.vertices.length?(this.arcLenIndex=[0],len=this.vertices.length):len=this.arcLenIndex.length;for(var i=1;i<len;i++){var p=this.vertices[i-1],q=this.vertices[i];arcLen+=p.distanceTo(q),this.arcLenIndex[i]=arcLen}return arcLen},getNumPoints:function(){return this.numP},getPointList:function(){return this.pointList},getTightness:function(){return this.tightness},setPointList:function(plist){return this.pointList=plist.slice(0),this},setTightness:function(tight){return this.tightness=tight,this.invTightness=1/this.tightness,this},updateCoefficients:function(){if(this.numP=this.pointList.length,void 0===this.points||void 0!==this.points&&this.points.length!=this.numP){this.coeffA=[],this.delta=[],this.bi=[];for(var i=0;i<this.numP;i++)this.coeffA[i]=new Vec3D,this.delta[i]=new Vec3D;this.setTightness(this.tightness)}this.points=this.pointList.slice(0)}},Spline3D.DEFAULT_TIGHTNESS=.25,Spline3D.DEFAULT_RES=16,module.exports=Spline3D},{"../internals/is":106,"./BernsteinPolynomial":44,"./Vec3D":71}],66:[function(require,module,exports){var Polygon2D=require("./Polygon2D"),Vec2D=require("./vectors").Vec2D,clippedPos={0:function(b,p1,p2){var x=p1.x+(b.y-p1.y)*(p2.x-p1.x)/(p2.y-p1.y);return new Vec2D(x,b.y)},1:function(b,p1,p2){var bx=b.x+b.width,y=p1.y+(bx-p1.x)*(p2.y-p1.y)/(p2.x-p1.x);return new Vec2D(bx,y)},2:function(b,p1,p2){var by=b.y+b.height,x=p1.x+(by-p1.y)*(p2.x-p1.x)/(p2.y-p1.y);return new Vec2D(x,by)},3:function(b,p1,p2){var y=p1.y+(b.x-p1.x)*(p2.y-p1.y)/(p2.x-p1.x);return new Vec2D(b.x,y)}},getClippedPosOnEdge=function(bounds,edgeID,p1,p2){return clippedPos[edgeID](bounds,p1,p2)},insideEdgeConditions={0:function(bounds,p){return p.y>=bounds.y},1:function(bounds,p){return p.x<bounds.x+bounds.width},2:function(bounds,p){return p.y<bounds.y+bounds.height},3:function(bounds,p){return p.x>=bounds.x}},isInsideEdge=function(bounds,p,edgeID){return insideEdgeConditions[edgeID](bounds,p)},SutherlandHodgemanClipper=function(bounds){this.bounds=bounds};SutherlandHodgemanClipper.prototype={constructor:SutherlandHodgemanClipper,clipPolygon:function(poly){var points=poly.vertices.slice(0),clipped,edgeID=0,i=0,num=points.length-1,p,q;for(points.push(points[0]);edgeID<4;edgeID++){for(i=0,num=points.length-1,clipped=[];i<num;i++)p=points[i],q=points[i+1],isInsideEdge(this.bounds,p,edgeID)?isInsideEdge(this.bounds,q,edgeID)?clipped.push(q.copy()):clipped.push(getClippedPosOnEdge(this.bounds,edgeID,p,q)):isInsideEdge(this.bounds,q,edgeID)&&(clipped.push(getClippedPosOnEdge(this.bounds,edgeID,p,q)),clipped.push(q.copy()));clipped.length>0&&clipped[0]!==clipped[clipped.length-1]&&clipped.push(clipped[0]),points=clipped}return new Polygon2D(points).removeDuplicates(.001)},getBounds:function(){return this.bounds},isKnownVertex:function(list,q){for(var i=0,l=list.length;i<l;i++)if(list[i].equalsWithTolerance(q,1e-4))return!0;return!1},setBounds:function(bounds){this.bounds=bounds}},module.exports=SutherlandHodgemanClipper},{"./Polygon2D":57,"./vectors":96}],67:[function(require,module,exports){var Vec2D=require("./Vec2D"),Line2D=require("./Line2D"),Rect=require("./Rect"),Circle=require("./Circle"),Polygon2D=require("./Polygon2D"),mathUtils=require("../math/mathUtils"),Triangle2D=function(_a,_b,_c){3===arguments.length&&(this.a=_a.copy(),this.b=_b.copy(),this.c=_c.copy())};Triangle2D.createEquilateralFrom=function(a,b){var c=a.interpolateTo(b,.5),dir=a.sub(b),n=dir.getPerpendicular();return c.addSelf(n.normalizeTo(dir.magnitude()*mathUtils.SQRT3/2)),new Triangle2D(a,b,c)},Triangle2D.isClockwise=function(a,b,c){var determ;return(b.x-a.x)*(c.y-a.y)-(c.x-a.x)*(b.y-a.y)<0},Triangle2D.prototype={adjustTriangleSizeBy:function(offAB,offBC,offCA){1==arguments.length&&(offBC=offAB,offCA=offAB),this.computeCentroid();var ab=new Line2D(this.a.copy(),this.b.copy()).offsetAndGrowBy(offAB,1e5,this.centroid),bc=new Line2D(this.b.copy(),this.c.copy()).offsetAndGrowBy(offBC,1e5,this.centroid),ca=new Line2D(this.c.copy(),this.a.copy()).offsetAndGrowBy(offCA,1e5,this.centroid);return this.a=ab.intersectLine(ca).getPos(),this.b=ab.intersectLine(bc).getPos(),this.c=bc.intersectLine(ca).getPos(),this.computeCentroid(),this},computeCentroid:function(){return this.centroid=this.a.add(this.b).addSelf(this.c).scaleSelf(1/3),this.centroid},containsPoint:function(_p){var v1=_p.sub(this.a).normalize(),v2=_p.sub(this.b).normalize(),v3=_p.sub(this.c).normalize(),totalAngles=Math.acos(v1.dot(v2));return totalAngles+=Math.acos(v2.dot(v3)),totalAngles+=Math.acos(v3.dot(v1)),mathUtils.abs(totalAngles-mathUtils.TWO_PI)<=.01},copy:function(){return new Triangle2D(this.a.copy(),this.b.copy(),this.c.copy())},flipVertexOrder:function(){var t=this.a;return this.a=this.c,this.c=t,this},getArea:function(){return.5*this.b.sub(this.a).cross(this.c.sub(this.a))},getBounds:function(){return new Rect(Vec2D.min(Vec2D.min(this.a,this.b),this.c),Vec2D.max(Vec2D.max(this.a,this.b),this.c))},getCircumCircle:function(){var cr=this.a.bisect(this.b).cross(this.b.bisect(this.c)),circa=new Vec2D(cr.x/cr.z,cr.y/cr.z),sa=this.a.distanceTo(this.b),sb=this.b.distanceTo(this.c),sc=this.c.distanceTo(this.a),radius=sa*sb*sc/Math.sqrt((sa+sb+sc)*(-sa+sb+sc)*(sa-sb+sc)*(sa+sb-sc));return new Circle(circa,radius)},getCircumference:function(){return this.a.distanceTo(this.b)+this.b.distanceTo(this.c)+this.c.distanceTo(this.a)},getClosestPointTo:function(_p){var edge=new Line2D(this.a,this.b),Rab=edge.closestPointTo(_p),Rbc=edge.set(this.b,this.c).closestPointTo(_p),Rca=edge.set(this.c,this.a).closestPointTo(_p),dAB=_p.sub(Rab).magSquared(),dBC=_p.sub(Rbc).magSquared(),dCA,min=dAB,result=Rab;return dBC<min&&(min=dBC,result=Rbc),_p.sub(Rca).magSquared()<min&&(result=Rca),result},intersectsTriangle:function(tri){if(this.containsPoint(tri.a)||this.containsPoint(tri.b)||this.containsPoint(tri.c))return!0;if(tri.containsPoint(this.a)||tri.containsPoint(this.b)||tri.containsPoint(this.c))return!0;for(var ea=[new Line2D(this.a,this.b),new Line2D(this.b,this.c),new Line2D(this.c,this.a)],eb=[new Line2D(tri.a,tri.b),new Line2D(tri.b,tri.c),new Line2D(tri.c,tri.a)],i=0,eaLen=ea.length;i<eaLen;i++)for(var la=ea[i],j=0,ebLen=eb.length;j<ebLen;j++){var lb=eb[j],type=la.intersectLine(lb).getType();if(type!=Line2D.LineIntersection.Type.NON_INTERSECTING&&type!=Line2D.LineIntersection.Type.PARALLEL)return!0}return!1},isClockwise:function(){return Triangle2D.isClockwise(this.a,this.b,this.c)},set:function(a2,b2,c2){this.a=a2,this.b=b2,this.c=c2},toPolygon2D:function(){var poly=new Polygon2D;return poly.add(this.a.copy()),poly.add(this.b.copy()),poly.add(this.c.copy()),poly},toString:function(){return"Triangle2D: "+this.a+","+this.b+","+this.c}},module.exports=Triangle2D},{"../math/mathUtils":125,"./Circle":45,"./Line2D":52,"./Polygon2D":57,"./Rect":62,"./Vec2D":70}],68:[function(require,module,exports){var mathUtils=require("../math/mathUtils"),Vec3D=require("./Vec3D"),Line3D=require("./Line3D"),AABB=require("./AABB"),Triangle3D=function(a,b,c){this.a=a,this.b=b,this.c=c};Triangle3D.createEquilateralFrom=function(a,b){var c=a.interpolateTo(b,.5),dir=b.sub(a),n=a.cross(dir.normalize());return c.addSelf(n.normalizeTo(dir.magnitude()*mathUtils.SQRT3/2)),new Triangle3D(a,b,c)},Triangle3D.isClockwiseInXY=function(a,b,c){var determ;return(b.x-a.x)*(c.y-a.y)-(c.x-a.x)*(b.y-a.y)<0},Triangle3D.isClockwiseInXZ=function(a,b,c){var determ;return(b.x-a.x)*(c.z-a.z)-(c.x-a.x)*(b.z-a.z)<0},Triangle3D.isClockwiseInYZ=function(a,b,c){var determ;return(b.y-a.y)*(c.z-a.z)-(c.y-a.y)*(b.z-a.z)<0},Triangle3D.prototype={closestPointOnSurface:function(p){var ab=this.b.sub(this.a),ac=this.c.sub(this.a),bc=this.c.sub(this.b),pa=p.sub(this.a),pb=p.sub(this.b),pc=p.sub(this.c),ap=a.sub(this.p),bp=b.sub(this.p),cp=c.sub(this.p),snom=pa.dot(ab),tnom=pa.dot(ac);if(snom<=0&&tnom<=0)return this.a;var sdenom=pb.dot(this.a.sub(this.b)),tdenom=pc.dot(this.a.sub(this.c)),unom=pb.dot(bc),udenom=pc.dot(this.b.sub(this.c));if(sdenom<=0&&unom<=0)return this.b;if(tdenom<=0&&udenom<=0)return this.c;var n=ab.cross(ac),vc=n.dot(ap.crossSelf(bp));if(vc<=0&&snom>=0&&sdenom>=0)return this.a.add(ab.scaleSelf(snom/(snom+sdenom)));var va=n.dot(bp.crossSelf(cp));if(va<=0&&unom>=0&&udenom>=0)return this.b.add(bc.scaleSelf(unom/(unom+udenom)));var vb=n.dot(cp.crossSelf(ap));if(vb<=0&&tnom>=0&&tdenom>=0)return this.a.add(ac.scaleSelf(tnom/(tnom+tdenom)));var u=va/(va+vb+vc),v=vb/(va+vb+vc),w=1-u-v;return this.a.scale(u).addSelf(this.b.scale(v)).addSelf(this.c.scale(w))},computeCentroid:function(){return this.centroid=this.a.add(this.b).addSelf(this.c).scaleSelf(1/3),this.centroid},computeNormal:function(){return this.normal=this.a.sub(this.c).crossSelf(this.a.sub(this.b)).normalize(),this.normal},containsPoint:function(p){if(p.equals(this.a)||p.equals(this.b)||p.equals(this.c))return!0;var v1=p.sub(this.a).normalize(),v2=p.sub(this.b).normalize(),v3=p.sub(this.c).normalize(),total_angles=Math.acos(v1.dot(v2));return total_angles+=Math.acos(v2.dot(v3)),total_angles+=Math.acos(v3.dot(v1)),mathUtils.abs(total_angles-mathUtils.TWO_PI)<=.005},flipVertexOrder:function(){var t=this.a;return this.a=this.c,this.c=this.t,this},fromBarycentric:function(p){return new Vec3D(this.a.x*p.x+this.b.x*p.y+this.c.x*p.z,this.a.y*p.x+this.b.y*p.y+this.c.y*p.z,this.a.z*p.x+this.b.z*p.y+this.c.z*p.z)},getBoundingBox:function(){var min=Vec3D.min(Vec3D.min(this.a,this.b),this.c),max=Vec3D.max(Vec3D.max(this.a,this.b),this.c);return AABB.fromMinMax(min,max)},getClosestPointTo:function(p){var edge=new Line3D(this.a,this.b),Rab=edge.closestPointTo(p),Rbc=edge.set(this.b,this.c).closestPointTo(p),Rca=edge.set(this.c,this.a).closestPointTo(p),dAB=p.sub(Rab).magSquared(),dBC=p.sub(Rbc).magSquared(),dCA,min=dAB,result=Rab;return dBC<min&&(min=dBC,result=Rbc),p.sub(Rca).magSquared()<min&&(result=Rca),result},isClockwiseInXY:function(){return Triangle3D.isClockwiseInXY(this.a,this.b,this.c)},isClockwiseInXZ:function(){return Triangle3D.isClockwiseInXY(this.a,this.b,this.c)},isClockwiseInYZ:function(){return Triangle3D.isClockwiseInXY(this.a,this.b,this.c)},set:function(a2,b2,c2){this.a=a2,this.b=b2,this.c=c2},toBarycentric:function(p){var e=b.sub(this.a).cross(this.c.sub(this.a)),n=e.getNormalized(),areaABC=n.dot(e),areaPBC,l1=n.dot(this.b.sub(p).cross(this.c.sub(p)))/areaABC,areaPCA,l2=n.dot(this.c.sub(p).cross(this.a.sub(p)))/areaABC,l3;return new Vec3D(l1,l2,1-l1-l2)},toString:function(){return"Triangle: "+this.a+","+this.b+","+this.c}},module.exports=Triangle3D},{"../math/mathUtils":125,"./AABB":42,"./Line3D":53,"./Vec3D":71}],69:[function(require,module,exports){var mathUtils=require("../math/mathUtils"),Triangle3D=require("./Triangle3D"),Vec3D=require("./Vec3D"),IsectData3D=require("./IsectData3D"),TriangleIntersector=function(t){this.triangle=t||new Triangle3D,this.isectData=new IsectData3D};TriangleIntersector.prototype={getIntersectionData:function(){return this.isectData},getTriangle:function(){return this.triangle},intersectsRay:function(ray){this.isectData.isIntersection=!1;var n=this.triangle.computeNormal(),dotprod;if(n.dot(ray.dir)<0){var rt=ray.sub(this.triangle.a),t=-(n.x*rt.x+n.y*rt.y+n.z*rt.z)/(n.x*ray.dir.x+n.y*ray.dir.y+n.z*ray.dir.z);if(t>=mathUtils.EPS){var pos=ray.getPointAtDistance(t);this.triangle.containsPoint(pos)&&(this.isectData.isIntersection=!0,this.isectData.pos=pos,this.isectData.normal=n,this.isectData.dist=t,this.isectData.dir=this.isectData.pos.sub(ray).normalize())}}return this.isectData.isIntersection},setTriangle:function(tri){return this.triangle=tri,this}},module.exports=TriangleIntersector},{"../math/mathUtils":125,"./IsectData3D":51,"./Triangle3D":68,"./Vec3D":71}],70:[function(require,module,exports){module.exports=require("./vectors").Vec2D},{"./vectors":96}],71:[function(require,module,exports){module.exports=require("./vectors").Vec3D},{"./vectors":96}],72:[function(require,module,exports){var extend=require("../internals").extend,mathUtils=require("../math/mathUtils"),Vec3D=require("./Vec3D"),AxisAlignedCylinder=require("./AxisAlignedCylinder"),XAxisCylinder=function(pos,radius,length){AxisAlignedCylinder.apply(this,[pos,radius,length])};extend(XAxisCylinder,AxisAlignedCylinder),XAxisCylinder.prototype.containsPoint=function(p){if(mathUtils.abs(p.x-this.pos.x)<.5*this.length){var dy=p.y-this.pos.y,dz=p.z-this.pos.z;if(Math.abs(dz*dz+dy*dy)<this.radiusSquared)return!0}return!1},XAxisCylinder.prototype.getMajorAxis=function(){return Vec3D.Axis.X},module.exports=XAxisCylinder},{"../internals":98,"../math/mathUtils":125,"./AxisAlignedCylinder":43,"./Vec3D":71}],73:[function(require,module,exports){var extend=require("../internals").extend,mathUtils=require("../math/mathUtils"),Vec3D=require("./Vec3D"),AxisAlignedCylinder=require("./AxisAlignedCylinder"),YAxisCylinder=function(pos,radius,length){AxisAlignedCylinder.apply(this,[pos,radius,length])};extend(YAxisCylinder,AxisAlignedCylinder),YAxisCylinder.prototype.containsPoint=function(p){if(mathUtils.abs(p.y-this.pos.y)<.5*this.length){var dx=p.x-this.pos.x,dz=p.z-this.pos.z;if(Math.abs(dz*dz+dx*dx)<this.radiusSquared)return!0}return!1},YAxisCylinder.prototype.getMajorAxis=function(){return Vec3D.Axis.Y},module.exports=YAxisCylinder},{"../internals":98,"../math/mathUtils":125,"./AxisAlignedCylinder":43,"./Vec3D":71}],74:[function(require,module,exports){var extend=require("../internals").extend,mathUtils=require("../math/mathUtils"),Vec3D=require("./Vec3D"),AxisAlignedCylinder=require("./AxisAlignedCylinder"),ZAxisCylinder=function(pos,radius,length){AxisAlignedCylinder.apply(this,[pos,radius,length])};extend(ZAxisCylinder,AxisAlignedCylinder),ZAxisCylinder.prototype.containsPoint=function(p){if(mathUtils.abs(p.z-this.pos.z)<.5*this.length){var dx=p.x-this.pos.x,dy=p.y-this.pos.y;if(Math.abs(dx*dx+dy*dy)<this.radiusSquared)return!0}return!1},ZAxisCylinder.prototype.getMajorAxis=function(){return Vec3D.Axis.Z},module.exports=ZAxisCylinder},{"../internals":98,"../math/mathUtils":125,"./AxisAlignedCylinder":43,"./Vec3D":71}],75:[function(require,module,exports){exports.TriangleMesh=require("./mesh/TriangleMesh"),exports.BezierPatch=require("./mesh/BezierPatch"),exports.BoxSelector=require("./mesh/BoxSelector"),exports.DefaultSelector=require("./mesh/DefaultSelector"),exports.Face=require("./mesh/Face"),exports.OBJWriter=require("./mesh/OBJWriter"),exports.PlaneSelector=require("./mesh/PlaneSelector"),exports.SphereFunction=require("./mesh/SphereFunction"),exports.SphericalHarmonics=require("./mesh/SphericalHarmonics"),exports.SurfaceMeshBuilder=require("./mesh/SurfaceMeshBuilder"),exports.SuperEllipsoid=require("./mesh/SuperEllipsoid"),exports.Terrain=require("./mesh/Terrain"),exports.TriangleMesh=require("./mesh/TriangleMesh"),exports.Vertex=require("./mesh/Vertex"),exports.VertexSelector=require("./mesh/VertexSelector"),exports.WETriangleMesh=require("./mesh/WETriangleMesh")},{"./mesh/BezierPatch":76,"./mesh/BoxSelector":77,"./mesh/DefaultSelector":78,"./mesh/Face":79,"./mesh/OBJWriter":80,"./mesh/PlaneSelector":81,"./mesh/SphereFunction":82,"./mesh/SphericalHarmonics":83,"./mesh/SuperEllipsoid":84,"./mesh/SurfaceMeshBuilder":85,"./mesh/Terrain":86,"./mesh/TriangleMesh":87,"./mesh/Vertex":88,"./mesh/VertexSelector":89,"./mesh/WETriangleMesh":90}],76:[function(require,module,exports){var Vec3D=require("../Vec3D"),TriangleMesh=require("./TriangleMesh"),is=require("../../internals/is"),BezierPatch=function(points){if(is.Array(points))this.points=points;else{this.points=[];for(var i=0;i<4;i++){this.points[i]=this.points[i]||[];for(var j=0;j<4;j++)this.points[i][j]=new Vec3D}}};BezierPatch.prototype={computePointAt:function(u,v){return BezierPatch.computePointAt(u,v,this.points)},set:function(x,y,p){return this.points[y][x].set(p),this},toMesh:function(mesh_or_res,_res){var mesh,res;void 0===_res?(mesh=new TriangleMesh,res=mesh_or_res):(mesh=mesh_or_res,res=_res);for(var curr=new Array(res+1),prev=new Array(res+1),r1=1/res,y=0;y<=res;y++){for(var x=0;x<=res;x++){var p=this.computePointAt(x*r1,y*r1,this.points);x>0&&y>0&&(mesh.addFace(p,curr[x-1],prev[x-1]),mesh.addFace(p,prev[x-1],prev[x])),curr[x]=p}var tmp=prev;prev=curr,curr=tmp}return mesh}},BezierPatch.computePointAt=function(u,v,points){var u1=1-u,u1squared=u1*u1*3*u,u1cubed=u1*u1*u1,usquared=u*u,v1=1-v,vsquared,v1squared,v1cubed=v1*v1*v1,vcubed=v*v*v,u1usq=u1*usquared*3,usqu=u*usquared,v1vsq=v1*(v*v*3),v1sqv=v1*v1*3*v,p0=points[0],p1=points[1],p2=points[2],p3=points[3],x=u1cubed*(p0[0].x*v1cubed+p0[1].x*v1sqv+p0[2].x*v1vsq+p0[3].x*vcubed)+u1squared*(p1[0].x*v1cubed+p1[1].x*v1sqv+p1[2].x*v1vsq+p1[3].x*vcubed)+u1usq*(p2[0].x*v1cubed+p2[1].x*v1sqv+p2[2].x*v1vsq+p2[3].x*vcubed)+usqu*(p3[0].x*v1cubed+p3[1].x*v1sqv+p3[2].x*v1vsq+p3[3].x*vcubed),y=u1cubed*(p0[0].y*v1cubed+p0[1].y*v1sqv+p0[2].y*v1vsq+p0[3].y*vcubed)+u1squared*(p1[0].y*v1cubed+p1[1].y*v1sqv+p1[2].y*v1vsq+p1[3].y*vcubed)+u1usq*(p2[0].y*v1cubed+p2[1].y*v1sqv+p2[2].y*v1vsq+p2[3].y*vcubed)+usqu*(p3[0].y*v1cubed+p3[1].y*v1sqv+p3[2].y*v1vsq+p3[3].y*vcubed),z=u1cubed*(p0[0].z*v1cubed+p0[1].z*v1sqv+p0[2].z*v1vsq+p0[3].z*vcubed)+u1squared*(p1[0].z*v1cubed+p1[1].z*v1sqv+p1[2].z*v1vsq+p1[3].z*vcubed)+u1usq*(p2[0].z*v1cubed+p2[1].z*v1sqv+p2[2].z*v1vsq+p2[3].z*vcubed)+usqu*(p3[0].z*v1cubed+p3[1].z*v1sqv+p3[2].z*v1vsq+p3[3].z*vcubed);return new Vec3D(x,y,z)},module.exports=BezierPatch},{"../../internals/is":106,"../Vec3D":71,"./TriangleMesh":87}],77:[function(require,module,exports){var extend=require("../../internals").extend,VertexSelector=require("./VertexSelector"),BoxSelector=function(mesh,box){VertexSelector.apply(this,[mesh]),this.box=box};extend(BoxSelector,VertexSelector),BoxSelector.prototype.selectVertices=function(){this.clearSelection();for(var verts=this.mesh.getVertices(),l=verts.length,i=0;i<l;i++){var v=verts[i];this.box.containsPoint(v)&&this.selection.add(v)}return this},module.exports=BoxSelector},{"../../internals":98,"./VertexSelector":89}],78:[function(require,module,exports){var extend=require("../../internals").extend,VertexSelector=require("./VertexSelector"),DefaultSelector=function(mesh){VertexSelector.call(this,mesh)};extend(DefaultSelector,VertexSelector),DefaultSelector.prototype.selectVertices=function(){return this.clearSelection(),this.selection=this.selection.concat(this.mesh.getVertices()),this},module.exports=DefaultSelector},{"../../internals":98,"./VertexSelector":89}],79:[function(require,module,exports){var Face,WEFace,Triangle3D,internals,proto;Triangle3D=require("../Triangle3D"),(Face=function(a,b,c,uvA,uvB,uvC){this.a=a,this.b=b,this.c=c;var aminusc=this.a.sub(this.c),aminusb=this.a.sub(this.b),cross=aminusc.crossSelf(aminusb);this.normal=cross.normalize(),this.a.addFaceNormal(this.normal),this.b.addFaceNormal(this.normal),this.c.addFaceNormal(this.normal),void 0!==uvA&&(this.uvA=uvA,this.uvB=uvB,this.uvC=uvC)}).prototype={computeNormal:function(){this.normal=this.a.sub(this.c).crossSelf(this.a.sub(this.b)).normalize()},flipVertexOrder:function(){var t=this.a;this.a=this.b,this.b=t,this.normal.invert()},getCentroid:function(){return this.a.add(this.b).addSelf(this.c).scale(1/3)},getClass:function(){return"Face"},getVertices:function(verts){return void 0!==verts?(verts[0]=this.a,verts[1]=this.b,verts[2]=this.c):verts=[this.a,this.b,this.c],verts},toString:function(){return this.getClass()+" "+this.a+", "+this.b+", "+this.c},toTriangle:function(){return new Triangle3D(this.a.copy(),this.b.copy(),this.c.copy())}},internals=require("../../internals"),WEFace=function(a,b,c,uvA,uvB,uvC){Face.call(this,a,b,c,uvA,uvB,uvC),this.edges=[]},internals.extend(WEFace,Face),(proto=WEFace.prototype).addEdge=function(edge){this.edges.push(edge)},proto.getEdges=function(){return this.edges},proto.getVertices=function(verts){return void 0!==verts?(verts[0]=this.a,verts[1]=this.b,verts[2]=this.c):verts=[this.a,this.b,this.c],verts},Face.WEFace=WEFace,module.exports=Face},{"../../internals":98,"../Triangle3D":68}],80:[function(require,module,exports){var internals=require("../../internals"),StringBuffer=function(){this.buffer=[]};StringBuffer.prototype.append=function(string){return this.buffer.push(string),this},StringBuffer.prototype.toString=function(){return this.buffer.join("")};var OBJWriter=function(){this.VERSION="0.3",this.__stringBuffer=new StringBuffer,this.objStream=void 0,this.__filename="objwriter.obj",this._numVerticesWritten=0,this._numNormalsWritten=0};OBJWriter.prototype={beginSave:function(stream){"string"==typeof stream||internals.hasProperties(stream,["write","end","writable"]&&stream.writable)&&(this.objStream=stream),this._handleBeginSave()},endSave:function(){if(void 0!==this.objStream)try{this.objStream.destroy()}catch(e){}},face:function(a,b,c){this.__stringBuffer.append("f "+a+" "+b+" "+c+"\n")},faceList:function(){this.__stringBuffer.append("s off \n")},faceWithNormals:function(a,b,c,na,nb,nc){this.__stringBuffer.append("f "+a+"//"+na+" "+b+"//"+nb+" "+c+"//"+nc+"\n")},getCurrNormalOffset:function(){return this._numNormalsWritten},getCurrVertexOffset:function(){return this._numVerticesWritten},getOutput:function(){return this.__stringBuffer.toString()},_handleBeginSave:function(){this.numVerticesWritten=0,this.numNormalsWrittern=0,this.__stringBuffer.append("# generated by OBJExport (js) v"+this.VERSION+"\n")},newObject:function(name){this.__stringBuffer.append("o "+name+"\n")},normal:function(vecN){this.__stringBuffer.append("vn "+vecN.x+" "+vecN.y+" "+vecN.z+"\n"),this._numNormalsWritten++},vertex:function(vecV){this.__stringBuffer.append("v "+vecV.x+" "+vecV.y+" "+vecV.z+"\n"),this._numVerticesWritten++}},module.exports=OBJWriter},{"../../internals":98}],81:[function(require,module,exports){var extend=require("../../internals").extend,VertexSelector=require("./VertexSelector"),PlaneSelector=function(mesh,plane,classifier,tolerance){VertexSelector.apply(this,[mesh]),this.plane=plane,this.classifier=classifier,this.tolerances=void 0===tolerance?1e-4:tolerance};extend(PlaneSelector,VertexSelector),PlaneSelector.prototype.selectVertices=function(){this.clearSelection();for(var verts=this.mesh.getVertices(),l=verts.length,i=0;i<l;i++){var v=verts[i];this.plane.classifyPoint(v,this.tolerance)==this.classifier&&this.selection.add(v)}return this},module.exports=PlaneSelector},{"../../internals":98,"./VertexSelector":89}],82:[function(require,module,exports){module.exports=require("../Sphere").SphereFunction},{"../Sphere":63}],83:[function(require,module,exports){var mathUtils=require("../../math/mathUtils"),SphericalHarmonics=function(m){this.m=m};SphericalHarmonics.prototype={computeVertexFor:function(p,phi,theta){var r=0;r+=Math.pow(mathUtils.sin(this.m[0]*theta),this.m[1]),r+=Math.pow(mathUtils.cos(this.m[2]*theta),this.m[3]),r+=Math.pow(mathUtils.sin(this.m[4]*phi),this.m[5]),r+=Math.pow(mathUtils.cos(this.m[6]*phi),this.m[7]);var sinTheta=mathUtils.sin(theta);return p.x=r*sinTheta*mathUtils.cos(phi),p.y=r*mathUtils.cos(theta),p.z=r*sinTheta*mathUtils.sin(phi),p},getPhiRange:function(){return mathUtils.TWO_PI},getPhiResolutionLimit:function(res){return res},getThetaRange:function(){return mathUtils.PI},getThetaResolutionLimit:function(res){return res}},module.exports=SphericalHarmonics},{"../../math/mathUtils":125}],84:[function(require,module,exports){var mathUtils=require("../../math/mathUtils"),TriangleMesh=require("./TriangleMesh"),SuperEllipsoid=function(n1,n2){this.p1=n1,this.p2=n2};SuperEllipsoid.prototype={computeVertexFor:function(p,phi,theta){phi-=mathUtils.HALF_PI;var cosPhi=mathUtils.cos(phi),cosTheta=mathUtils.cos(theta),sinPhi=mathUtils.sin(phi),sinTheta=mathUtils.sin(theta),t=mathUtils.sign(cosPhi)*Math.pow(mathUtils.abs(cosPhi),this.p1);return p.x=t*mathUtils.sign(cosTheta)*Math.pow(Math.abs(cosTheta),this.p2),p.y=mathUtils.sign(sinPhi)*Math.pow(Math.abs(sinPhi),this.p1),p.z=t*mathUtils.sign(sinTheta)*Math.pow(mathUtils.abs(sinTheta),this.p2),p},getPhiRange:function(){return mathUtils.TWO_PI},getPhiResolutionLimit:function(res){return res/2},getThetaRange:function(){return mathUtils.TWO_PI},getThetaResolutionLimit:function(res){return res}},module.exports=SuperEllipsoid},{"../../math/mathUtils":125,"./TriangleMesh":87}],85:[function(require,module,exports){module.exports=require("./meshCommon").SurfaceMeshBuilder},{"./meshCommon":92}],86:[function(require,module,exports){module.exports=require("./meshCommon").Terrain},{"./meshCommon":92}],87:[function(require,module,exports){module.exports=require("./meshCommon").TriangleMesh},{"./meshCommon":92}],88:[function(require,module,exports){var Vertex,WEVertex,extend,Vec3D,proto;extend=require("../../internals").extend,Vec3D=require("../Vec3D"),extend(Vertex=function(v,id){Vec3D.call(this,v),this.id=id,this.normal=new Vec3D},Vec3D),(proto=Vertex.prototype).addFaceNormal=function(n){this.normal.addSelf(n)},proto.clearNormal=function(){this.normal.clear()},proto.computeNormal=function(){this.normal.normalize()},proto.toString=function(){return this.id+": p: "+this.parent.toString.call(this)+" n:"+this.normal.toString()},function(){var extend,proto;(0,require("../../internals").extend)(WEVertex=function(vec3d,id){Vertex.call(this,vec3d,id),this.edges=[]},Vertex),(proto=WEVertex.prototype).addEdge=function(edge){this.edges.push(edge)},proto.getNeighborInDirection=function(dir,tolerance){for(var closest,delta=1-tolerance,neighbors=this.getNeighbors(),d,i=0,l=neighbors.length;i<l;i++)(d=neighbors[i].sub(this).normalize().dot(dir))>delta&&(closest=neighbors[i],delta=d);return closest},proto.getNeighbors=function(){for(var neighbors=[],i=0,l=this.edges.length;i<l;i++)neighbors.push(this.edges[i].getOtherEndFor(this));return neighbors},proto.removeEdge=function(e){this.edges.splice(this.edges.indexOf(e),1)},proto.toString=function(){return this.id+" {"+this.x+","+this.y+","+this.z+"}"}}(),Vertex.WEVertex=WEVertex,module.exports=Vertex},{"../../internals":98,"../Vec3D":71}],89:[function(require,module,exports){var VertexSelector=function(mesh){this.mesh=mesh,this.selection=[]};VertexSelector.prototype={addSelection:function(sel2){return this.checkMeshIdentity(sel2.getMesh()),this.selection=this.selection.concat(sel2.getSelection()),this},checkMeshIdentity:function(mesh2){if(mesh2!=this.mesh)throw new Error("The given selector is not using the same mesh instance")},clearSelection:function(){return this.selection=[],this},getMesh:function(){return this.mesh},getSelection:function(){return this.selection},invertSelection:function(){for(var newSel=[],vertices=this.mesh.getVertices(),l=vertices.length,i=0;i<l;i++){var v=vertices[i];this.selection.indexOf(v)<0&&newSel.push(v)}return this.selection=newSel,this},selectSimilar:function(points){for(var l=points.length,i=0;i<l;i++){var v=points[i];this.selection.push(this.mesh.getClosestVertexToPoint(v))}return this},selectVertices:function(){return this},setMesh:function(mesh){this.mesh=mesh,this.clearSelection()},size:function(){return this.selection.length},subtractSelection:function(sel2){this.checkMeshIdentity(sel2.getMesh());var removeThese=sel2.getSelection(),i,l=removeThese.length;for(i=0;i<l;i++)this.selection.splice(this.selection.indexOf(removeThese[i]),1);return this}},module.exports=VertexSelector},{}],90:[function(require,module,exports){module.exports=require("./meshCommon").WETriangleMesh},{"./meshCommon":92}],91:[function(require,module,exports){var internals=require("../../internals"),Line3D=require("../Line3D"),WingedEdge,proto;WingedEdge=function(va,vb,face,id){Line3D.call(this,va,vb),this.id=id,this.faces=[],this.addFace(face)},internals.extend(WingedEdge,Line3D),(proto=WingedEdge.prototype).addFace=function(face){return this.faces.push(face),this},proto.getFaces=function(){return this.faces},proto.getOtherEndFor=function(wevert){return this.a===wevert?this.b:this.b===wevert?this.a:void 0},proto.remove=function(){for(var self=this,rm=function(edges){edges.splice(edges.indexOf(self),1)},i=0,l=this.faces.length;i<l;i++)rm(this.faces[i].edges);rm(this.a.edges),rm(this.b.edges)},proto.toString=function(){return"id: "+this.id+" "+Line3D.prototype.toString.call(this)+" f: "+this.faces.length},module.exports=WingedEdge},{"../../internals":98,"../Line3D":53}],92:[function(require,module,exports){var TriangleMesh,WETriangleMesh,Terrain,SurfaceMeshBuilder,precision=1e6,format=function(n){return Math.floor(1e6*n)/1e6},internals,mathUtils,Matrix4x4,Face,Vec3D,Triangle3D,TriangleIntersector,Quaternion,Vertex;function vertexKeyGenerator(v){return"[ x: "+format(v.x)+", y: "+format(v.y)+", z: "+format(v.z)+"]"}function edgeKeyGenerator(edge){return edge.a.id+"->"+edge.b.id}internals=require("../../internals"),mathUtils=require("../../math/mathUtils"),Matrix4x4=require("../Matrix4x4"),Face=require("./Face"),Vec3D=require("../Vec3D"),Triangle3D=require("../Triangle3D"),TriangleIntersector=require("../TriangleIntersector"),Quaternion=require("../Quaternion"),Vertex=require("./Vertex"),(TriangleMesh=function(name){return void 0===name&&(name="untitled"),this.init(name),this}).__vertexKeyGenerator=vertexKeyGenerator,TriangleMesh.DEFAULT_NUM_VERTICES=1e3,TriangleMesh.DEFAULT_NUM_FACES=3e3,TriangleMesh.DEFAULT_STRIDE=4,TriangleMesh.prototype={addFace:function(a,b,c,n,uvA,uvB,uvC){6==arguments.length&&(uvC=uvB,uvB=uvA,uvA=n,n=void 0);var va=this.__checkVertex(a),vb=this.__checkVertex(b),vc=this.__checkVertex(c);if(va.id===vb.id||va.id===vc.id||vb.id===vc.id);else{if(null!=n){var nc=va.sub(vc).crossSelf(va.sub(vb));if(n.dot(nc)<0){var t=va;va=vb,vb=t}}var f=new Face(va,vb,vc,uvA,uvB,uvC);this.faces.push(f)}return this},addMesh:function(m){for(var l=m.getFaces().length,i=0;i<l;i++){var f=m.getFaces()[i];this.addFace(f.a,f.b,f.c)}return this},center:function(origin){this.computeCentroid();for(var delta=null!=origin?origin.sub(this.centroid):this.centroid.getInverted(),l=this.vertices.length,i=0;i<l;i++){var v;this.vertices[i].addSelf(delta)}return this.getBoundingBox()},__checkVertex:function(v){var vertex=this.vertexMap.get(v);return vertex||(vertex=this._createVertex(v,this.uniqueVertexID++),this.vertexMap.put(vertex,vertex)),vertex},clear:function(){return this.vertexMap=new internals.LinkedMap(vertexKeyGenerator),this.vertices=this.vertexMap.getArray(),this.faces=[],this.bounds=void 0,this},computeCentroid:function(){this.centroid.clear();for(var l=this.vertices.length,i=0;i<l;i++)this.centroid.addSelf(this.vertices[i]);return this.centroid.scaleSelf(1/this.vertexMap.size()).copy()},computeFaceNormals:function(){for(var l=this.faces.length,i=0;i<l;i++)this.faces[i].computeNormal()},computeVertexNormals:function(){var l=this.vertices.length,i=0;for(i=0;i<l;i++)this.vertices[i].clearNormal();for(l=this.faces.length,i=0;i<l;i++){var f=this.faces[i];f.a.addFaceNormal(f.normal),f.b.addFaceNormal(f.normal),f.c.addFaceNormal(f.normal)}for(l=this.vertices.length,i=0;i<l;i++)this.vertices[i].computeNormal();return this},copy:function(){for(var m=new TriangleMesh(this.name+"-copy",this.vertexMap.size(),this.faces.length),l=this.faces.length,i=0;i<l;i++){var f=this.faces[i];m.addFace(f.a,f.b,f.c,f.normal,f.uvA,f.uvB,f.uvC)}return m},_createVertex:function(vec3D,id){var vertex;return new Vertex(vec3D,id)},faceOutwards:function(){this.computeCentroid();for(var l=this.faces.length,i=0;i<l;i++){var f=this.faces[i],n,dot;f.getCentroid().sub(this.centroid).dot(f.normal)<0&&f.flipVertexOrder()}return this},flipVertexOrder:function(){for(var l=this.faces.length,tuv,i=0;i<l;i++){var f=this.faces[i],t=f.a;f.a=f.b,f.b=t,f.uvA&&(tuv=f.uvA,f.uvA=f.uvB,f.uvB=tuv),f.normal.invert()}return this},flipYAxis:function(){return this.transform((new Matrix4x4).scaleSelf(1,-1,1)),this.flipVertexOrder(),this},getBoundingBox:function(){for(var AABB=require("../AABB"),self=this,minBounds=Vec3D.MAX_VALUE.copy(),maxBounds=Vec3D.MIN_VALUE.copy(),l=this.vertices.length,i=0;i<l;i++){var v=this.vertices[i];minBounds.minSelf(v),maxBounds.maxSelf(v)}return this.bounds=AABB.fromMinMax(minBounds,maxBounds),this.bounds},getBoundingSphere:function(){var Sphere=require("../Sphere"),radius=0,sph;this.computeCentroid();for(var l=this.vertices.length,i=0;i<l;i++){var v=this.vertices[i];radius=mathUtils.max(radius,v.distanceToSquared(this.centroid))}return new Sphere(this.centroid,Math.sqrt(radius))},getClosestVertexToPoint:function(p){for(var closest,minDist=Number.MAX_VALUE,l=this.vertices.length,i=0;i<l;i++){var v=this.vertices[i],d=v.distanceToSquared(p);d<minDist&&(closest=v,minDist=d)}return closest},getFaceNormalsAsArray:function(normals,offset,stride){if(0===arguments.length)normals=void 0,offset=0,stride=TriangleMesh.DEFAULT_STRIDE;else if(1==arguments.length&&"object"==typeof arguments[0]){var opts=arguments[0];normals=opts.normals,offset=opts.offset,stride=opts.stride}stride=mathUtils.max(stride,3),void 0===normals&&(normals=[]);for(var i=offset,l=this.faces.length,j=0;j<l;j++){var f=this.faces[j];normals[i]=f.normal.x,normals[i+1]=f.normal.y,normals[i+2]=f.normal.z,normals[i+=stride]=f.normal.x,normals[i+1]=f.normal.y,normals[i+2]=f.normal.z,normals[i+=stride]=f.normal.x,normals[i+1]=f.normal.y,normals[i+2]=f.normal.z,i+=stride}return normals},getFaces:function(){return this.faces},getFacesAsArray:function(faceList){faceList=faceList||[];for(var i=0,l=this.faces.length,j=0;j<l;j++){var f=this.faces[j];faceList[i++]=f.a.id,faceList[i++]=f.b.id,faceList[i++]=f.c.id}return faceList},getIntersectionData:function(){return this.intersector.getIntersectionData()},getMeshAsVertexArray:function(verts,offset,stride){void 0===verts&&(verts=void 0),void 0===offset&&(offset=0),void 0===stride&&(stride=TriangleMesh.DEFAULT_STRIDE),stride=mathUtils.max(stride,3),void 0===verts&&(verts=[]);for(var i=0,l=this.faces.length,j=0;j<l;++j){var f=this.faces[j];verts[i]=f.a.x,verts[i+1]=f.a.y,verts[i+2]=f.a.z,verts[i+=stride]=f.b.x,verts[i+1]=f.b.y,verts[i+2]=f.b.z,verts[i+=stride]=f.c.x,verts[i+1]=f.c.y,verts[i+2]=f.c.z,i+=stride}return verts},getNumFaces:function(){return this.faces.length},getNumVertices:function(){return this.vertexMap.size()},getRotatedAroundAxis:function(axis,theta){return this.copy().rotateAroundAxis(axis,theta)},getRotatedX:function(theta){return this.copy().rotateX(theta)},getRotatedY:function(theta){return this.copy().rotateY(theta)},getRotatedZ:function(theta){return this.copy().rotateZ(theta)},getScaled:function(scale){return this.copy().scale(scale)},getTranslated:function(trans){return this.copy().translate(trans)},getUniqueVerticesAsArray:function(array){array=array||[];for(var i=0,l=this.vertices.length,j=0;j<l;j++){var v=this.vertices[j];array[i++]=v.x,array[i++]=v.y,array[i++]=v.z}return array},getUniqueVertexNormalsAsArray:function(array){array=array||[];var n=0;for(i=0;i<this.vertices.length;i++){var v=this.vertices[i];array[n++]=v.normal.x,array[n++]=v.normal.y,array[n++]=v.normal.z}return array},getUVsAsArray:function(array){array=array||[];var i=0;for(f=0;f<this.faces.length;f++){var face=this.faces[f];array[i++]=face.uvA?face.uvA.x:0,array[i++]=face.uvA?face.uvA.y:0,array[i++]=face.uvB?face.uvB.x:0,array[i++]=face.uvB?face.uvB.y:0,array[i++]=face.uvC?face.uvC.x:0,array[i++]=face.uvC?face.uvC.y:0}return array},getVertexAtPoint:function(v){for(var index,i=0;i<this.vertices.length;i++)this.vertices[i].equals(v)&&(index=i);return this.vertices[index]},getVertexIndex:function(vec){for(var matchedVertex=-1,l=this.vertices.length,i=0;i<l;i++){var vert;this.vertices[i].equals(vec)&&(matchedVertex=i)}return matchedVertex},getVertexForID:function(id){for(var vertex,l=this.vertices.length,i=0;i<l;i++){var v=this.vertices[i];if(v.id==id){vertex=v;break}}return vertex},getVertexNormalsAsArray:function(normals,offset,stride){void 0===offset&&(offset=0),void 0===stride&&(stride=TriangleMesh.DEFAULT_STRIDE),stride=mathUtils.max(stride,3),void 0===normals&&(normals=[]);for(var i=offset,l=this.faces.length,j=0;j<l;j++){var f=this.faces[j];normals[i]=f.a.normal.x,normals[i+1]=f.a.normal.y,normals[i+2]=f.a.normal.z,normals[i+=stride]=f.b.normal.x,normals[i+1]=f.b.normal.y,normals[i+2]=f.b.normal.z,normals[i+=stride]=f.c.normal.x,normals[i+1]=f.c.normal.y,normals[i+2]=f.c.normal.z,i+=stride}return normals},getVertices:function(){return this.vertices},handleSaveAsSTL:function(stl,useFlippedY){throw new Error("TriangleMesh.handleSaveAsSTL() currently not implemented")},init:function(name){this.setName(name),this.matrix=new Matrix4x4,this.centroid=new Vec3D,this.vertexMap=new internals.LinkedMap(vertexKeyGenerator),this.vertices=this.vertexMap.getArray(),this.faces=[],this.uniqueVertexID=0,this.intersector=new TriangleIntersector},intersectsRay:function(ray){for(var tri=this.intersector.getTriangle(),l=this.faces.length,f,i=0;i<l;i++)if(f=this.faces[i],tri.a=f.a,tri.b=f.b,tri.c=f.c,this.intersector.intersectsRay(ray))return!0;return!1},perforateFace:function(f,size){var centroid=f.getCentroid(),d=1-size,a2=f.a.interpolateTo(centroid,d),b2=f.b.interpolateTo(centroid,d),c2=f.c.interpolateTo(centroid,d);return this.removeFace(f),this.addFace(f.a,b2,a2),this.addFace(f.a,f.b,b2),this.addFace(f.b,c2,b2),this.addFace(f.b,f.c,c2),this.addFace(f.c,a2,c2),this.addFace(f.c,f.a,a2),new Triangle3D(a2,b2,c2)},pointTowards:function(dir,forward){return forward=forward||Vec3D.Z_AXIS,this.transform(Quaternion.getAlignmentQuat(dir,forward).toMatrix4x4(this.matrix),!0)},removeFace:function(f){for(var index=-1,l=this.faces.length,i=0;i<l;i++)if(this.faces[i]==f){index=i;break}index>-1&&this.faces.splice(index,1)},rotateAroundAxis:function(axis,theta){return this.transform(this.matrix.identity().rotateAroundAxis(axis,theta))},rotateX:function(theta){return this.transform(this.matrix.identity().rotateX(theta))},rotateY:function(theta){return this.transform(this.matrix.identity().rotateY(theta))},rotateZ:function(theta){return this.transform(this.matrix.identity().rotateZ(theta))},saveAsOBJ:function(obj,saveNormals){void 0===saveNormals&&(saveNormals=!0);var vOffset=obj.getCurrVertexOffset()+1,nOffset=obj.getCurrNormalOffset()+1;obj.newObject(this.name);var v=0,f=0,vlen=this.vertices.length,flen=this.faces.length,face;for(v=0;v<vlen;v++)obj.vertex(this.vertices[v]);if(saveNormals){for(v=0;v<vlen;v++)obj.normal(this.vertices[v].normal);for(f=0;f<flen;f++)face=this.faces[f],obj.faceWithNormals(face.b.id+vOffset,face.a.id+vOffset,face.c.id+vOffset,face.b.id+nOffset,face.a.id+nOffset,face.c.id+nOffset)}else for(f=0;f<flen;f++)face=this.faces[f],obj.face(face.b.id+vOffset,face.a.id+vOffset,face.c.id+vOffset)},saveAsSTL:function(a,b,c){throw new Error("TriangleMesh.saveAsSTL() currently not implemented")},scale:function(scale){return this.transform(this.matrix.identity().scaleSelf(scale))},setName:function(name){return this.name=name,this},toString:function(){return"TriangleMesh: "+this.name+" vertices: "+this.getNumVertices()+" faces: "+this.getNumFaces()},toWEMesh:function(){return new WETriangleMesh(this.name).addMesh(this)},transform:function(mat,updateNormals){void 0===updateNormals&&(updateNormals=!0);for(var l=this.vertices.length,i=0;i<l;i++){var v=this.vertices[i];v.set(mat.applyTo(v))}return updateNormals&&this.computeFaceNormals(),this},translate:function(x,y,z){return 1==arguments.length&&(y=x.y,z=x.z,x=x.x),this.transform(this.matrix.identity().translateSelf(x,y,z))},updateVertex:function(origVec3D,newPos){var vertex=this.vertexMap.get(origVec3D);return void 0!==vertex&&(this.vertexMap.remove(vertex),vertex.set(newPos),this.vertexMap.put(newPos,vertex)),this}},function(TriangleMesh){var internals=require("../../internals"),Line3D=require("../Line3D"),Vec3D=require("../Vec3D"),WEVertex=require("./Vertex").WEVertex,WEFace=require("./Face").WEFace,WingedEdge=require("./WingedEdge"),MidpointSubdivision=require("./subdiv/MidpointSubdivision"),proto;(WETriangleMesh=function(name){name=name||"untitled",TriangleMesh.call(this,name)}).DEFAULT_NUM_FACES=TriangleMesh.DEFAULT_NUM_FACES,WETriangleMesh.DEFAULT_NUM_VERTICES=TriangleMesh.DEFAULT_NUM_VERTICES,internals.extend(WETriangleMesh,TriangleMesh),(proto=WETriangleMesh.prototype).addFace=function(a,b,c,norm,uvA,uvB,uvC){6===arguments.length&&(uvC=uvB,uvB=uvA,uvA=norm,norm=void 0);var va=this.__checkVertex(a),vb=this.__checkVertex(b),vc=this.__checkVertex(c),nc,t,f;return va.id===vb.id||va.id===vc.id||vb.id===vc.id?console.log("Ignoring invalid face: "+a+","+b+","+c):(null!=norm&&(nc=va.sub(vc).crossSelf(va.sub(vb)),norm.dot(nc)<0&&(t=va,va=vb,vb=t)),f=new WEFace(va,vb,vc,uvA,uvB,uvC),this.faces.push(f),this.updateEdge(va,vb,f),this.updateEdge(vb,vc,f),this.updateEdge(vc,va,f)),this},proto.center=function(origin,callback){TriangleMesh.prototype.center.call(this,origin,callback),this.rebuildIndex()},proto.clear=function(){return TriangleMesh.prototype.clear.call(this),this.edgeMap=new internals.LinkedMap(edgeKeyGenerator),this.edges=this.edgeMap.getArray(),this},proto.copy=function(){var m=new WETriangleMesh(this.name+"-copy"),i,l,f;for(l=this.faces.length,i=0;i<l;i++)f=this.faces[i],m.addFace(f.a,f.b,f.c,f.normal,f.uvA,f.uvB,f.uvC);return m},proto._createVertex=function(vec3D,id){var vertex;return new WEVertex(vec3D,id)},proto.getNumEdges=function(){return this.edgeMap.size()},proto.init=function(name){TriangleMesh.prototype.init.call(this,name),this.edgeMap=new internals.LinkedMap(edgeKeyGenerator),this.edges=this.edgeMap.getArray(),this.__edgeCheck=new Line3D(new Vec3D,new Vec3D),this.__uniqueEdgeID=0},proto.rebuildIndex=function(){var newVertexMap=new internals.LinkedMap(vertexKeyGenerator),newEdgeMap=new internals.LinkedMap(edgeKeyGenerator),i=0,arr=this.vertexMap.getArray();for(i=0;i<arr.length;i++)newVertexMap.put(arr[i],arr[i]);for(arr=this.edgeMap.getArray(),i=0;i<arr.length;i++)newEdgeMap.put(arr[i],arr[i]);this.vertexMap=newVertexMap,this.vertices=newVertexMap.getArray(),this.edgeMap=newEdgeMap,this.edges=newEdgeMap.getArray()},proto.removeEdge=function(edge){edge.remove();var v=edge.a;0===v.edges.length&&this.vertexMap.remove(v),0===(v=edge.b).edges.length&&this.vertexMap.remove(v);for(var i=0;i<edge.faces.length;i++)this.removeFace(edge.faces[i]);var removed=this.edgeMap.remove(this.__edgeCheck.set(edge.a,edge.b));if(removed||this.edgeMap.remove(this.__edgeCheck.set(edge.b,edge.a)),removed!==edge)throw new Error("Can't remove edge")},proto.removeFace=function(face){var i=this.faces.indexOf(face),edge;for(i>-1&&this.faces.splice(i,1),i=0,i=0;i<face.edges.length;i++)(edge=face.edges[i]).faces.splice(edge.faces.indexOf(face),1),0===edge.faces.length&&this.removeEdge(edge)},proto.removeUnusedVertices=function(){internals.each(this.vertices,(function(vertex,i){var isUsed=!1;internals.each(this.faces,(function(f){f.a!=vertex&&f.b!=vertex&&f.c!=vertex||(isUsed=!0)})),isUsed||this.vertices.splice(i,1)}))},proto.removeVertices=function(selection){internals.each(selection,(function(vertex){internals.each(vertex.edges,(function(edge){internals.each(edge.faces,(function(face){this.removeFace(face)}))}))}))},proto.splitEdge=function(a,b,subDiv){var edge,mid;3===arguments.length?(edge=this.edgeMap.get(this.__edgeCheck.set(a,b)))||this.edgeMap.get(this.__edgeCheck.set(b,a)):2==arguments.length&&(edge=a,subDiv=b),mid=subDiv.computeSplitPoints(edge),this.splitFace(edge.faces[0],edge,mid),edge.faces.length>1&&this.splitFace(edge.faces[1],edge,mid),this.removeEdge(edge)},proto.splitFace=function(face,edge,midPoints){var p,i,ec,prev,num,mid;for(i=0;i<3;i++)if(!(ec=face.edges[i]).equals(edge)){p=ec.a.equals(edge.a)||ec.a.equals(edge.b)?ec.b:ec.a;break}for(num=midPoints.length,i=0;i<num;i++)mid=midPoints[i],0===i?this.addFace(p,edge.a,mid,face.normal):this.addFace(p,prev,mid,face.normal),i===num-1&&this.addFace(p,mid,edge.b,face.normal),prev=mid},proto.subdivide=function(subDiv,minLength){1===arguments.length&&(minLength=subDiv,subDiv=new MidpointSubdivision),this.subdivideEdges(this.edges.slice(0),subDiv,minLength)},proto.subdivideEdges=function(origEdges,subDiv,minLength){origEdges.sort(subDiv.getEdgeOrdering()),minLength*=minLength;var i=0,l=origEdges.length;for(i=0;i<l;i++){var e=origEdges[i];this.edges.indexOf(e)>-1&&e.getLengthSquared()>=minLength&&this.splitEdge(e,subDiv)}},proto.subdivideFaceEdges=function(faces,subDiv,minLength){var fedges=[],i,j,f,e,fl,el;for(fl=this.faces.length,i=0;i<fl;i++)for(el=(f=this.faces[i]).edges.length,j=0;j<el;j++)e=f.edges[j],fedges.indexOf(e)<0&&fedges.push(e);this.subdividEdges(fedges,subDiv,minLength)},proto.toString=function(){return"WETriangleMesh: "+this.name+" vertices: "+this.getNumVertices()+" faces: "+this.getNumFaces()+" edges:"+this.getNumEdges()},proto.transform=function(matrix,updateNormals){null==updateNormals&&(updateNormals=!0);for(var i=0,l=this.vertices.length;i<l;i++)matrix.applyToSelf(this.vertices[i]);return this.rebuildIndex(),updateNormals&&this.computeFaceNormals(),this},proto.updateEdge=function(va,vb,face){this.__edgeCheck.set(va,vb);var e=this.edgeMap.get(this.__edgeCheck);e||(this.__edgeCheck.set(vb,va),e=this.edgeMap.get(this.__edgeCheck)),void 0!==e?e.addFace(face):(e=new WingedEdge(va,vb,face,this.__uniqueEdgeID++),this.edgeMap.put(e,e),va.addEdge(e),vb.addEdge(e)),face.addEdge(e)}}(TriangleMesh),function(TriangleMesh){var internals=require("../../internals"),mathUtils=require("../../math/mathUtils"),Interpolation2D=require("../../math/Interpolation2D"),Ray3D=require("../Ray3D"),TriangleIntersector=require("../TriangleIntersector"),Triangle3D=require("../Triangle3D"),IsectData3D=require("../IsectData3D"),Vec2D=require("../vectors").Vec2D,Vec3D=require("../vectors").Vec3D;(Terrain=function(width,depth,scale){this.width=width,this._depth=depth,internals.has.XY(scale)||(scale=new Vec2D(scale,scale)),this.setScale(scale),this.elevation=[];var i=0,len=width*depth;for(i=0;i<len;i++)this.elevation[i]=0;this.__elevationLength=this.width*this._depth,this.vertices=[];var offset=new Vec3D(parseInt(this.width/2,10),0,parseInt(this._depth/2,10)),scaleXZ=this.getScale().to3DXZ();i=0;for(var z=0;z<this._depth;z++)for(var x=0;x<this.width;x++)this.vertices[i++]=new Vec3D(x,0,z).subSelf(offset).scaleSelf(scaleXZ)}).prototype={getDepth:function(){return this._depth},getElevation:function(){return this.elevation},getHeightAtCell:function(x,z){return this.elevation[this._getIndex(x,z)]},getHeightAtPoint:function(x,z){var xx=x/this._scale.x+.5*this.width,zz=z/this._scale.y+.5*this._depth,y=0,flxx=~~x,flzz=~~zz;if(xx>=0&xx<this.width&&zz>=0&&zz<this._depth){var x2=~~Math.min(xx+1,this.width-1),z2=~~Math.min(zz+1,this._depth-1),a=this.getHeightAtCell(flxx,flzz),b=this.getHeightAtCell(x2,flzz),c=this.getHeightAtCell(flxx,z2),d=this.getHeightAtCell(x2,z2);y=Interpolation2D.bilinear(xx,zz,flxx,flzz,x2,z2,a,b,c,d)}return y},_getIndex:function(x,z){var idx=z*this.width+x;if(idx<0||idx>this.__elevationLength)throw new Error("the given terrain cell is invalid: "+x+";"+z);return idx},getScale:function(){return this._scale},getVertexAtCell:function(x,z){return this.vertices[this._getIndex(x,z)]},getWidth:function(){return this.width},intersectAtPoint:function(x,z){var xx=x/this._scale.x+.5*this.width,zz=z/this._scale.y+.5*this._depth,isec=new IsectData3D;if(xx>=0&&xx<this.width&&zz>=0&&zz<this._depth){var x2=~~Math.min(xx+1,this.width-1),z2=~~Math.min(zz+1,this._depth-1),flxx=~~xx,flzz=~~zz,a=this.getVertexAtCell(flxx,flzz),b=this.getVertexAtCell(x2,flzz),c=this.getVertexAtCell(x2,z2),d=this.getVertexAtCell(flxx,z2),r=new Ray3D(new Vec3D(x,1e4,z),new Vec3D(0,-1,0)),i=new TriangleIntersector(new Triangle3D(a,b,d));i.intersectsRay(r)?isec=i.getIntersectionData():(i.setTriangle(new Triangle3D(b,c,d)),i.intersectsRay(r),isec=i.getIntersectionData())}return isec},setElevation:function(elevation){if(this.__elevationLength!=elevation.length)throw new Error("the given elevation array size does not match terrain");for(var i=0,len=elevation.length;i<len;i++)this.vertices[i].y=this.elevation[i]=elevation[i];return this},setHeightAtCell:function(x,z,h){var index=this._getIndex(x,z);return this.elevation[index]=h,this.vertices[index].y=h,this},setScale:function(scale){internals.has.XY(scale)||(scale=new Vec2D(scale,scale)),this._scale=scale},toMesh:function(){var opts={mesh:void 0,minX:0,minZ:0,maxX:this.width,maxZ:this._depth},v=this.vertices,w=this.width,d=this._depth;if(1==arguments.length&&"object"==typeof arguments[0]){var args=arguments[0];opts.mesh=args.mesh||new TriangleMesh("terrain"),opts.minX=args.minX||opts.minX,opts.minZ=args.minZ||opts.minZ,opts.maxX=args.maxX||opts.maxX,opts.maxZ=args.maxZ||opts.maxZ}else arguments.length>=5&&(opts.mesh=arguments[0],opts.minX=arguments[1],opts.minZ=arguments[2],opts.maxX=arguments[3],opts.maxZ=arguments[4]);opts.mesh=opts.mesh||new TriangleMesh("terrain"),opts.minX=mathUtils.clip(opts.minX,0,w-1),opts.maxX=mathUtils.clip(opts.maxX,0,w),opts.minZ=mathUtils.clip(opts.minZ,0,d-1),opts.maxZ=mathUtils.clip(opts.maxZ,0,d),opts.minX++,opts.minZ++;for(var z=opts.minZ,idx=opts.minX*w;z<opts.maxZ;z++,idx+=w)for(var x=opts.minX;x<opts.maxX;x++)opts.mesh.addFace(v[idx-w+x-1],v[idx-w+x],v[idx+x-1]),opts.mesh.addFace(v[idx-w+x],v[idx+x],v[idx+x-1]);return opts.mesh}}}(TriangleMesh),function(TriangleMesh){var Vec3D=require("../Vec3D"),Vec2D=require("../Vec2D");(SurfaceMeshBuilder=function(func){this.func=func}).prototype={createMesh:function(){var opts={mesh:void 0,resolution:0,size:1,isClosed:!0};if(1==arguments.length)if("object"==typeof arguments[0]){var arg=arguments[0];opts.mesh=arg.mesh,opts.resolution=arg.res||arg.resoultion||0,void 0!==arg.size&&(opts.size=arg.size),void 0!==arg.isClosed&&(opts.isClosed=arg.isClosed)}else opts.resolution=arguments[0];else arguments.length>2&&(opts.mesh=arguments[0],opts.resolution=arguments[1],opts.size=arguments[2],4==arguments.length&&(opts.isClosed=arguments[3]));var mesh=opts.mesh;null==mesh&&(mesh=new TriangleMesh);for(var a=new Vec3D,b=new Vec3D,pa=new Vec3D,pb=new Vec3D,a0=new Vec3D,b0=new Vec3D,phiRes=this.func.getPhiResolutionLimit(opts.resolution),phiRange=this.func.getPhiRange(),thetaRes=this.func.getThetaResolutionLimit(opts.resolution),thetaRange=this.func.getThetaRange(),pres=1/phiRes,tres=1/thetaRes,ires=1/opts.resolution,pauv=new Vec2D,pbuv=new Vec2D,auv=new Vec2D,buv=new Vec2D,p=0;p<phiRes;p++)for(var phi=p*phiRange*ires,phiNext=(p+1)*phiRange*ires,t=0;t<=thetaRes;t++){var theta=t*thetaRange*ires,func=this.func;a=func.computeVertexFor(a,phiNext,theta).scaleSelf(opts.size),auv.set(t*tres,1-(p+1)*pres),b=func.computeVertexFor(b,phi,theta).scaleSelf(opts.size),buv.set(t*tres,1-p*pres),b.equalsWithTolerance(a,1e-4)&&b.set(a),t>0?(t==thetaRes&&opts.isClosed&&(a.set(a0),b.set(b0)),mesh.addFace(pa,pb,a,pauv.copy(),pbuv.copy(),auv.copy()),mesh.addFace(pb,b,a,pbuv.copy(),buv.copy(),auv.copy())):(a0.set(a),b0.set(b)),pa.set(a),pb.set(b),pauv.set(auv),pbuv.set(buv)}return mesh},getFunction:function(){return this.func},setFunction:function(func){this.func=func}}}(TriangleMesh),exports.TriangleMesh=TriangleMesh,exports.WETriangleMesh=WETriangleMesh,exports.Terrain=Terrain,exports.SurfaceMeshBuilder=SurfaceMeshBuilder},{"../../internals":98,"../../math/Interpolation2D":118,"../../math/mathUtils":125,"../AABB":42,"../IsectData3D":51,"../Line3D":53,"../Matrix4x4":55,"../Quaternion":58,"../Ray3D":60,"../Sphere":63,"../Triangle3D":68,"../TriangleIntersector":69,"../Vec2D":70,"../Vec3D":71,"../vectors":96,"./Face":79,"./Vertex":88,"./WingedEdge":91,"./subdiv/MidpointSubdivision":94}],93:[function(require,module,exports){var EdgeLengthComparator=function(){};EdgeLengthComparator.prototype.compare=function(edge1,edge2){return-parseInt(edge1.getLengthSquared()-edge2.getLengthSquared(),10)},module.exports=EdgeLengthComparator},{}],94:[function(require,module,exports){var internals=require("../../../internals"),SubdivisionStrategy=require("./SubdivisionStrategy"),MidpointSubdivison=function(){SubdivisionStrategy.call(this)};internals.extend(MidpointSubdivison,SubdivisionStrategy),MidpointSubdivison.prototype.computeSplitPoints=function(edge){var mid=[];return mid.push(edge.getMidPoint()),mid},module.exports=MidpointSubdivison},{"../../../internals":98,"./SubdivisionStrategy":95}],95:[function(require,module,exports){var EdgeLengthComparator=require("./EdgeLengthComparator"),SubdivisionStrategy,proto;(SubdivisionStrategy=function(){this._order=SubdivisionStrategy.DEFAULT_ORDERING}).DEFAULT_ORDERING=new EdgeLengthComparator,(proto=SubdivisionStrategy.prototype).getEdgeOrdering=function(){return this._order.compare},proto.setEdgeOrdering=function(order){this._order=order},module.exports=SubdivisionStrategy},{"./EdgeLengthComparator":93}],96:[function(require,module,exports){var mathUtils=require("../math/mathUtils"),has=require("../internals/has"),is=require("../internals/is"),hasXY=has.XY,isRect=is.Rect,Vec2D,Vec3D;(Vec2D=function(a,b){hasXY(a)?(b=a.y,a=a.x):(a=a||0,b=b||0),this.x=a,this.y=b}).Axis={X:{getVector:function(){return Vec2D.X_AXIS},toString:function(){return"Vec2D.Axis.X"}},Y:{getVector:function(){return Vec2D.Y_AXIS},toString:function(){return"Vec2D.Axis.Y"}}};var _getXY=(temp={x:0,y:0},function getXY(a,b){return a&&"number"==typeof a.x&&"number"==typeof a.y?a:(void 0!==a&&void 0===b?b=a:void 0===a?a=0:void 0===b&&(b=0),temp.x=a,temp.y=b,temp)}),temp;(Vec2D.prototype={abs:function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this},add:function(a,b){var v=new Vec2D(a,b);return v.x+=this.x,v.y+=this.y,v},addSelf:function(a,b){var v=_getXY(a,b);return this.x+=v.x,this.y+=v.y,this},angleBetween:function(v,faceNormalize){if(void 0===faceNormalize)return Math.acos(this.dot(v));var theta=faceNormalize?this.getNormalized().dot(v.getNormalized()):this.dot(v);return Math.acos(mathUtils.clipNormalized(theta))},clear:function(){return this.x=this.y=0,this},compareTo:function(vec){return this.x==vec.x&&this.y==vec.y?0:this.magSquared()-vec.magSquared()},constrain:function(a,b){return hasXY(a)&&hasXY(b)?(this.x=mathUtils.clip(this.x,a.x,b.x),this.y=mathUtils.clip(this.y,a.y,b.y)):isRect(a)&&(this.x=mathUtils.clip(this.x,a.x,a.x+a.width),this.y=mathUtils.clip(this.y,a.y,a.y+a.height)),this},copy:function(){return new Vec2D(this)},cross:function(v){return this.x*v.y-this.y*v.x},distanceTo:function(v){if(void 0!==v){var dx=this.x-v.x,dy=this.y-v.y;return Math.sqrt(dx*dx+dy*dy)}return NaN},distanceToSquared:function(v){if(void 0!==v){var dx=this.x-v.x,dy=this.y-v.y;return dx*dx+dy*dy}return NaN},dot:function(v){return this.x*v.x+this.y*v.y},equals:function(obj){return!!hasXY(obj)&&(this.x==obj.x&&this.y==obj.y)},equalsWithTolerance:function(v,tolerance){return!!hasXY(v)&&(mathUtils.abs(this.x-v.x)<tolerance&&mathUtils.abs(this.y-v.y)<tolerance)},floor:function(){return this.x=mathUtils.floor(this.x),this.y=mathUtils.floor(this.y),this},frac:function(){return this.x-=mathUtils.floor(this.x),this.y-=mathUtils.floor(this.y),this},getAbs:function(){return new Vec2D(this).abs()},getComponent:function(id){return"number"==typeof id&&(id=0===id?Vec2D.Axis.X:Vec2D.Axis.Y),id==Vec2D.Axis.X?this.x:id==Vec2D.Axis.Y?this.y:0},getConstrained:function(r){return new Vec2D(this).constrain(r)},getFloored:function(){return new Vec2D(this).floor()},getFrac:function(){return new Vec2D(this).frac()},getInverted:function(){return new Vec2D(-this.x,-this.y)},getLimited:function(lim){return this.magSquared()>lim*lim?this.getNormalizedTo(lim):new Vec2D(this)},getNormalized:function(){return new Vec2D(this).normalize()},getNormalizedTo:function(len){return new Vec2D(this).normalizeTo(len)},getPerpendicular:function(){return new Vec2D(this).perpendicular()},getReciprocal:function(){return new Vec2D(this).reciprocal()},getReflected:function(normal){return new Vec2D(this).reflect(normal)},getRotated:function(theta){return new Vec2D(this).rotate(theta)},getSignum:function(){return new Vec2D(this).signum()},heading:function(){return Math.atan2(this.y,this.x)},interpolateTo:function(v,f,s){return void 0===s?new Vec2D(this.x+(v.x-this.x)*f,this.y+(v.y-this.y)*f):new Vec2D(s.interpolate(this.x,v.x,f),s.interpolate(this.y,v.y,f))},interpolateToSelf:function(v,f,s){return void 0===s?(this.x+=(v.x-this.x)*f,this.y+=(v.y-this.y)*f):(this.x=s.interpolate(this.x,v.x,f),this.y=s.interpolate(this.y,v.y,f)),this},invert:function(){return this.x*=-1,this.y*=-1,this},isInCircle:function(sO,sR){var d;return this.sub(sO).magSquared()<=sR*sR},isInRectangle:function(rect){return!(this.x<rect.x||this.x>rect.x+rect.width)&&!(this.y<rect.y||this.y>rect.y+rect.height)},isInTriangle:function(a,b,c){var v1=this.sub(a).normalize(),v2=this.sub(b).normalize(),v3=this.sub(c).normalize(),total_angles=Math.acos(v1.dot(v2));return total_angles+=Math.acos(v2.dot(v3)),total_angles+=Math.acos(v3.dot(v1)),Math.abs(total_angles-mathUtils.TWO_PI)<=.005},isMajorAxis:function(tol){var ax=Math.abs(this.x),ay=Math.abs(this.y),itol=1-tol;return ax>itol?ay<tol:ay>itol&&ax<tol},isZeroVector:function(){return Math.abs(this.x)<mathUtils.EPS&&Math.abs(this.y)<mathUtils.EPS},jitter:function(a,b){var v=_getXY(a,b);return this.x+=mathUtils.normalizedRandom()*v.x,this.y+=mathUtils.normalizedRandom()*v.y,this},limit:function(lim){return this.magSquared()>lim*lim?this.normalize().scaleSelf(lim):this},magnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},magSquared:function(){return this.x*this.x+this.y*this.y},max:function(v){return new Vec2D(mathUtils.max(this.x,v.x),mathUtils.max(this.y,v.y))},maxSelf:function(v){return this.x=mathUtils.max(this.x,v.x),this.y=mathUtils.max(this.y,v.y),this},min:function(v){return new Vec2D(mathUtils.min(this.x,v.x),mathUtils.min(this.y,v.y))},minSelf:function(v){return this.x=mathUtils.min(this.x,v.x),this.y=mathUtils.min(this.y,v.y),this},normalize:function(){var mag=this.x*this.x+this.y*this.y;return mag>0&&(mag=1/Math.sqrt(mag),this.x*=mag,this.y*=mag),this},normalizeTo:function(len){var mag=Math.sqrt(this.x*this.x+this.y*this.y);return mag>0&&(mag=len/mag,this.x*=mag,this.y*=mag),this},perpendicular:function(){var t=this.x;return this.x=-this.y,this.y=t,this},positiveHeading:function(){var dist=Math.sqrt(this.x*this.x+this.y*this.y);return this.y>=0?Math.acos(this.x/dist):Math.acos(-this.x/dist)+mathUtils.PI},reciprocal:function(){return this.x=1/this.x,this.y=1/this.y,this},reflect:function(normal){return this.set(normal.scale(2*this.dot(normal)).subSelf(this))},rotate:function(theta){var co=Math.cos(theta),si=Math.sin(theta),xx=co*this.x-si*this.y;return this.y=si*this.x+co*this.y,this.x=xx,this},roundToAxis:function(){return Math.abs(this.x)<.5?this.x=0:(this.x=this.x<0?-1:1,this.y=0),Math.abs(this.y)<.5?this.y=0:(this.y=this.y<0?-1:1,this.x=0),this},scale:function(a,b){var v=_getXY(a,b);return new Vec2D(this.x*v.x,this.y*v.y)},scaleSelf:function(a,b){var v=_getXY(a,b);return this.x*=v.x,this.y*=v.y,this},set:function(a,b){var v=_getXY(a,b);return this.x=v.x,this.y=v.y,this},setComponent:function(id,val){return"number"==typeof id&&(id=0===id?Vec2D.Axis.X:Vec2D.Axis.Y),id===Vec2D.Axis.X?this.x=val:id===Vec2D.Axis.Y&&(this.y=val),this},signum:function(){return this.x=this.x<0?-1:0===this.x?0:1,this.y=this.y<0?-1:0===this.y?0:1,this},sub:function(a,b){var v=_getXY(a,b);return new Vec2D(this.x-v.x,this.y-v.y)},subSelf:function(a,b){var v=_getXY(a,b);return this.x-=v.x,this.y-=v.y,this},tangentNormalOfEllipse:function(eO,eR){var p=this.sub(eO),xr2=eR.x*eR.x,yr2=eR.y*eR.y;return new Vec2D(p.x/xr2,p.y/yr2).normalize()},toArray:function(){return[this.x,this.y]},toCartesian:function(){var xx=this.x*Math.cos(this.y);return this.y=this.x*Math.sin(this.y),this.x=xx,this},toPolar:function(){var r=Math.sqrt(this.x*this.x+this.y*this.y);return this.y=Math.atan2(this.y,this.x),this.x=r,this},toString:function(){var s;return"{x:"+this.x+", y:"+this.y+"}"}}).bisect=function(b){var diff=this.sub(b),sum=this.add(b),dot=diff.dot(sum);return new Vec3D(diff.x,diff.y,-dot/2)},Vec2D.prototype.to3DXY=function(){return new Vec3D(this.x,this.y,0)},Vec2D.prototype.to3DXZ=function(){return new Vec3D(this.x,0,this.y)},Vec2D.prototype.to3DYZ=function(){return new Vec3D(0,this.x,this.y)},Vec2D.X_AXIS=new Vec2D(1,0),Vec2D.Y_AXIS=new Vec2D(0,1),Vec2D.ZERO=new Vec2D,Vec2D.MIN_VALUE=new Vec2D(Number.MIN_VALUE,Number.MIN_VALUE),Vec2D.MAX_VALUE=new Vec2D(Number.MAX_VALUE,Number.MAX_VALUE),Vec2D.fromTheta=function(theta){return new Vec2D(Math.cos(theta),Math.sin(theta))},Vec2D.max=function(a,b){return new Vec2D(mathUtils.max(a.x,b.x),mathUtils.max(a.y,b.y))},Vec2D.min=function(a,b){return new Vec2D(mathUtils.min(a.x,b.x),mathUtils.min(a.y,b.y))},Vec2D.randomVector=function(rnd){var v;return new Vec2D(2*Math.random()-1,2*Math.random()-1).normalize()},(Vec3D=function(x,y,z){has.XYZ(x)?(this.x=x.x,this.y=x.y,this.z=x.z):void 0===x?(this.x=0,this.y=0,this.z=0):(this.x=x,this.y=y,this.z=z)}).prototype={abs:function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this.z=Math.abs(this.z),this},add:function(a,b,c){return has.XYZ(a)?new Vec3D(this.x+a.x,this.y+a.y,this.z+a.z):new Vec3D(this.x+a,this.y+b,this.z+c)},addSelf:function(a,b,c){return void 0!==a&&void 0!==b&&void 0!==c?(this.x+=a,this.y+=b,this.z+=c):(this.x+=a.x,this.y+=a.y,this.z+=a.z),this},angleBetween:function(vec,faceNormalizeBool){var theta;return theta=faceNormalizeBool?this.getNormalized().dot(vec.getNormalized()):this.dot(vec),Math.acos(theta)},clear:function(){return this.x=this.y=this.z=0,this},compareTo:function(vec){return this.x==vec.x&&this.y==vec.y&&this.z==vec.z?0:this.magSquared()-vec.magSqaured()},constrain:function(box_or_min,max){var min;return is.AABB(box_or_min)?(max=box_or_min.getMax(),min=box_or_min.getMin()):min=box_or_min,this.x=mathUtils.clip(this.x,min.x,max.x),this.y=mathUtils.clip(this.y,min.y,max.y),this.z=mathUtils.clip(this.z,min.z,max.z),this},copy:function(){return new Vec3D(this)},cross:function(vec){return new Vec3D(this.y*vec.z-vec.y*this.z,this.z*vec.x-vec.z*this.x,this.x*vec.y-vec.x*this.y)},crossInto:function(vec,result){var vx=vec.x,vy=vec.y,vz=vec.z;return result.x=this.y*vz-vy*this.z,result.y=this.z*vx-vz*this.x,result.z=this.x*vy-vx*this.y,result},crossSelf:function(vec){var cx=this.y*vec.z-vec.y*this.z,cy=this.z*vec.x-vec.z*this.x;return this.z=this.x*vec.y-vec.x*this.y,this.y=cy,this.x=cx,this},distanceTo:function(vec){if(void 0!==vec){var dx=this.x-vec.x,dy=this.y-vec.y,dz=this.z-vec.z;return Math.sqrt(dx*dx+dy*dy+dz*dz)}return NaN},distanceToSquared:function(vec){if(void 0!==vec){var dx=this.x-vec.x,dy=this.y-vec.y,dz=this.z-vec.z;return dx*dx+dy*dy+dz*dz}return NaN},dot:function(vec){return this.x*vec.x+this.y*vec.y+this.z*vec.z},equals:function(vec){return!!has.XYZ(vec)&&(this.x==vec.x&&this.y==vec.y&&this.z==vec.z)},equalsWithTolerance:function(vec,tolerance){return Math.abs(this.x-vec.x)<tolerance&&Math.abs(this.y-vec.y)<tolerance&&Math.abs(this.z-vec.z)<tolerance},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},frac:function(){return this.x-=Math.floor(this.x),this.y-=Math.floor(this.y),this.z-=Math.floor(this.z),this},getAbs:function(){return new Vec3D(this).abs()},getComponent:function(id){switch("number"==typeof id&&(id=id===Vec3D.Axis.X?0:id===Vec3D.Axis.Y?1:2),id){case 0:return this.x;case 1:return this.y;case 2:return this.z}},getConstrained:function(box){return new Vec3D(this).constrain(box)},getFloored:function(){return new Vec3D(this).floor()},getFrac:function(){return new Vec3D(this).frac()},getInverted:function(){return new Vec3D(-this.x,-this.y,-this.z)},getLimited:function(limit){return this.magSquared()>limit*limit?this.getNormalizedTo(limit):new Vec3D(this)},getNormalized:function(){return new Vec3D(this).normalize()},getNormalizedTo:function(length){return new Vec3D(this).normalizeTo(length)},getReciprocal:function(){return this.copy().reciprocal()},getReflected:function(normal){return this.copy().reflect(normal)},getRotatedAroundAxis:function(vec_axis,theta){return new Vec3D(this).rotateAroundAxis(vec_axis,theta)},getRotatedX:function(theta){return new Vec3D(this).rotateX(theta)},getRotatedY:function(theta){return new Vec3D(this).rotateY(theta)},getRotatedZ:function(theta){return new Vec3D(this).rotateZ(theta)},getSignum:function(){return new Vec3D(this).signum()},headingXY:function(){return Math.atan2(this.y,this.x)},headingXZ:function(){return Math.atan2(this.z,this.x)},headingYZ:function(){return Math.atan2(this.y,this.z)},immutable:function(){return this},interpolateTo:function(v,f,s){return void 0===s?new Vec3D(this.x+(v.x-this.x)*f,this.y+(v.y-this.y)*f,this.z+(v.z-this.z)*f):new Vec3D(s.interpolate(this.y,v.y,f),s.interpolate(this.y,v.y,f),s.interpolate(this.z,v.z,f))},interpolateToSelf:function(v,f,s){return void 0===s?(this.x+=(v.x-this.x)*f,this.y+=(v.y-this.y)*f,this.z+=(v.z-this.z)*f):(this.x=s.interpolate(this.x,v.x,f),this.y=s.interpolate(this.y,v.y,f),this.z=s.interpolate(this.z,v.z,f)),this},invert:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},isInAABB:function(box_or_origin,boxExtent){if(boxExtent){var w=boxExtent.x;if(this.x<box_or_origin.x-w||this.x>box_or_origin.x+w)return!1;if(w=boxExtent.y,this.y<box_or_origin.y-w||this.y>box_or_origin.y+w)return!1;if(w=boxExtent.y,this.z<box_or_origin.z-w||this.y>box_or_origin.z+w)return!1}else{var min=box_or_origin.getMin(),max=box_or_origin.getMax();if(this.x<min.x||this.x>max.x)return!1;if(this.y<min.y||this.y>max.y)return!1;if(this.z<min.z||this.z>max.z)return!1}return!0},isMajorAxis:function(tol){var ax=mathUtils.abs(this.x),ay=mathUtils.abs(this.y),az=mathUtils.abs(this.z),itol=1-tol;if(ax>itol){if(ay<tol)return az<tol}else if(ay>itol){if(ax<tol)return az<tol}else if(az>itol&&ax<tol)return ay<tol;return!1},isZeroVector:function(){return Math.abs(this.x)<mathUtils.EPS&&Math.abs(this.y)<mathUtils.EPS&&mathUtils.abs(this.z)<mathUtils.EPS},jitter:function(a,b,c){return void 0!==b&&void 0!==c||(b=c=a),this.x+=mathUtils.normalizedRandom()*a,this.y+=mathUtils.normalizedRandom()*b,this.z+=mathUtils.normalizedRandom()*c,this},limit:function(lim){return this.magSquared()>lim*lim?this.normalize().scaleSelf(lim):this},magnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},magSquared:function(){return this.x*this.x+this.y*this.y+this.z*this.z},maxSelf:function(vec){return this.x=Math.max(this.x,vec.x),this.y=Math.max(this.y,vec.y),this.z=Math.max(this.z,vec.z),this},minSelf:function(vec){return this.x=Math.min(this.x,vec.x),this.y=Math.min(this.y,vec.y),this.z=Math.min(this.z,vec.z),this},modSelf:function(basex,basey,basez){return void 0!==basey&&void 0!==basez||(basey=basez=basex),this.x%=basex,this.y%=basey,this.z%=basez,this},normalize:function(){var mag=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return mag>0&&(mag=1/mag,this.x*=mag,this.y*=mag,this.z*=mag),this},normalizeTo:function(length){var mag=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return mag>0&&(mag=length/mag,this.x*=mag,this.y*=mag,this.z*=mag),this},reciprocal:function(){return this.x=1/this.x,this.y=1/this.y,this.z=1/this.z,this},reflect:function(normal){return this.set(normal.scale(2*this.dot(normal)).subSelf(this))},rotateAroundAxis:function(vec_axis,theta){var ax=vec_axis.x,ay=vec_axis.y,az=vec_axis.z,ux=ax*this.x,uy=ax*this.y,uz=ax*this.z,vx=ay*this.x,vy=ay*this.y,vz=ay*this.z,wx=az*this.x,wy=az*this.y,wz=az*this.z,si=Math.sin(theta),co=Math.cos(theta),xx=ax*(ux+vy+wz)+(this.x*(ay*ay+az*az)-ax*(vy+wz))*co+(-wy+vz)*si,yy=ay*(ux+vy+wz)+(this.y*(ax*ax+az*az)-ay*(ux+wz))*co+(wx-uz)*si,zz=az*(ux+vy+wz)+(this.z*(ax*ax+ay*ay)-az*(ux+vy))*co+(-vx+uy)*si;return this.x=xx,this.y=yy,this.z=zz,this},rotateX:function(theta){var co=Math.cos(theta),si=Math.sin(theta),zz=co*this.z-si*this.y;return this.y=si*this.z+co*this.y,this.z=zz,this},rotateY:function(theta){var co=Math.cos(theta),si=Math.sin(theta),xx=co*this.x-si*this.z;return this.z=si*this.x+co*this.z,this.x=xx,this},rotateZ:function(theta){var co=Math.cos(theta),si=Math.sin(theta),xx=co*this.x-si*this.y;return this.y=si*this.x+co*this.y,this.x=xx,this},roundToAxis:function(){return Math.abs(this.x)<.5?this.x=0:(this.x=this.x<0?-1:1,this.y=this.z=0),Math.abs(this.y)<.5?this.y=0:(this.y=this.y<0?-1:1,this.x=this.z=0),Math.abs(this.z)<.5?this.z=0:(this.z=this.z<0?-1:1,this.x=this.y=0),this},scale:function(a,b,c){return has.XYZ(a)?new Vec3D(this.x*a.x,this.y*a.y,this.z*a.z):(void 0!==b&&void 0!==c||(b=c=a),new Vec3D(this.x*a,this.y*b,this.z*c))},scaleSelf:function(a,b,c){return has.XYZ(a)?(this.x*=a.x,this.y*=a.y,this.z*=a.z,this):(void 0!==b&&void 0!==c||(b=c=a),this.x*=a,this.y*=b,this.z*=c,this)},set:function(a,b,c){return has.XYZ(a)?(this.x=a.x,this.y=a.y,this.z=a.z,this):(void 0!==b&&void 0!==c||(b=c=a),this.x=a,this.y=b,this.z=c,this)},setXY:function(v){return this.x=v.x,this.y=v.y,this},shuffle:function(nIterations){for(var t,i=0;i<nIterations;i++)switch(Math.floor(3*Math.random())){case 0:t=this.x,this.x=this.y,this.z=t;break;case 1:t=this.x,this.x=this.z,this.z=t;break;case 2:t=this.y,this.y=this.z,this.z=t}return this},signum:function(){return this.x=this.x<0?-1:0===this.x?0:1,this.y=this.y<0?-1:0===this.y?0:1,this.z=this.z<0?-1:0===this.z?0:1,this},sub:function(a,b,c){return has.XYZ(a)?new Vec3D(this.x-a.x,this.y-a.y,this.z-a.z):(void 0!==b&&void 0!==c||(b=c=a),new Vec3D(this.x-a,this.y-b,this.z-c))},subSelf:function(a,b,c){return has.XYZ(a)?(this.x-=a.x,this.y-=a.y,this.z-=a.z,this):(void 0!==b&&void 0!==c||(b=c=a),this.x-=a,this.y-=b,this.z-=c,this)},to2DXY:function(){return new Vec2D(this.x,this.y)},to2DXZ:function(){return new Vec2D(this.x,this.z)},to2DYZ:function(){return new Vec2D(this.y,this.z)},toArray:function(){return[this.x,this.y,this.z]},toArray4:function(w){var ta=this.toArray();return ta[3]=w,ta},toCartesian:function(){var a=this.x*Math.cos(this.z),xx=a*Math.cos(this.y),yy=this.x*Math.sin(this.z),zz=a*Math.sin(this.y);return this.x=xx,this.y=yy,this.z=zz,this},toSpherical:function(){var xx=Math.abs(this.x)<=mathUtils.EPS?mathUtils.EPS:this.x,zz=this.z,radius=Math.sqrt(xx*xx+this.y*this.y+zz*zz);return this.z=Math.asin(this.y/radius),this.y=Math.atan(zz/xx)+(xx<0?Math.PI:0),this.x=radius,this},toString:function(){return"[ x: "+this.x+", y: "+this.y+", z: "+this.z+"]"}},Vec3D.MIN_VALUE=new Vec3D(Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE),Vec3D.MAX_VALUE=new Vec3D(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),Vec3D.fromXYTheta=function(theta){return new Vec3D(Math.cos(theta),Math.sin(theta),0)},Vec3D.fromXZTheta=function(theta){return new Vec3D(Math.cos(theta),0,Math.sin(theta))},Vec3D.fromYZTheta=function(theta){return new Vec3D(0,Math.cos(theta),Math.sin(theta))},Vec3D.max=function(a,b){return new Vec3D(Math.max(a.x,b.x),Math.max(a.y,b.y),Math.max(a.z,b.z))},Vec3D.min=function(a,b){return new Vec3D(Math.min(a.x,b.x),Math.min(a.y,b.y),Math.min(a.z,b.z))},Vec3D.randomVector=function(){var v;return new Vec3D(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1).normalize()},Vec3D.ZERO=new Vec3D(0,0,0),Vec3D.X_AXIS=new Vec3D(1,0,0),Vec3D.Y_AXIS=new Vec3D(0,1,0),Vec3D.Z_AXIS=new Vec3D(0,0,1),Vec3D.Axis={X:{getVector:function(){return Vec3D.X_AXIS},toString:function(){return"Vec3D.Axis.X"}},Y:{getVector:function(){return Vec3D.Y_AXIS},toString:function(){return"Vec3D.Axis.Y"}},Z:{getVector:function(){return Vec3D.Z_AXIS},toString:function(){return"Vec3D.Axis.Z"}}},exports.Vec2D=Vec2D,exports.Vec3D=Vec3D},{"../internals/has":105,"../internals/is":106,"../math/mathUtils":125}],97:[function(require,module,exports){exports.color=require("./color"),exports.geom=require("./geom"),exports.internals=require("./internals"),exports.math=require("./math"),exports.physics2d=require("./physics2d"),exports.processing=require("./processing"),exports.THREE=require("./THREE"),exports.util=require("./util")},{"./THREE":1,"./color":3,"./geom":41,"./internals":98,"./math":112,"./physics2d":140,"./processing":160,"./util":162}],98:[function(require,module,exports){exports.is=require("./internals/is"),exports.has=require("./internals/has"),exports.extend=require("./internals/extend"),exports.each=require("./internals/each"),exports.bind=require("./internals/bind"),exports.keys=require("./internals/keys"),exports.values=require("./internals/values"),exports.filter=require("./internals/filter"),exports.mixin=require("./internals/mixin"),exports.Iterator=require("./internals/Iterator"),exports.LinkedMap=require("./internals/LinkedMap"),exports.numberComparator=require("./internals/numberComparator"),exports.removeItemFrom=require("./internals/removeItemFrom")},{"./internals/Iterator":99,"./internals/LinkedMap":100,"./internals/bind":101,"./internals/each":102,"./internals/extend":103,"./internals/filter":104,"./internals/has":105,"./internals/is":106,"./internals/keys":107,"./internals/mixin":108,"./internals/numberComparator":109,"./internals/removeItemFrom":110,"./internals/values":111}],99:[function(require,module,exports){var is=require("./is"),ArrayIterator=function(collection){this.__it=collection.slice(0)};ArrayIterator.prototype={hasNext:function(){return this.__it.length>0},next:function(){return this.__it.shift()}};var ObjectIterator=function(object){for(var prop in this.__obj={},this.__keys=[],object)this.__obj[prop]=object[prop],this.__keys.push(prop);this.__it=new ArrayIterator(this.__keys)};ObjectIterator.prototype={hasNext:function(){return this.__it.hasNext()},next:function(){var key=this.__it.next();return this.__obj[key]}};var Iterator=function(collection){return is.array(collection)?new ArrayIterator(collection):new ObjectIterator(collection)};module.exports=Iterator},{"./is":106}],100:[function(require,module,exports){var each=require("./each"),LinkedMap=function(keyGeneratorFunction){this.__list=[],this.__map={},"function"==typeof keyGeneratorFunction&&(this.generateKey=keyGeneratorFunction)};LinkedMap.prototype={each:function(fn){each(this.__map,fn)},get:function(id_or_val){var result=this.__map[id_or_val];return void 0===result&&(id_or_val=this.generateKey(id_or_val),result=this.__map[id_or_val]),result},generateKey:function(key){return key.toString()},getArray:function(){return this.__list},has:function(id_or_val){var self=this,_has;return!!function(id){return void 0!==self.__map[id]}(id_or_val)||(!!this.__map[id]||this.__map[this.generateKey(id_or_val)])},put:function(id,val){id=this.generateKey(id),this.__map[id]=val,this.__list.push(val)},remove:function(val){val=this.get(val);var id=this.generateKey(val);return delete this.__map[id],this.__list.splice(this.__list.indexOf(val),1)[0]},size:function(){return this.__list.length},values:function(){return this.__list.slice(0)}},module.exports=LinkedMap},{"./each":102}],101:[function(require,module,exports){var ctor={};module.exports=function(func,context){var args,bound,FP=Function.prototype,slice=Array.prototype.slice;return func.bind===FP.bind&&FP.bind?FP.bind.apply(func,slice.call(arguments,1)):(args=slice.call(arguments,2),bound=function(){if(!(this instanceof bound))return func.apply(context,args.concat(slice.call(arguments)));ctor.prototype=func.prototype;var self=new ctor;ctor.prototype=null;var result=func.apply(self,args.concat(slice.call(arguments)));return Object(result)===result?result:self})}},{}],102:[function(require,module,exports){var breaker={};module.exports=function(obj,iterator,context){if(null!=obj)if(Array.prototype.forEach&&obj.forEach===Array.prototype.forEach)obj.forEach(iterator,context);else if(obj.length===+obj.length){for(var i=0,l=obj.length;i<l;i++)if(i in obj&&iterator.call(context,obj[i],i,obj)===breaker)return}else for(var key in obj)if(hasOwnProperty.call(obj,key)&&iterator.call(context,obj[key],key,obj)===breaker)return}},{}],103:[function(require,module,exports){module.exports=function(childClass,superClass){if("function"!=typeof childClass)throw Error("childClass was not function, possible circular: ",childClass);if("function"!=typeof superClass)throw Error("superClass was not function, possible circular: ",superClass);childClass.prototype=Object.create(superClass.prototype),childClass.constructor=childClass,childClass.prototype.parent=superClass.prototype}},{}],104:[function(require,module,exports){module.exports=function(obj,iterator,context){var results=[];return null==obj?results:Array.prototype.filter&&obj.filter===Array.prototype.filter?obj.filter(iterator,context):(exports.each(obj,(function(value,index,list){iterator.call(context,value,index,list)&&(results[results.length]=value)})),results)}},{}],105:[function(require,module,exports){var all=function(subject,properties){if(void 0===subject||"object"!=typeof subject)return!1;var i=0,len=properties.length,prop;for(i=0;i<len;i++)if(!((prop=properties[i])in subject))return!1;return!0};exports.property=function(obj,key){return hasOwnProperty.call(obj,key)},exports.all=all,exports.typedArrays=function(){return"undefined"!=typeof Int32Array&&"undefined"!=typeof Float32Array&&"undefined"!=typeof Uint8Array},exports.XY=function(a){return a&&"number"==typeof a.x&&"number"==typeof a.y},exports.XYZ=function(a){return a&&"number"==typeof a.x&&"number"==typeof a.y&&"number"==typeof a.z},exports.XYWidthHeight=function(a){return a&&"number"==typeof a.x&&"number"==typeof a.y&&"number"==typeof a.width&&"number"==typeof a.height}},{}],106:[function(require,module,exports){var has=require("./has"),apply=function(properties){return function(o){return has.all(o,properties)}};exports.Array=Array.isArray||function(a){return"[object Array]"==a.toString()},exports.Object=function(a){return"object"==typeof a},exports.undef=function(a){return void 0===a},exports.existy=function(a){return null!=a},exports.String=function(a){return"string"==typeof a},exports.Number=function(a){return"number"==typeof a},exports.Function=function(a){return"function"==typeof a},exports.AABB=apply(["setExtent","getNormalForPoint"]),exports.ColorGradient=apply(["gradient","interpolator","maxDither","addColorAt","calcGradient"]),exports.ColorList=apply(["add","addAll","adjustBrightness","adjustSaturation"]),exports.ColorRange=apply(["add","addAlphaRange","addBrightnessRange","addHueRange"]),exports.Circle=apply(["getCircumference","getRadius","intersectsCircle"]),exports.FloatRange=apply(["min","max","adjustCurrentBy","getMedian"]),exports.Hue=apply(["getHue","isPrimary"]),exports.Line2D=apply(["closestPointTo","intersectLine","getLength"]),exports.Matrix4x4=apply(["identity","invert","setFrustrum"]),exports.Rect=apply(["x","y","width","height","getArea","getCentroid","getDimensions"]),exports.Sphere=apply(["x","y","z","radius","toMesh"]),exports.ScaleMap=apply(["mapFunction","setInputRange","setOutputRange","getMappedValueFor"]),exports.TColor=apply(["rgb","cmyk","hsv"]),exports.ParticleBehavior=apply(["applyBehavior","configure"]),exports.VerletParticle2D=apply(["x","y","weight"])},{"./has":105}],107:[function(require,module,exports){module.exports=Object.keys||function(obj){if(obj!==Object(obj))throw new TypeError("Invalid object");var keys=[];for(var key in obj)exports.has(obj,key)&&keys.push(key);return keys}},{}],108:[function(require,module,exports){var each=require("./each");module.exports=function(destination,source){return each(source,(function(val,key){destination[key]=val})),destination}},{"./each":102}],109:[function(require,module,exports){module.exports=function(f1,f2){return f1==f2?0:f1<f2?-1:f1>f2?1:void 0}},{}],110:[function(require,module,exports){module.exports=function(item,array){var index=array.indexOf(item);if(index>-1)return array.splice(index,1)}},{}],111:[function(require,module,exports){var has=require("./has");module.exports=function(obj){var values=[];for(var key in obj)has.property(obj,key)&&values.push(obj[key]);return values}},{"./has":105}],112:[function(require,module,exports){module.exports={BezierInterpolation:require("./math/BezierInterpolation"),CircularInterpolation:require("./math/CircularInterpolation"),CosineInterpolation:require("./math/CosineInterpolation"),DecimatedInterpolation:require("./math/DecimatedInterpolation"),ExponentialInterpolation:require("./math/ExponentialInterpolation"),Interpolation2D:require("./math/Interpolation2D"),LinearInterpolation:require("./math/LinearInterpolation"),mathUtils:require("./math/mathUtils"),MathUtils:require("./math/mathUtils"),ScaleMap:require("./math/ScaleMap"),SigmoidInterpolation:require("./math/SigmoidInterpolation"),SinCosLUT:require("./math/SinCosLUT"),ThresholdInterpolation:require("./math/ThresholdInterpolation"),ZoomLensInterpolation:require("./math/ZoomLensInterpolation")},module.exports.noise=require("./math/noise"),module.exports.waves=require("./math/waves")},{"./math/BezierInterpolation":113,"./math/CircularInterpolation":114,"./math/CosineInterpolation":115,"./math/DecimatedInterpolation":116,"./math/ExponentialInterpolation":117,"./math/Interpolation2D":118,"./math/LinearInterpolation":119,"./math/ScaleMap":120,"./math/SigmoidInterpolation":121,"./math/SinCosLUT":122,"./math/ThresholdInterpolation":123,"./math/ZoomLensInterpolation":124,"./math/mathUtils":125,"./math/noise":126,"./math/waves":129}],113:[function(require,module,exports){var BezierInterpolation=function(h1,h2){this.c1=h1,this.c2=h2};BezierInterpolation.interpolate=function(a,b,t,c1,c2){var tSquared=t*t,invT=1-t,invTSquared=invT*invT;return a*invTSquared*invT+3*(c1*(b-a)+a)*t*invTSquared+3*(c2*(b-a)+b)*tSquared*invT+b*tSquared*t},BezierInterpolation.prototype={interpolate:function(a,b,t){var tSquared=t*t,invT=1-t,invTSquared=invT*invT;return a*invTSquared*invT+3*(this.c1*(b-a)+a)*t*invTSquared+3*(this.c2*(b-a)+b)*tSquared*invT+b*tSquared*t},setCoefficients:function(a,b){this.c1=a,this.c2=b}},module.exports=BezierInterpolation},{}],114:[function(require,module,exports){var CircularInterpolation=function(isFlipped){void 0===isFlipped&&(this.isFlipped=!1)};CircularInterpolation.interpolate=function(a,b,f,isFlipped){return isFlipped?a-(b-a)*(Math.sqrt(1-f*f)-1):(f=1-f,a+(b-a)*Math.sqrt(1-f*f))},CircularInterpolation.prototype.interpolate=function(a,b,f){return this.isFlipped?a-(b-a)*(Math.sqrt(1-f*f)-1):(f=1-f,a+(b-a)*Math.sqrt(1-f*f))},CircularInterpolation.prototype.setFlipped=function(isFlipped){this.isFlipped=isFlipped},module.exports=CircularInterpolation},{}],115:[function(require,module,exports){var CosineInterpolation=function(){};CosineInterpolation.interpolate=function(a,b,f){return b+(a-b)*(.5+.5*Math.cos(f*Math.PI))},CosineInterpolation.prototype.interpolate=CosineInterpolation.interpolate,module.exports=CosineInterpolation},{}],116:[function(require,module,exports){var LinearInterpolation=require("./LinearInterpolation"),DecimatedInterpolation=function(steps,strategy){if(void 0===steps)throw new Error("steps was not passed to constructor");this.numSteps=steps,this.strategy=strategy||new LinearInterpolation};DecimatedInterpolation.prototype={interpolate:function(a,b,f){var fd=Math.floor(f*this.numSteps)/this.numSteps;return this.strategy.interpolate(a,b,fd)}},module.exports=DecimatedInterpolation},{"./LinearInterpolation":119}],117:[function(require,module,exports){var ExponentialInterpolation=function(exp){this.exponent=void 0===exp?2:exp};ExponentialInterpolation.interpolate=function(a,b,f,exponent){return a+(b-a)*Math.pow(f,exponent)},ExponentialInterpolation.prototype.interpolate=function(a,b,f){return a+(b-a)*Math.pow(f,this.exponent)},module.exports=ExponentialInterpolation},{}],118:[function(require,module,exports){var internals=require("../internals"),Interpolation2D={bilinear:function(_x,_y,_x1,_y1,_x2,_y2,_tl,_tr,_bl,_br){var x,y,x1,y1,x2,y2,tl,tr,bl,br;internals.has.XY(_x)?(x=_x.x,y=_x.y,x1=_y.x,y1=_y.y,x2=_x1.x,y2=_x1.y,tl=_y1,tr=_x2,bl=_y2,br=_tl):(x=_x,y=_y,x1=_x1,y1=_y1,x2=_x2,y2=_y2,tl=_tl,tr=_tr,bl=_bl,br=_br);var denom=1/((x2-x1)*(y2-y1)),dx1=(x-x1)*denom,dx2=(x2-x)*denom,dy1=y-y1,dy2=y2-y;return tl*dx2*dy2+tr*dx1*dy2+bl*dx2*dy1+br*dx1*dy1}};module.exports=Interpolation2D},{"../internals":98}],119:[function(require,module,exports){var LinearInterpolation=function(){},interpolate=function(a,b,f){return a+(b-a)*f};LinearInterpolation.interpolate=interpolate,LinearInterpolation.prototype.interpolate=interpolate,module.exports=LinearInterpolation},{}],120:[function(require,module,exports){var mathUtils=require("./mathUtils"),LinearInterpolation=require("./LinearInterpolation"),_Range=function(min,max){this.min=min,this.max=max};_Range.prototype.toString=function(){return"{ min: "+this.min+", max: "+this.max+"}"};var ScaleMap=function(minIn,maxIn,minOut,maxOut){if(1==arguments.length&&void 0!==arguments[0].input&&void 0!==arguments[0].output){var arg=arguments[0];minOut=arg.output.min,maxOut=arg.output.max,maxIn=arg.input.max,minIn=arg.input.min}this.mapFunction=new LinearInterpolation,this.setInputRange(minIn,maxIn),this.setOutputRange(minOut,maxOut)};ScaleMap.prototype={getClippedValueFor:function(val){var t=mathUtils.clipNormalized((val-this._in.min)/this._interval);return this.mapFunction.interpolate(0,this.mapRange,t)+this._out.min},getInputMedian:function(){return.5*(this._in.min+this._in.max)},getInputRange:function(){return this._in},getMappedMedian:function(){return this.getMappedValueFor(.5)},getMappedValueFor:function(val){var t=(val-this._in.min)/this._interval;return this.mapFunction.interpolate(0,this.mapRange,t)+this._out.min},getOutputMedian:function(){return.5*(this._out.min+this._out.max)},getOutputRange:function(){return this._out},setInputRange:function(min,max){this._in=new _Range(min,max),this._interval=max-min},setMapFunction:function(func){this.mapFunction=func},setOutputRange:function(min,max){this._out=new _Range(min,max),this.mapRange=max-min},toString:function(){return"ScaleMap, inputRange: "+this._in.toString()+" outputRange: "+this._out.toString()}},module.exports=ScaleMap},{"./LinearInterpolation":119,"./mathUtils":125}],121:[function(require,module,exports){var SigmoidInterpolation=function(s){void 0===s&&(s=2),this.setSharpness(s)},interpolate=function(a,b,f,sharpness){return f=(2*f-1)*sharpness,a+(b-a)*(f=1/(1+Math.exp(-f)))};SigmoidInterpolation.prototype={getSharpness:function(){return this.sharpness},interpolate:function(a,b,f){return interpolate(a,b,f,this.sharpPremult)},setSharpness:function(s){this.sharpness=s,this.sharpPremult=5*s}},SigmoidInterpolation.interpolate=interpolate,module.exports=SigmoidInterpolation},{}],122:[function(require,module,exports){var mathUtils=require("./mathUtils"),SinCosLUT=function(precision){precision||(precision=SinCosLUT.DEFAULT_PRECISION),this.precision=precision,this.period=360/this.precision,this.quadrant=this.period>>2,this.deg2rad=Math.PI/180*this.precision,this.rad2deg=180/Math.PI/this.precision,this.sinLUT=[];for(var i=0;i<this.period;i++)this.sinLUT[i]=Math.sin(i*this.deg2rad)};SinCosLUT.prototype={cos:function(theta){for(;theta<0;)theta+=mathUtils.TWO_PI;return this.sinLUT[(theta*this.rad2deg+this.quadrant)%this.period]},getPeriod:function(){return this.period},getPrecision:function(){return this.precision},getSinLUT:function(){return this.sinLUT},sin:function(theta){for(;theta<0;)theta+=mathUtils.TWO_PI;return this.sinLUT[theta*this.rad2deg%this.period]}},SinCosLUT.DEFAULT_PRECISION=.25,SinCosLUT.DEFAULT_INSTANCE=void 0,SinCosLUT.getDefaultInstance=function(){return void 0===SinCosLUT.DEFAULT_INSTANCE&&(SinCosLUT.DEFAULT_INSTANCE=new SinCosLUT),SinCosLUT.DEFAULT_INSTANCE},module.exports=SinCosLUT},{"./mathUtils":125}],123:[function(require,module,exports){var ThresholdInterpolation=function(threshold){this.threshold=threshold},interpolate=function(a,b,f,threshold){return f<threshold?a:b};ThresholdInterpolation.prototype={interpolate:function(a,b,f){return f<this.threshold?a:b}},ThresholdInterpolation.interpolate=interpolate,module.exports=ThresholdInterpolation},{}],124:[function(require,module,exports){var mathUtils=require("./mathUtils"),CircularInterpolation=require("./CircularInterpolation"),ZoomLensInterpolation=function(lensPos,lensStrength){this.leftImpl=new CircularInterpolation,this.rightImpl=new CircularInterpolation,this.lensPos=lensPos||.5,this.lensStrength=lensStrength||1,this.absStrength=Math.abs(this.lensStrength),this.leftImpl.setFlipped(this.lensStrength>0),this.rightImpl.setFlipped(this.lensStrength<0)};ZoomLensInterpolation.prototype={interpolate:function(min,max,t){var val=min+(max-min)*t;return t<this.lensPos?val+=(this.leftImpl.interpolate(min,min+(max-min)*this.lensPos,t/this.lensPos)-val)*this.absStrength:val+=(this.rightImpl.interpolate(min+(max-min)*this.lensPos,max,(t-this.lensPos)/(1-this.lensPos))-val)*this.absStrength,val},setLensPos:function(pos,smooth){this.lensPos+=(mathUtils.clipNormalized(pos)-this.lensPos)*smooth},setLensStrength:function(str,smooth){this.lensStrength+=(mathUtils.clip(str,-1,1)-this.lensStrength)*smooth,this.absStrength=mathUtils.abs(this.lensStrength),this.leftImpl.setFlipped(this.lensStrength>0),this.rightImpl.setFlipped(this.lensStrength<0)}},module.exports=ZoomLensInterpolation},{"./CircularInterpolation":114,"./mathUtils":125}],125:[function(require,module,exports){var MathUtils={};MathUtils.SQRT2=Math.sqrt(2),MathUtils.SQRT3=Math.sqrt(3),MathUtils.LOG2=Math.log(2),MathUtils.PI=3.141592653589793,MathUtils.INV_PI=1/MathUtils.PI,MathUtils.HALF_PI=MathUtils.PI/2,MathUtils.THIRD_PI=MathUtils.PI/3,MathUtils.QUARTER_PI=MathUtils.PI/4,MathUtils.TWO_PI=2*MathUtils.PI,MathUtils.THREE_HALVES_PI=MathUtils.TWO_PI-MathUtils.HALF_PI,MathUtils.PI_SQUARED=MathUtils.PI*MathUtils.PI,MathUtils.EPS=1.1920928955078125e-7,MathUtils.DEG2RAD=MathUtils.PI/180,MathUtils.RAD2DEG=180/MathUtils.PI,MathUtils.SHIFT23=1<<23,MathUtils.INV_SHIFT23=1/MathUtils.SHIFT23,MathUtils.SIN_A=-4/(MathUtils.PI*MathUtils.PI),MathUtils.SIN_B=4/MathUtils.PI,MathUtils.SIN_P=.225,MathUtils.abs=Math.abs,MathUtils.ceilPowerOf2=function(x){for(var pow2=1;pow2<x;)pow2<<=1;return pow2},MathUtils.clip=function(a,_min,_max){return a<_min?_min:a>_max?_max:a},MathUtils.clipNormalized=function(a){return a<0?0:a>1?1:a},MathUtils.cos=Math.cos,MathUtils.degrees=function(radians){return radians*MathUtils.RAD2DEG},MathUtils.fastCos=function(x){return MathUtils.fastSin(x+(x>MathUtils.HALF_PI?-MathUtils.THREE_HALVES_PI:MathUtils.HALF_PI))},MathUtils.fastSin=function(x){return x=MathUtils.SIN_B*x+MathUtils.SIN_A*x*Math.abs(x),MathUtils.SIN_P*(x*Math.abs(x)-x)+x},MathUtils.flipCoin=function(rnd){return Math.random()<.5},MathUtils.floor=function(x){var y=~~x;return x<0&&x!=y&&y--,y},MathUtils.floorPowerOf2=function(x){return~~Math.pow(2,parseInt(Math.log(x)/MathUtils.LOG2,10))},MathUtils.max=function(a,b,c){return void 0===c?Math.max(a,b):a>b?a>c?a:c:b>c?b:c},MathUtils.min=function(a,b,c){return void 0===c?Math.min(a,b):a<b?a<c?a:c:b<c?b:c},MathUtils.normalizedRandom=function(){return 2*Math.random()-1},MathUtils.radians=function(degrees){return degrees*MathUtils.DEG2RAD},MathUtils.random=function(rand,min,max){return 1===arguments.length?Math.random()*arguments[0]:(2==arguments.length&&(max=min,min=rand,rand=Math.random),min||max?max?rand()*(max-min)+min:(max=min,rand()*max):Math.random())},MathUtils.reduceAngle=function(theta){return theta%=MathUtils.TWO_PI,Math.abs(theta)>MathUtils.PI&&(theta-=MathUtils.TWO_PI),Math.abs(theta)>MathUtils.HALF_PI&&(theta=MathUtils.PI-theta),theta},MathUtils.sign=function(x){return x<0?-1:x>0?1:0},MathUtils.sin=function(theta){return theta=MathUtils.reduceAngle(theta),Math.abs(theta)<=MathUtils.QUARTER_PI?MathUtils.fastSin(theta):MathUtils.fastCos(MathUtils.HALF_PI-theta)},module.exports=MathUtils},{}],126:[function(require,module,exports){module.exports={PerlinNoise:require("./noise/PerlinNoise"),simplexNoise:require("./noise/simplexNoise")}},{"./noise/PerlinNoise":127,"./noise/simplexNoise":128}],127:[function(require,module,exports){var SinCosLUT=require("../SinCosLUT"),hasTypedArrays=require("../../internals/has").typedArrays(),internalMath={};internalMath.pow=Math.pow,internalMath.random=Math.random,function(pool,math,width,chunks,significance,overflow,startdenom){function ARC4(key){var t,u,me=this,keylen=key.length,i=0,j=me.i=me.j=me.m=0;for(me.S=[],me.c=[],keylen||(key=[keylen++]);i<256;)me.S[i]=i++;for(i=0;i<256;i++)j=lowbits(j+(t=me.S[i])+key[i%keylen]),u=me.S[j],me.S[i]=u,me.S[j]=t;me.g=function getnext(count){var s=me.S,i=lowbits(me.i+1),t=s[i],j=lowbits(me.j+t),u=s[j];s[i]=u,s[j]=t;for(var r=s[lowbits(t+u)];--count;)i=lowbits(i+1),u=s[j=lowbits(j+(t=s[i]))],s[i]=u,s[j]=t,r=256*r+s[lowbits(t+u)];return me.i=i,me.j=j,r},me.g(256)}function flatten(obj,depth,result,prop,typ){if(result=[],typ=typeof obj,depth&&"object"==typ)for(prop in obj)if(prop.indexOf("S")<5)try{result.push(flatten(obj[prop],depth-1))}catch(e){}return result.length?result:obj+("string"!=typ?"\0":"")}function mixkey(seed,key,smear,j){for(seed+="",smear=0,j=0;j<seed.length;j++)key[lowbits(j)]=lowbits((smear^=19*key[lowbits(j)])+seed.charCodeAt(j));for(j in seed="",key)seed+=String.fromCharCode(key[j]);return seed}function lowbits(n){return 255&n}math.seedrandom=function seedrandom(seed,use_entropy){var key=[],arc4;return seed=mixkey(flatten(use_entropy?[seed,pool]:arguments.length?seed:[(new Date).getTime(),pool,window],3),key),mixkey((arc4=new ARC4(key)).S,pool),math.random=function random(){for(var n=arc4.g(6),d=startdenom,x=0;n<significance;)n=256*(n+x),d*=256,x=arc4.g(1);for(;n>=overflow;)n/=2,d/=2,x>>>=1;return(n+x)/d},seed},startdenom=math.pow(256,6),significance=math.pow(2,significance),overflow=2*significance,mixkey(math.random(),pool)}([],internalMath,256,6,52);var PERLIN_YWRAPB=4,PERLIN_YWRAP=16,PERLIN_ZWRAPB=8,PERLIN_ZWRAP=256,PERLIN_SIZE=4095,PERLIN_MIN_AMPLITUDE=.001,_noise_fsc=function(self,i){var index=(i+.5)*self._perlin_PI%self._perlin_TWOPI;return.5*(1-self._perlin_cosTable[index])},PerlinNoise=function(){this._perlin_octaves=4,this._perlin_amp_falloff=.5,this._sinCosLUT=SinCosLUT.getDefaultInstance()};PerlinNoise.prototype={noise:function(x,y,z){var i=0;if(x=x||0,y=y||0,z=z||0,!this._perlin){this._perlin=hasTypedArrays?new Float32Array(4095):[];var length=4094;for(i=0;i<4096;i++)this._perlin[i]=internalMath.random()}this._perlin_cosTable=this._sinCosLUT.getSinLUT(),this._perlin_TWOPI=this._perlin_PI=this._sinCosLUT.getPeriod(),this._perlin_PI>>=1,x<0&&(x=-x),y<0&&(y=-y),z<0&&(z=-z);var xi=x,yi=y,zi=z,xf=x-xi,yf=y-yi,zf=z-zi,rxf,ryf,r=0,ampl=.5,n1,n2,n3,of;for(i=0;i<this._perlin_octaves&&(of=xi+(yi<<4)+(zi<<8),rxf=_noise_fsc(this,xf),ryf=_noise_fsc(this,yf),n1=this._perlin[4095&of],n1+=rxf*(this._perlin[of+1&4095]-n1),n2=this._perlin[of+16&4095],n1+=ryf*((n2+=rxf*(this._perlin[of+16+1&4095]-n2))-n1),of+=256,n2=this._perlin[4095&of],n2+=rxf*(this._perlin[of+1&4095]-n2),n3=this._perlin[of+16&4095],n2+=ryf*((n3+=rxf*(this._perlin[of+16+1&4095]-n3))-n2),r+=(n1+=_noise_fsc(this,zf)*(n2-n1))*ampl,!((ampl*=this._perlin_amp_falloff)<.001));i++)xi<<=1,yi<<=1,zi<<=1,(xf*=2)>=1&&(xi++,xf--),(yf*=2)>=1&&(yi++,yf--),(zf*=2)>=1&&(zi++,zf--);return r},noiseDetail:function(lod,falloff){lod>0&&(this._perlin_octaves=lod),falloff&&falloff>0&&(this._perlin_amp_falloff=falloff)},noiseSeed:function(what){internalMath.seedrandom(what)}},module.exports=PerlinNoise},{"../../internals/has":105,"../SinCosLUT":122}],128:[function(require,module,exports){var each=require("../../internals/each"),has=require("../../internals/has"),_SQRT3=Math.sqrt(3),_SQRT5=Math.sqrt(5),_F2=.5*(_SQRT3-1),_G2=(3-_SQRT3)/6,_G22=2*_G2-1,_F3=1/3,_G3=1/6,_F4=(_SQRT5-1)/4,_G4=(5-_SQRT5)/20,_G42=2*_G4,_G43=3*_G4,_G44=4*_G4-1,_grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],_grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],_p=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],_perm=function(){for(var _per=has.typedArrays()?new Int32Array(512):[],i=0;i<512;i++)_per[i]=_p[255&i];return _per}(),_simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]];if(has.typedArrays()){var makeEachTypedArray=function(arr){var _g=[];return each(arr,(function(g){_g.push(new Int32Array(g))})),_g};_grad3=makeEachTypedArray(_grad3),_grad4=makeEachTypedArray(_grad4),_p=new Int32Array(_p),_simplex=makeEachTypedArray(_simplex),this.testObjs={_grad3:_grad3,_grad4:_grad4,_p:_p,_simplex:_simplex}}var _dot=function(g,x,y,z,w){var n=g[0]*x+g[1]*y;return z&&(n+=g[2]*z,w&&(n+=g[3]*w)),n},_fastfloor=function(x){return x>=0?Math.floor(x):Math.floor(x-1)},SimplexNoise={noise:function(x,y,z,w){var numArgs=arguments.length,n0=0,n1=0,n2=0,n3=0,n4=0,s=function(){switch(numArgs){case 2:return(x+y)*_F2;case 3:return(x+y+z)*(1/3);case 4:return(x+y+z+w)*_F4;default:throw new Error("Wrong arguments supplied to SimplexNoise.noise()")}}(),i=_fastfloor(x+s),j=_fastfloor(y+s),k=void 0!==z?_fastfloor(z+s):void 0,l=void 0!==w?_fastfloor(w+s):void 0,t=function(){switch(numArgs){case 2:return(i+j)*_G2;case 3:return(i+j+k)*(1/6);case 4:return(i+j+k+l)*_G4}}(),x0=x-(i-t),y0=y-(j-t),z0=void 0!==z?z-(k-t):void 0,w0=void 0!==w?w-(l-t):void 0,i1,j1,k1,i2,j2,k2,x1,y1,z1,x2,y2,z2,x3,y3,z3,ii,jj,kk,t0,gi0,t1,gi1,t2,gi2,t3,gi3;return 2==numArgs?function(){var i1,j1,x1,y1,x2,y2,ii,jj,t0,gi0,gi1,gi2,t2;x0>y0?(i1=1,j1=0):(i1=0,j1=1),x1=x0-i1+_G2,y1=y0-j1+_G2,x2=x0+_G22,y2=y0+_G22,ii=255&i,jj=255&j,(t0=.5-x0*x0-y0*y0)>0&&(t0*=t0,gi0=_perm[ii+_perm[jj]]%12,n0=t0*t0*_dot(_grad3[gi0],x0,y0));var t1=.5-x1*x1-y1*y1;return t1>0&&(t1*=t1,gi1=_perm[ii+i1+_perm[jj+j1]]%12,n1=t1*t1*_dot(_grad3[gi1],x1,y1)),(t2=.5-x2*x2-y2*y2)>0&&(t2*=t2,gi2=_perm[ii+1+_perm[jj+1]]%12,n2=t2*t2*_dot(_grad3[gi2],x2,y2)),70*(n0+n1+n2)}():3==numArgs?(x0>=y0?y0>=z0?(i1=1,j1=0,k1=0,i2=1,j2=1,k2=0):x0>=z0?(i1=1,j1=0,k1=0,i2=1,j2=0,k2=1):(i1=0,j1=0,k1=1,i2=1,j2=0,k2=1):y0<z0?(i1=0,j1=0,k1=1,i2=0,j2=1,k2=1):x0<z0?(i1=0,j1=1,k1=0,i2=0,j2=1,k2=1):(i1=0,j1=1,k1=0,i2=1,j2=1,k2=0),x1=x0-i1+1/6,y1=y0-j1+1/6,z1=z0-k1+1/6,x2=x0-i2+1/3,y2=y0-j2+1/3,z2=z0-k2+1/3,x3=x0-.5,y3=y0-.5,z3=z0-.5,ii=255&i,jj=255&j,kk=255&k,(t0=.6-x0*x0-y0*y0-z0*z0)>0&&(t0*=t0,gi0=_perm[ii+_perm[jj+_perm[kk]]]%12,n0=t0*t0*_dot(_grad3[gi0],x0,y0,z0)),(t1=.6-x1*x1-y1*y1-z1*z1)>0&&(t1*=t1,gi1=_perm[ii+i1+_perm[jj+j1+_perm[kk+k1]]]%12,n1=t1*t1*_dot(_grad3[gi1],x1,y1,z1)),(t2=.6-x2*x2-y2*y2-z2*z2)>0&&(t2*=t2,gi2=_perm[ii+i2+_perm[jj+j2+_perm[kk+k2]]]%12,n2=t2*t2*_dot(_grad3[gi2],x2,y2,z2)),(t3=.6-x3*x3-y3*y3-z3*z3)>0&&(t3*=t3,gi3=_perm[ii+1+_perm[jj+1+_perm[kk+1]]]%12,n3=t3*t3*_dot(_grad3[gi3],x3,y3,z3)),32*(n0+n1+n2+n3)):function(){var i1,j1,k1,l1,i2,j2,k2,l2,i3,j3,k3,l3,sc=_simplex[function(){var c=0;return x0>y0&&(c=32),x0>z0&&(c|=16),y0>z0&&(c|=8),x0>w0&&(c|=4),y0>w0&&(c|=2),z0>w0&&(c|=1),c}()],x1,y1,z1,w1,x2,y2,z2,w2,x3,y3,z3,w3,x4,y4,z4,w4,ii,jj,kk,ll,t0,gi0,t1,gi1,t2,gi2,t3,gi3,t4,gi4;return i1=sc[0]>=3?1:0,j1=sc[1]>=3?1:0,k1=sc[2]>=3?1:0,l1=sc[3]>=3?1:0,i2=sc[0]>=2?1:0,j2=sc[1]>=2?1:0,k2=sc[2]>=2?1:0,l2=sc[3]>=2?1:0,i3=sc[0]>=1?1:0,j3=sc[1]>=1?1:0,k3=sc[2]>=1?1:0,l3=sc[3]>=1?1:0,x1=x0-i1+_G4,y1=y0-j1+_G4,z1=z0-k1+_G4,w1=w0-l1+_G4,x2=x0-i2+_G42,y2=y0-j2+_G42,z2=z0-k2+_G42,w2=w0-l2+_G42,x3=x0-i3+_G43,y3=y0-j3+_G43,z3=z0-k3+_G43,w3=w0-l3+_G43,x4=x0+_G44,y4=y0+_G44,z4=z0+_G44,w4=w0+_G44,ii=255&i,jj=255&j,kk=255&k,ll=255&l,(t0=.6-x0*x0-y0*y0-z0*z0-w0*w0)>0&&(t0*=t0,gi0=_perm[ii+_perm[jj+_perm[kk+_perm[ll]]]]%32,n0=t0*t0*_dot(_grad4[gi0],x0,y0,z0,w0)),(t1=.6-x1*x1-y1*y1-z1*z1-w1*w1)>0&&(t1*=t1,gi1=_perm[ii+i1+_perm[jj+j1+_perm[kk+k1+_perm[ll+l1]]]]%32,n1=t1*t1*_dot(_grad4[gi1],x1,y1,z1,w1)),(t2=.6-x2*x2-y2*y2-z2*z2-w2*w2)>0&&(t2*=t2,gi2=_perm[ii+i2+_perm[jj+j2+_perm[kk+k2+_perm[ll+l2]]]]%32,n2=t2*t2*_dot(_grad4[gi2],x2,y2,z2,w2)),(t3=.6-x3*x3-y3*y3-z3*z3-w3*w3)>0&&(t3*=t3,gi3=_perm[ii+i3+_perm[jj+j3+_perm[kk+k3+_perm[ll+l3]]]]%32,n3=t3*t3*_dot(_grad4[gi3],x3,y3,z3,w3)),(t4=.6-x4*x4-y4*y4-z4*z4-w4*w4)>0&&(t4*=t4,gi4=_perm[ii+1+_perm[jj+1+_perm[kk+1+_perm[ll+1]]]]%32,n4=t4*t4*_dot(_grad4[gi4],x4,y4,z4,w4)),27*(n0+n1+n2+n3+n4)}()}};module.exports=SimplexNoise},{"../../internals/each":102,"../../internals/has":105}],129:[function(require,module,exports){module.exports={AbstractWave:require("./waves/AbstractWave"),AMFMSineWave:require("./waves/AMFMSineWave"),ConstantWave:require("./waves/ConstantWave"),FMHarmonicSquareWave:require("./waves/FMHarmonicSquareWave"),FMSawtoothWave:require("./waves/FMSawtoothWave"),FMSineWave:require("./waves/FMSineWave"),FMSquareWave:require("./waves/FMSquareWave"),FMTriangleWave:require("./waves/FMTriangleWave"),SineWave:require("./waves/SineWave"),WaveState:require("./waves/WaveState")}},{"./waves/AMFMSineWave":130,"./waves/AbstractWave":131,"./waves/ConstantWave":132,"./waves/FMHarmonicSquareWave":133,"./waves/FMSawtoothWave":134,"./waves/FMSineWave":135,"./waves/FMSquareWave":136,"./waves/FMTriangleWave":137,"./waves/SineWave":138,"./waves/WaveState":139}],130:[function(require,module,exports){var extend=require("../../internals").extend,AbstractWave=require("./AbstractWave"),AMFMSineWave=function(a,b,c,d,e){"number"==typeof c?(AbstractWave.call(this,a,b,1,c),this.amod=d,this.fmod=e):(AbstractWave.call(this,a,b),this.amod=c,this.fmod=d)};extend(AMFMSineWave,AbstractWave),AMFMSineWave.prototype.getClass=function(){return"AMFMSineWave"},AMFMSineWave.prototype.pop=function(){this.parent.pop.call(this),this.amod.pop(),this.fmod.pop()},AMFMSineWave.prototype.push=function(){this.parent.push.call(this),this.amod.push(),this.fmod.push()},AMFMSineWave.prototype.reset=function(){this.parent.reset.call(this),this.fmod.reset(),this.amod.reset()},AMFMSineWave.prototype.update=function(){return this.amp=this.amod.update(),this.value=this.amp*Math.sin(this.phase)+this.offset,this.cyclePhase(this.frequency+this.fmod.update()),this.value},module.exports=AMFMSineWave},{"../../internals":98,"./AbstractWave":131}],131:[function(require,module,exports){var WaveState=require("./WaveState"),defaultNumberTo=function(i,num){return"number"==typeof i?i:num},AbstractWave=function(phase,freq,amp,offset){"object"!=typeof arguments[0]||freq||amp||offset||(offset=phase.offset,amp="number"==typeof phase.amp?phase.amp:phase.amplitude,freq="number"==typeof phase.freq?phase.freq:phase.frequency,phase=phase.phase),this.setPhase(defaultNumberTo(phase,0)),this.frequency=defaultNumberTo(freq,0),this.amp=defaultNumberTo(amp,1),this.offset=defaultNumberTo(offset,0)};AbstractWave.prototype={cyclePhase:function(freq){return void 0===freq&&(freq=0),this.phase=(this.phase+freq)%AbstractWave.TWO_PI,this.phase<0&&(this.phase+=AbstractWave.TWO_PI),this.phase},getClass:function(){return"AbstractWave"},pop:function(){if(void 0===this.stateStack||void 0!==this.stateStack&&this.stateStack.length<=0)return console.log(this.toString()),void console.log("no wave states on stack");var s=this.stateStack.pop();this.phase=s.phase,this.frequency=s.frequency,this.amp=s.amp,this.offset=s.offset},push:function(){void 0===this.stateStack&&(this.stateStack=[]),this.stateStack.push(new WaveState(this.phase,this.frequency,this.amp,this.offset))},reset:function(){this.phase=this.origPhase},setPhase:function(phase){this.phase=phase,this.cyclePhase(),this.origPhase=phase},toString:function(){return this.getClass()+" phase:"+this.phase+" frequency: "+this.frequency+" amp: "+this.amp+" offset: "+this.offset},update:function(){console.log(this.getClass()+" this should be overridden")}},AbstractWave.TWO_PI=2*(AbstractWave.PI=3.141592653589793),AbstractWave.hertzToRadians=function(hz,sampleRate){return hz/sampleRate*AbstractWave.TWO_PI},AbstractWave.radiansToHertz=function(f,sampleRate){return f/AbstractWave.TWO_PI*sampleRate},module.exports=AbstractWave},{"./WaveState":139}],132:[function(require,module,exports){var extend=require("../../internals").extend,AbstractWave=require("./AbstractWave"),ConstantWave=function(value){AbstractWave.apply(this),this.value=value};extend(ConstantWave,AbstractWave),ConstantWave.prototype.getClass=function(){return"ConstantWave"},ConstantWave.prototype.update=function(){return this.value},module.exports=ConstantWave},{"../../internals":98,"./AbstractWave":131}],133:[function(require,module,exports){var extend=require("../../internals").extend,AbstractWave=require("./AbstractWave"),FMHarmonicSquareWave=function(a,b,c,d,e){this.maxHarmonics=3,"number"==typeof c?(void 0===e&&(e=new ConstantWave(0)),AbstractWave.call(this,a,b,c,d),this.fmod=e):(AbstractWave.call(this,a,b),this.fmod=c)};extend(FMHarmonicSquareWave,AbstractWave),FMHarmonicSquareWave.prototype.getClass=function(){return"FMHarmonicSquareWave"},FMHarmonicSquareWave.prototype.pop=function(){this.parent.pop.call(this),this.fmod.pop()},FMHarmonicSquareWave.prototype.push=function(){this.parent.push.call(this),this.fmod.push()},FMHarmonicSquareWave.prototype.reset=function(){this.parent.reset.call(this),this.fmod.reset()},FMHarmonicSquareWave.prototype.update=function(){this.value=0;for(var i=1;i<=this.maxHarmonics;i+=2)this.value+=1/i*Math.sin(i*this.phase);return this.value*=this.amp,this.value+=this.offset,this.cyclePhase(this.frequency+this.fmod.update()),this.value},module.exports=FMHarmonicSquareWave},{"../../internals":98,"./AbstractWave":131}],134:[function(require,module,exports){var extend=require("../../internals").extend,AbstractWave=require("./AbstractWave"),FMSawtoothWave=function(a,b,c,d,e){"number"==typeof c?(AbstractWave.call(this,a,b,c,d),this.fmod=e):(AbstractWave.call(this,a,b),this.fmod=c)};extend(FMSawtoothWave,AbstractWave),FMSawtoothWave.prototype.getClass=function(){return"FMSawtoothWave"},FMSawtoothWave.prototype.pop=function(){this.parent.pop.call(this),this.fmod.pop()},FMSawtoothWave.prototype.push=function(){this.parent.push.call(this),this.fmod.push()},FMSawtoothWave.prototype.reset=function(){this.parent.reset.call(this),this.fmod.reset()},FMSawtoothWave.prototype.update=function(){return this.value=(this.phase/AbstractWave.TWO_PI*2-1)*this.amp+this.offset,this.cyclePhase(this.frequency+this.fmod.update()),this.value},module.exports=FMSawtoothWave},{"../../internals":98,"./AbstractWave":131}],135:[function(require,module,exports){var extend=require("../../internals").extend,AbstractWave=require("./AbstractWave"),FMSineWave=function(a,b,c,d,e){"number"==typeof c?(AbstractWave.call(this,a,b,c,d),this.fmod=e):(AbstractWave.call(this,a,b),this.fmod=c)};extend(FMSineWave,AbstractWave),FMSineWave.prototype.getClass=function(){return"FMSineWave"},FMSineWave.prototype.pop=function(){this.parent.pop.call(this),this.fmod.pop()},FMSineWave.prototype.push=function(){this.parent.push.call(this),this.fmod.push()},FMSineWave.prototype.reset=function(){this.parent.reset.call(this),this.fmod.reset()},FMSineWave.prototype.update=function(){return this.value=Math.sin(this.phase)*this.amp+this.offset,this.cyclePhase(this.frequency+this.fmod.update()),this.value},module.exports=FMSineWave},{"../../internals":98,"./AbstractWave":131}],136:[function(require,module,exports){var extend=require("../../internals").extend,AbstractWave=require("./AbstractWave"),ConstantWave=require("./ConstantWave"),FMSquareWave=function(a,b,c,d,e){"number"==typeof c?void 0===e?AbstractWave.call(this,a,b,c,d,new ConstantWave(0)):(AbstractWave.call(this,a,b,c,d),this.fmod=e):(AbstractWave.call(this,a,b),this.fmod=c)};extend(FMSquareWave,AbstractWave),FMSquareWave.prototype.getClass=function(){return"FMSquareWave"},FMSquareWave.prototype.pop=function(){this.parent.pop.call(this),this.fmod.pop()},FMSquareWave.prototype.push=function(){this.parent.push.call(this),this.fmod.push()},FMSquareWave.prototype.reset=function(){this.parent.reset.call(this),this.fmod.reset()},FMSquareWave.prototype.update=function(){return this.value=(this.phase/AbstractWave.TWO_PI<.5?1:-1)*this.amp+this.offset,this.cyclePhase(this.frequency+this.fmod.update()),this.value},module.exports=FMSquareWave},{"../../internals":98,"./AbstractWave":131,"./ConstantWave":132}],137:[function(require,module,exports){var extend=require("../../internals").extend,mathUtils=require("../mathUtils"),AbstractWave=require("./AbstractWave"),ConstantWave=require("./ConstantWave"),FMTriangleWave=function(a,b,c,d,e){"number"==typeof c?void 0!==e?(AbstractWave.call(this,a,b,c,d),this.fmod=e):AbstractWave.call(this,a,b,c,d,new ConstantWave(0)):AbstractWave.call(this,a,b,1,0)};extend(FMTriangleWave,AbstractWave),FMTriangleWave.prototype.getClass=function(){return"FMTriangleWave"},FMTriangleWave.prototype.pop=function(){this.parent.pop.call(this),this.fmod.pop()},FMTriangleWave.prototype.push=function(){this.parent.push.call(this),this.fmod.push()},FMTriangleWave.prototype.reset=function(){this.parent.reset.call(this),this.fmod.reset()},FMTriangleWave.prototype.update=function(){return this.value=2*this.amp*(Math.abs(AbstractWave.PI-this.phase)*mathUtils.INV_PI-.5)+this.offset,this.cyclePhase(this.frequency+this.fmod.update()),this.value},module.exports=FMTriangleWave},{"../../internals":98,"../mathUtils":125,"./AbstractWave":131,"./ConstantWave":132}],138:[function(require,module,exports){var extend=require("../../internals").extend,AbstractWave=require("./AbstractWave"),SineWave=function(phase,freq,amp,offset){AbstractWave.call(this,phase,freq,amp,offset)};extend(SineWave,AbstractWave),SineWave.prototype.getClass=function(){return"SineWave"},SineWave.prototype.update=function(){return this.value=Math.sin(this.phase)*this.amp+this.offset,this.cyclePhase(this.frequency),this.value},module.exports=SineWave},{"../../internals":98,"./AbstractWave":131}],139:[function(require,module,exports){var WaveState=function(phase,frequency,amp,offset){this.phase=phase,this.frequency=frequency,this.amp=amp,this.offset=offset};module.exports=WaveState},{}],140:[function(require,module,exports){module.exports={ParticlePath2D:require("./physics2d/ParticlePath2D"),ParticleString2D:require("./physics2d/ParticleString2D"),PullBackString2D:require("./physics2d/PullBackString2D"),VerletConstrainedSpring2D:require("./physics2d/VerletConstrainedSpring2D"),VerletMinDistanceSpring2D:require("./physics2d/VerletMinDistanceSpring2D"),VerletParticle2D:require("./physics2d/VerletParticle2D"),VerletPhysics2D:require("./physics2d/VerletPhysics2D"),VerletSpring2D:require("./physics2d/VerletSpring2D")},module.exports.behaviors=require("./physics2d/behaviors"),module.exports.constraints=require("./physics2d/constraints")},{"./physics2d/ParticlePath2D":141,"./physics2d/ParticleString2D":142,"./physics2d/PullBackString2D":143,"./physics2d/VerletConstrainedSpring2D":144,"./physics2d/VerletMinDistanceSpring2D":145,"./physics2d/VerletParticle2D":146,"./physics2d/VerletPhysics2D":147,"./physics2d/VerletSpring2D":148,"./physics2d/behaviors":149,"./physics2d/constraints":153}],141:[function(require,module,exports){var internals=require("../internals"),Spline2D=require("../geom/Spline2D"),VerletParticle2D=require("./VerletParticle2D"),ParticlePath2D=function(points){Spline2D.call(this,points),this.particles=[]};internals.extend(ParticlePath2D,Spline2D),ParticlePath2D.prototype.createParticles=function(physics,subDiv,step,mass){this.particles=[],this.computeVertices(subDiv);var i=0,dv=this.getDecimatedVertices(step,!0);for(i=0;i<dv.length;i++){var v=dv[i],p=new VerletParticle2D(v,mass);this.particles.push(p),physics.addParticle(p)}return this.particles},module.exports=ParticlePath2D},{"../geom/Spline2D":64,"../internals":98,"./VerletParticle2D":146}],142:[function(require,module,exports){var VerletParticle2D=require("./VerletParticle2D"),VerletSpring2D=require("./VerletSpring2D"),ParticleString2D=function(){var opts={physics:void 0,plist:void 0,pos:void 0,step:void 0,num:void 0,mass:void 0,strength:void 0},is6ParamConstructor=!1;if(0===arguments.length)throw new Error("Incorrect Parameters");if(1==arguments.length){var arg=arguments[0];for(var prop in arg)opts[prop]=arg[prop]}else opts.physics=arguments[0],6==arguments.length?(opts.pos=arguments[1],opts.step=arguments[2],opts.num=arguments[3],opts.mass=arguments[4],opts.strength=arguments[5]):(opts.plist=arguments[1],opts.strength=arguments[2]);if(void 0!==opts.num&&void 0!==opts.pos&&void 0!==opts.step&&void 0!==opts.mass&&(is6ParamConstructor=!0),!is6ParamConstructor&&void 0===opts.plist)throw new Error("Incorrect Parameters, please supply plist or num, pos, step & mass");this.physics=opts.physics,this.links=[];var prev,p,s,strength,i=0;if(is6ParamConstructor){var pos=opts.pos.copy(),step=opts.step,mass=opts.mass,len=step.magnitude();for(this.particles=[],strength=opts.strength,i=0;i<opts.num;i++)p=new VerletParticle2D(pos.copy(),mass),this.particles.push(p),this.physics.particles.push(p),void 0!==prev&&(s=this.createSpring(prev,p,len,strength),this.links.push(s),this.physics.addSpring(s)),prev=p,pos.addSelf(step)}else for(strength=opts.strength,this.particles=opts.plist||[],i=0;i<this.particles.length;i++)p=this.particles[i],this.physics.addParticle(p),void 0!==prev&&(s=this.createSpring(prev,p,prev.distanceTo(p),strength),this.links.push(s),this.physics.addSpring(s)),prev=p};ParticleString2D.prototype={clear:function(){for(var i=0,len=this.links.length;i<len;i++)this.physics.removeSpringElements(this.links[i]);this.particles=[],this.links=[]},createSpring:function(a,b,len,strength){return new VerletSpring2D(a,b,len,strength)},getHead:function(){return this.particles[0]},getNumParticles:function(){return this.particles.length},getTail:function(){return this.particles[this.particles.length-1]}},module.exports=ParticleString2D},{"./VerletParticle2D":146,"./VerletSpring2D":148}],143:[function(require,module,exports){var internals=require("../internals"),VerletSpring2D=require("./VerletSpring2D"),PullBackString2D=function(a,b,strength){VerletSpring2D.apply(this,[a,b,0,strength]),a.lock(),this.setRestLength(.5)};internals.extend(PullBackString2D,VerletSpring2D),PullBackString2D.prototype.update=function(applyConstraints){this.b.distanceToSquared(this.a)>this.restLengthSquared&&this.parent.update.call(this,applyConstraints)},module.exports=PullBackString2D},{"../internals":98,"./VerletSpring2D":148}],144:[function(require,module,exports){var internals=require("../internals"),VerletSpring2D=require("./VerletSpring2D"),VerletConstrainedSpring2D=function(particleA,particleB,len,str,limit){VerletSpring2D.call(this,particleA,particleB,len,str),this.limit=void 0===limit?Number.MAX_VALUE:limit};internals.extend(VerletConstrainedSpring2D,VerletSpring2D),VerletConstrainedSpring2D.update=function(applyConstraints){var delta=this.b.sub(this.a),dist=delta.magnitude()+VerletSpring2D.EPS,normDistStrength=(dist-this.restLength)/(dist*(this.a.invWeight+this.b.invWeight))*this.strength;this.a.isLocked||this.isALocked||(this.a.addSelf(delta.scale(normDistStrength*this.a.invWeight).limit(this.limit)),applyConstraints&&this.a.applyConstraints()),this.b.isLocked||this.isBLocked||(this.b.subSelf(delta.scale(normDistStrength*this.b.invWeight).limit(this.limit)),applyConstraints&&this.b.applyConstraints())},module.exports=VerletConstrainedSpring2D},{"../internals":98,"./VerletSpring2D":148}],145:[function(require,module,exports){var internals=require("../internals"),VerletSpring2D=require("./VerletSpring2D"),VerletMinDistanceSpring2D=function(particleA,particleB,len,str){VerletSpring2D.call(this,particleA,particleB,len,str),this.setRestLength(len)};internals.extend(VerletMinDistanceSpring2D,VerletSpring2D),VerletMinDistanceSpring2D.prototype.update=function(applyConstraints){this.b.distanceToSquared(this.a)<this.restLengthSquared&&this.parent.update.call(this,applyConstraints)},module.exports=VerletMinDistanceSpring2D},{"../internals":98,"./VerletSpring2D":148}],146:[function(require,module,exports){var internals=require("../internals"),Vec2D=require("../geom/Vec2D"),VerletParticle2D=function(x,y,w){this.force=new Vec2D,internals.has.XY(x)&&(internals.is.VerletParticle2D(x)?(y=x.y,w=x.weight,x=x.x,this.isLocked=x.isLocked):void 0===y?(y=x.y,w=1,x=x.x):(w=y,y=x.y,x=x.x)),Vec2D.call(this,x,y),this.isLocked=!1,this.prev=new Vec2D(this),this.temp=new Vec2D,w=w||1,this.setWeight(w)};internals.extend(VerletParticle2D,Vec2D),VerletParticle2D.prototype.addBehavior=function(behavior,timeStep){if(void 0===this.behaviors&&(this.behaviors=[]),void 0===behavior)throw new Error("behavior was undefined");return timeStep=void 0===timeStep?1:timeStep,behavior.configure(timeStep),this.behaviors.push(behavior),this},VerletParticle2D.prototype.addConstraint=function(c){return void 0===this.constraints&&(this.constraints=[]),this.constraints.push(c),this},VerletParticle2D.prototype.addForce=function(f){return this.force.addSelf(f),this},VerletParticle2D.prototype.addVelocity=function(v){return this.prev.subSelf(v),this},VerletParticle2D.prototype.applyBehaviors=function(){if(void 0!==this.behaviors){var i=0,len=this.behaviors.length;for(i=0;i<len;i++)this.behaviors[i].applyBehavior(this)}},VerletParticle2D.prototype.applyConstraints=function(){if(void 0!==this.constraints){var i=0,len=this.constraints.length;for(i=0;i<len;i++)this.constraints[i].applyConstraint(this)}},VerletParticle2D.prototype.clearForce=function(){return this.force.clear(),this},VerletParticle2D.prototype.clearVelocity=function(){return this.prev.set(this),this},VerletParticle2D.prototype.getInvWeight=function(){return this.invWeight},VerletParticle2D.prototype.getPreviousPosition=function(){return this.prev},VerletParticle2D.prototype.getVelocity=function(){return this.sub(this.prev)},VerletParticle2D.prototype.getWeight=function(){return this.weight},VerletParticle2D.prototype.lock=function(){return this.isLocked=!0,this},VerletParticle2D.prototype.removeAllBehaviors=function(){return this.behaviors=[],this},VerletParticle2D.prototype.removeAllConstraints=function(){return this.constraints=[],this},VerletParticle2D.prototype.removeBehavior=function(b){return internals.removeItemFrom(b,this.behaviors)},VerletParticle2D.prototype.removeConstraint=function(c){return internals.removeItemFrom(c,this.constraints)},VerletParticle2D.prototype.scaleVelocity=function(scl){return this.prev.interpolateToSelf(this,1-scl),this},VerletParticle2D.prototype.setPreviousPosition=function(p){return this.prev.set(p),this},VerletParticle2D.prototype.setWeight=function(w){this.weight=w,this.invWeight=0!==w?1/w:0},VerletParticle2D.prototype.unlock=function(){return this.clearVelocity(),this.isLocked=!1,this},VerletParticle2D.prototype.update=function(){this.isLocked||(this.applyBehaviors(),this.temp.set(this),this.addSelf(this.sub(this.prev).addSelf(this.force.scale(this.weight))),this.prev.set(this.temp),this.force.clear(),this.applyConstraints())},module.exports=VerletParticle2D},{"../geom/Vec2D":70,"../internals":98}],147:[function(require,module,exports){var internals=require("../internals"),GravityBehavior=require("./behaviors/GravityBehavior"),Rect=require("../geom/Rect"),Vec2D=require("../geom/Vec2D"),id=0,VerletPhysics2D=function(gravity,numIterations,drag,timeStep){var opts={numIterations:50,drag:0,timeStep:1},a;1==arguments.length&&(arguments[0].gravity||arguments[0].numIterations||arguments[0].timeStep||arguments[0].drag)?(a=arguments[0],opts.gravity=a.gravity,opts.numIterations=a.numIterations||opts.numIterations,opts.drag=a.drag||opts.drag,opts.timeStep=a.timeStep||opts.timeStep):1==arguments.length?opts.gravity=gravity:4==arguments.length&&(opts.gravity=gravity,opts.numIterations=numIterations,opts.drag=drag,opts.timeStep=timeStep),this.behaviors=[],this.particles=[],this.springs=[],this.numIterations=opts.numIterations,this.timeStep=opts.timeStep,this.setDrag(opts.drag),opts.gravity&&(internals.has.XY(opts.gravity)&&(opts.gravity=new GravityBehavior(new Vec2D(opts.gravity))),this.addBehavior(opts.gravity)),this.id=id++};VerletPhysics2D.addConstraintToAll=function(c,list){for(var i=0;i<list.length;i++)list[i].addConstraint(c)},VerletPhysics2D.removeConstraintFromAll=function(c,list){for(var i=0;i<list.length;i++)list[i].removeConstraint(c)},VerletPhysics2D.prototype={addBehavior:function(behavior){behavior.configure(this.timeStep),this.behaviors.push(behavior)},addParticle:function(p){return this.particles.push(p),this},addSpring:function(s){return void 0===this.getSpring(s.a,s.b)&&this.springs.push(s),this},clear:function(){return this.particles=[],this.springs=[],this},constrainToBounds:function(){var p,i=0,len=this.particles.length;for(i=0;i<len;i++)void 0!==(p=this.particles[i]).bounds&&p.constrain(p.bounds);if(void 0!==this.worldBounds)for(i=0;i<len;i++)(p=this.particles[i]).constrain(this.worldBounds)},getCurrentBounds:function(){for(var min=new Vec2D(Number.MAX_VALUE,Number.MAX_VALUE),max=new Vec2D(Number.MIN_VALUE,Number.MIN_VALUE),i=0,pLen=this.particles.length,p;i<pLen;i++)p=this.particles[i],min.minSelf(p),max.maxSelf(p);return new Rect(min,max)},getDrag:function(){return 1-this.drag},getNumIterations:function(){return this.numIterations},getSpring:function(a,b){for(var i=0,sLen=this.springs.length;i<sLen;i++){var s=this.springs[i];if(s.a===a&&s.b===b||s.a===b&&s.b===b)return s}},getTimeStep:function(){return this.timeStep},getWorldBounds:function(){return this.worldBounds},removeBehavior:function(c){return internals.removeItemFrom(c,this.behaviors)},removeParticle:function(p){return internals.removeItemFrom(p,this.particles)},removeSpring:function(s){return internals.removeItemFrom(s,this.springs)},removeSpringElements:function(s){return void 0!==this.removeSpring(s)&&(this.removeParticle(s.a)&&this.removeParticle(s.b))},setDrag:function(drag){this.drag=1-drag},setNumIterations:function(numIterations){this.numIterations=numIterations},setTimeStep:function(timeStep){this.timeStep=timeStep;for(var i=0,l=this.behaviors.length;i<l;i++)this.behaviors[i].configure(timeStep)},setWorldBounds:function(world){return this.worldBounds=world,this},update:function(){return this.updateParticles(),this.updateSprings(),this.constrainToBounds(),this},updateParticles:function(){for(var i=0,j=0,bLen=this.behaviors.length,pLen=this.particles.length,b,p;i<bLen;i++)for(b=this.behaviors[i],j=0;j<pLen;j++)b.applyBehavior(this.particles[j]);for(j=0;j<pLen;j++)(p=this.particles[j]).scaleVelocity(this.drag),p.update()},updateSprings:function(){for(var i=this.numIterations,sLen=this.springs.length,j=0;i>0;i--)for(j=0;j<sLen;j++)this.springs[j].update(1===i)}},module.exports=VerletPhysics2D},{"../geom/Rect":62,"../geom/Vec2D":70,"../internals":98,"./behaviors/GravityBehavior":152}],148:[function(require,module,exports){var VerletSpring2D=function(a,b,len,str){this.a=a,this.b=b,this.restLength=len,this.strength=str};VerletSpring2D.EPS=1e-6,VerletSpring2D.prototype={getRestLength:function(){return this.restLength},getStrength:function(){return this.strength},lockA:function(s){return this.isALocked=s,this},lockB:function(s){return this.isBLocked=s,this},setRestLength:function(len){return this.restLength=len,this.restLengthSquared=len*len,this},setStrength:function(strength){return this.strength=strength,this},update:function(applyConstraints){var delta=this.b.sub(this.a),dist=delta.magnitude()+VerletSpring2D.EPS,normDistStrength=(dist-this.restLength)/(dist*(this.a.invWeight+this.b.invWeight))*this.strength;this.a.isLocked||this.isALocked||(this.a.addSelf(delta.scale(normDistStrength*this.a.invWeight)),applyConstraints&&this.a.applyConstraints()),this.b.isLocked||this.isBLocked||(this.b.addSelf(delta.scale(-normDistStrength*this.b.invWeight)),applyConstraints&&this.b.applyConstraints())}},module.exports=VerletSpring2D},{}],149:[function(require,module,exports){var AttractionBehavior=require("./behaviors/AttractionBehavior"),ConstantForceBehavior=require("./behaviors/ConstantForceBehavior"),GravityBehavior=require("./behaviors/GravityBehavior");exports.AttractionBehavior=AttractionBehavior,exports.ConstantForceBehavior=ConstantForceBehavior,exports.GravityBehavior=GravityBehavior},{"./behaviors/AttractionBehavior":150,"./behaviors/ConstantForceBehavior":151,"./behaviors/GravityBehavior":152}],150:[function(require,module,exports){var AttractionBehavior=function(attractor,radius,strength,jitter){if(arguments.length<3)throw new Error("Constructor received incorrect Parameters");this.jitter=jitter||0,this.attractor=attractor,this.strength=strength,this.setRadius(radius)};AttractionBehavior.prototype={applyBehavior:function(p){var delta=this.attractor.sub(p),dist=delta.magSquared();if(dist<this.radiusSquared){var f=delta.normalizeTo(1-dist/this.radiusSquared).jitter(this.jitter).scaleSelf(this.attrStrength);p.addForce(f)}},configure:function(timeStep){this.timeStep=timeStep,this.setStrength(this.strength)},getAttractor:function(){return this.attractor},getJitter:function(){return this.jitter},getRadius:function(){return this.radius},getStrength:function(){return this.strength},setAttractor:function(attractor){this.attractor=attractor},setJitter:function(jitter){this.jitter=jitter},setRadius:function(r){this.radius=r,this.radiusSquared=r*r},setStrength:function(strength){this.strength=strength,this.attrStrength=strength*this.timeStep}},module.exports=AttractionBehavior},{}],151:[function(require,module,exports){var Vec2D=require("../../geom/Vec2D"),ConstantForceBehavior=function(force){this.force=force,this.scaledForce=new Vec2D,this.timeStep=0};ConstantForceBehavior.prototype={applyBehavior:function(p){p.addForce(this.scaledForce)},configure:function(timeStep){this.timeStep=timeStep,this.setForce(this.force)},getForce:function(){return this.force},setForce:function(forceVec){this.force=forceVec,this.scaledForce=this.force.scale(this.timeStep)},toString:function(){return"behavior force: "+this.force+" scaledForce: "+this.scaledForce+" timeStep: "+this.timeStep}},module.exports=ConstantForceBehavior},{"../../geom/Vec2D":70}],152:[function(require,module,exports){var internals=require("../../internals"),ConstantForceBehavior=require("./ConstantForceBehavior"),GravityBehavior=function(gravityVec){ConstantForceBehavior.call(this,gravityVec)};internals.extend(GravityBehavior,ConstantForceBehavior),GravityBehavior.prototype.configure=function(timeStep){this.timeStep=timeStep,this.scaledForce=this.force.scale(timeStep*timeStep)},module.exports=GravityBehavior},{"../../internals":98,"./ConstantForceBehavior":151}],153:[function(require,module,exports){var AngularConstraint=require("./constraints/AngularConstraint"),AxisConstraint=require("./constraints/AxisConstraint"),CircularConstraint=require("./constraints/CircularConstraint"),MaxConstraint=require("./constraints/MaxConstraint"),MinConstraint=require("./constraints/MinConstraint"),RectConstraint=require("./constraints/RectConstraint");exports.AngularConstraint=AngularConstraint,exports.AxisConstraint=AxisConstraint,exports.CircularConstraint=CircularConstraint,exports.MaxConstraint=MaxConstraint,exports.MinConstraint=MinConstraint,exports.RectConstraint=RectConstraint},{"./constraints/AngularConstraint":154,"./constraints/AxisConstraint":155,"./constraints/CircularConstraint":156,"./constraints/MaxConstraint":157,"./constraints/MinConstraint":158,"./constraints/RectConstraint":159}],154:[function(require,module,exports){var Vec2D=require("../../geom/Vec2D"),AngularConstraint=function(theta_p,theta){arguments.length>1?(this.theta=theta,this.rootPos=new Vec2D(theta_p)):(this.rootPos=new Vec2D,this.theta=theta_p)};AngularConstraint.prototype.applyConstraint=function(p){var delta=p.sub(this.rootPos),heading=Math.floor(delta.heading()/this.theta)*this.theta;p.set(this.rootPos.add(Vec2D.fromTheta(heading).scaleSelf(delta.magnitude())))},module.exports=AngularConstraint},{"../../geom/Vec2D":70}],155:[function(require,module,exports){var AxisConstraint=function(axis,constraintAmount){this.axis=axis,this.constraint=constraintAmount};AxisConstraint.prototype.applyConstraint=function(p){p.setComponent(this.axis,this.constraint)},module.exports=AxisConstraint},{}],156:[function(require,module,exports){var Circle=require("../../geom/Circle"),CircularConstraint=function(a,b){1==arguments.length?this.circle=a:this.circle=new Circle(a,b)};CircularConstraint.prototype.applyConstraint=function(p){this.circle.containsPoint(p)&&p.set(this.circle.add(p.sub(this.circle).normalizeTo(this.circle.getRadius())))},module.exports=CircularConstraint},{"../../geom/Circle":45}],157:[function(require,module,exports){var MaxConstraint=function(axis,threshold){this.axis=axis,this.threshold=threshold};MaxConstraint.prototype.applyConstraint=function(p){p.getComponent(this.axis)>this.threshold&&p.setComponent(this.axis,this.threshold)},module.exports=MaxConstraint},{}],158:[function(require,module,exports){var MinConstraint=function(axis,threshold){this.axis=axis,this.threshold=threshold};MinConstraint.prototype.applyConstraint=function(p){p.getComponent(this.axis)<this.threshold&&p.setComponent(this.axis,this.threshold)},module.exports=MinConstraint},{}],159:[function(require,module,exports){var Vec2D=require("../../geom/Vec2D"),has=require("../../internals/has"),Ray2D=require("../../geom/Ray2D"),Rect=require("../../geom/Rect"),RectConstraint=function(a,b){if(1==arguments.length?"function"==typeof a.copy?this.rect=a.copy():has.XYWidthHeight(a)&&(this.rect=new Rect(a)):arguments.length>1&&(this.rect=new Rect(a,b)),!this.rect)throw new Error("Received Incorrect arguments");this.intersectRay=new Ray2D(this.rect.getCentroid(),new Vec2D)};RectConstraint.prototype={applyConstraint:function(p){this.rect.containsPoint(p)&&p.set(this.rect.intersectsRay(this.intersectRay.setDirection(this.intersectRay.sub(p)),0,Number.MAX_VALUE))},getBox:function(){return this.rect.copy()},setBox:function(rect){this.rect=rect.copy(),this.intersectRay.set(this.rect.getCentroid())}},module.exports=RectConstraint},{"../../geom/Ray2D":59,"../../geom/Rect":62,"../../geom/Vec2D":70,"../../internals/has":105}],160:[function(require,module,exports){module.exports={ToxiclibsSupport:require("./processing/ToxiclibsSupport")}},{"./processing/ToxiclibsSupport":161}],161:[function(require,module,exports){var Matrix4x4=require("../geom/Matrix4x4"),Vec3D=require("../geom/Vec3D"),TriangleMesh=require("../geom/mesh/TriangleMesh"),ToxiclibsSupport=function(processing,optional_gfx){if("undefined"==typeof Processing)throw new Error("Processing.js has not been loaded");this.sketch=processing,this.app=processing,this.gfx=void 0!==optional_gfx?processing:this.app,this._normalMap=(new Matrix4x4).translateSelf(128,128,128).scaleSelf(127)};ToxiclibsSupport.prototype={box:function(aabb,smooth){var mesh=aabb.toMesh();void 0===smooth&&(smooth=!1),smooth&&mesh.computeVertexNormals(),this.mesh(mesh,smooth,0)},circle:function(p,radius){this.gfx.ellipse(p.x,p.y,radius,radius)},cone:function(){var cone=arguments[0],res=6,thetaOffset=0,topClosed=!0,bottomClosed=!0,smooth=!1;5==arguments.length?(res=arguments[1],topClosed=arguments[2],bottomClosed=arguments[3],smooth=arguments[4]):3==arguments.length&&(res=arguments[1],smooth=arguments[2]);var mesh=cone.toMesh({mesh:new TriangleMesh,steps:res,thetaOffset:thetaOffset,topClosed:topClosed,bottomClosed:bottomClosed});smooth&&mesh.computeVertexNormals(),window.mesh=mesh,this.mesh(mesh,smooth,0)},cylinder:function(cyl,res,smooth){if(1==arguments.length)this.mesh(cyl.toMesh(),!1,0);else{var mesh=cyl.toMesh(res,0);void 0===smooth&&(smooth=!1),smooth&&mesh.computeVertexNormals(),this.mesh(mesh,smooth,0)}},ellipse:function(e,ellipseMode){var r=e.getRadii();void 0===ellipseMode&&(ellipseMode=this.app.CENTER),ellipseMode===this.app.CENTER?this.gfx.ellipse(e.x,e.y,2*r.x,2*r.y):ellipseMode===this.app.RADIUS?this.gfx.ellipse(e.x,e.y,2*r.x,2*r.y):ellipseMode!==this.app.CORNER&&this.gfx.ellipseMode!==this.app.CORNERS||this.gfx.ellipse(e.x-r.x,e.y-r.y,2*r.x,2*r.y)},getGraphics:function(){return this.gfx},line:function(){var a,b;if(1==arguments.length){var line=arguments[0];a=line.a,b=line.b}else a=arguments[0],b=arguments[1];void 0===a.z?this.gfx.line(a.x,a.y,b.x,b.y):this.gfx.line(a.x,a.y,a.z,b.x,b.y,b.z)},lineStrip2D:function(points){this.processVertices2D(points,this.app.POLYGON,!1)},lineStrip3D:function(points){this.processVertices3D(points,this.app.POLYGON,!1)},mesh:function(mesh,smooth,normalLength){void 0===smooth&&(smooth=!1),void 0===normalLength&&(normalLength=0),this.gfx.beginShape(this.app.TRIANGLES);var i=0,len=mesh.faces.length;if(smooth)for(i=0;i<len;i++){var f=mesh.faces[i];this.gfx.normal(f.a.normal.x,f.a.normal.y,f.a.normal.z),this.gfx.vertex(f.a.x,f.a.y,f.a.z),this.gfx.normal(f.b.normal.x,f.b.normal.y,f.b.normal.z),this.gfx.vertex(f.b.x,f.b.y,f.b.z),this.gfx.normal(f.c.normal.x,f.c.normal.y,f.c.normal.z),this.gfx.vertex(f.c.x,f.c.y,f.c.z)}else for(var i=0;i<len;i++){var f=mesh.faces[i];this.gfx.normal(f.normal.x,f.normal.y,f.normal.z),this.gfx.vertex(f.a.x,f.a.y,f.a.z),this.gfx.vertex(f.b.x,f.b.y,f.b.z),this.gfx.vertex(f.c.x,f.c.y,f.c.z)}if(this.gfx.endShape(),normalLength>0){var strokeCol=0,isStroked=this.gfx.stroke;if(isStroked&&(strokeCol=this.gfx.strokeColor),len=mesh.vertices.length,smooth)for(i=0;i<len;i++){var v=mesh.vertices[i],w=v.add(v.normal.scale(normalLength));n=v.normal.scale(127),this.gfx.stroke(n.x+128,n.y+128,n.z+128),this.gfx.line(v.x,v.y,v.z,w.x,w.y,w.z)}else{var third=1/3;for(len=mesh.faces.length,i=0;i<len;i++){var f,c=(f=mesh.faces[i]).a.add(f.b).addSelf(f.c).scaleSelf(1/3),d=c.add(f.normal.scale(normalLength)),n=f.normal.scale(127);this.gfx.stroke(n.x+128,n.y+128,n.z+128),this.gfx.line(c.x,c.y,c.z,d.x,d.y,d.z)}}isStroked?this.gfx.stroke(strokeCol):this.gfx.noStroke()}},meshNormalMapped:function(mesh,vertexNormals,normalLength){this.gfx.beginShape(this.app.TRIANGLES);var i=0,len=mesh.faces.length;if(vertexNormals)for(i=0;i<len;i++){var f=mesh.faces[i],n=this._normalMap.applyTo(f.a.normal);this.gfx.fill(n.x,n.y,n.z),this.gfx.normal(f.a.normal.x,f.a.normal.y,f.a.normal.z),this.gfx.vertex(f.a.x,f.a.y,f.a.z),n=this._normalMap.applyTo(f.b.normal),this.gfx.fill(n.x,n.y,n.z),this.gfx.normal(f.b.normal.x,f.b.normal.y,f.b.normal.z),this.gfx.vertex(f.b.x,f.b.y,f.b.z),n=this._normalMap.applyTo(f.c.nromal),this.gfx.fil(n.x,n.y,n.z),this.gfx.normal(f.c.normal.x,f.c.normal.y,f.c.normal.z),this.gfx.vertex(f.c.x,f.c.y,f.c.z)}else for(i=0;i<len;i++){var f=mesh.faces[i];this.gfx.normal(f.normal.x,f.normal.y,f.normal.z),this.gfx.vertex(f.a.x,f.a.y,f.a.z),this.gfx.vertex(f.b.x,f.b.y,f.b.z),this.gfx.vertex(f.c.x,f.c.y,f.c.z)}if(this.gfx.endShape(),normalLength>0)if(vertexNormals)for(len=mesh.vertices.length,i=0;i<len;i++){var v=mesh.vertices[i],w=v.add(v.normal.scale(normalLength)),n=v.normal.scale(127);this.gfx.stroke(n.x+128,n.y+128,n.z+128),this.gfx.line(v.x,v.y,v.z,w.x,w.y,w.z)}else for(len=mesh.faces.length,i=0;i<len;i++){var f,c=(f=mesh.faces[i]).getCentroid(),d=c.add(f.normal.scale(normalLength)),n=f.normal.scale(127);this.gfx.stroke(n.x+128,n.y+128,n.z+128),this.gfx.line(c.x,c.y,c.z,d.x,d.y,d.z)}},origin:function(){var o=void 0,len=void 0;1==arguments.length?(len=arguments[0],o=Vec3D.ZERO):(o=arguments[0],len=arguments[1]),this.gfx.stroke(255,0,0),this.gfx.line(o.x,o.y,o.z,o.x+len,o.y,o.z),this.gfx.stroke(0,255,0),this.gfx.line(o.x,o.y,o.z,o.x,o.y+len,o.z),this.gfx.stroke(0,0,255),this.gfx.line(o.x,o.y,o.z,o.x,o.y,o.z+len)},plane:function(plane,size){this.mesh(plane.toMesh(size),!1,0)},point:function(p){void 0===p.z?this.gfx.point(p.x,p.y):this.gfx.point(p.x,p.y,p.z)},points2D:function(points){this.processVertices2D(points,this.app.POINTS,!1)},points3D:function(points){this.processVertices3D(points,this.app.POINTS,!1)},polygon2D:function(poly){this.processVertices2D(poly.vertices,this.app.POLYGON,!1)},processVertices2D:function(iterator,shapeID,closed){void 0!==iterator.hasNext&&void 0!==iterator.next||(iterator=new this.app.ObjectIterator(iterator)),this.gfx.beginShape(shapeID);for(var v=void 0;iterator.hasNext()&&(v=iterator.next(),1);)this.gfx.vertex(v.x,v.y);closed?this.gfx.endShape(this.app.CLOSE):this.gfx.endShape()},processVertices3D:function(iterator,shapeID,closed){void 0!==iterator.hasNext&&void 0!==iterator.next||(iterator=new this.app.ObjectIterator(iterator)),this.gfx.beginShape(shapeID);for(var v=void 0;iterator.hasNext()&&(v=iterator.next(),1);)this.gfx.vertex(v.x,v.y,v.z);closed?this.gfx.endShape(this.app.CLOSE):this.gfx.endShape()},ray:function(ray,length){var e=ray.getPointAtDistance(length);void 0===ray.z?this.gfx.line(ray.x,ray.y,e.x,e.y):this.gfx.line(ray.x,ray.y,ray.z,e.x,e.y,e.z)},rect:function(r,rectMode){if(void 0===rectMode&&(rectMode=this.app.CORNER),rectMode===this.app.CORNER)this.gfx.rect(r.x,r.y,r.width,r.height);else if(rectMode===this.app.CORNERS)this.gfx.rect(r.x,r.y,r.x+r.width,r.y+r.height);else if(rectMode===this.app.CENTER)this.gfx.rect(r.x+.5*r.widt,r.y+.5*r.height,r.width,r.height);else if(rectMode===this.app.RADIUS){var rw=.5*r.width,rh=.5*r.height;this.gfx.rect(r.x+rw,r.y+rh,rw,rh)}},setGraphics:function(gfx){this.gfx=gfx},sphere:function(sphere,res,smooth){this.mesh(sphere.toMesh(res),smooth)},texturedMesh:function(mesh,tex,smooth){this.gfx.beginShape(this.app.TRIANGLES),this.gfx.texture(tex);var i=0,len=mesh.faces.length;if(smooth)for(i=0;i<len;i++){var f;void 0!==(f=mesh.faces[i]).uvA&&void 0!==f.uvB&&void 0!==f.uvC?(this.gfx.normal(f.a.normal.x,f.a.normal.y,f.a.normal.z),this.gfx.vertex(f.a.x,f.a.y,f.a.z,f.uvA.x,f.uvA.y),this.gfx.normal(f.b.normal.x,f.b.normal.y,f.b.normal.z),this.gfx.vertex(f.b.x,f.b.y,f.b.z,f.uvB.x,f.uvB.y),this.gfx.normal(f.c.normal.x,f.c.normal.y,f.c.normal.z),this.gfx.vertex(f.c.x,f.c.y,f.c.z,f.uvC.x,f.uvC.y)):(this.gfx.vertex(f.a.x,f.a.y,f.a.z),this.gfx.vertex(f.b.x,f.b.y,f.b.z),this.gfx.vertex(f.c.x,f.c.y,f.c.z))}else for(i=0;i<len;i++){var f=mesh.faces[i];this.gfx.normal(f.normal.x,f.normal.y,f.normal.z),void 0!==f.uvA&&void 0!==f.uvB&&void 0!==f.uvC?(this.gfx.vertex(f.a.x,f.a.y,f.a.z,f.uvA.x,f.uvA.y),this.gfx.vertex(f.b.x,f.b.y,f.b.z,f.uvB.x,f.uvB.y),this.gfx.vertex(f.c.x,f.c.y,f.c.z,f.uvC.x,f.uvC.y)):(this.gfx.vertex(f.a.x,f.a.y,f.a.z),this.gfx.vertex(f.b.x,f.b.y,f.b.z),this.gfx.vertex(f.c.x,f.c.y,f.c.z))}this.gfx.endShape()},triangle:function(tri,isFullShape){var isTriangle=function(){return void 0!==tri.a&&void 0!==tri.b&&void 0!==tri.c&&void 0!==tri.a.x},isTriangle3D=function(){return!!isTriangle()&&void 0!==tri.a.z};if((isFullShape||void 0===isFullShape)&&this.gfx.beginShape(this.app.TRIANGLES),isTriangle3D()){var n=tri.computeNormal();this.gfx.normal(n.x,n.y,n.z),this.gfx.vertex(tri.a.x,tri.a.y,tri.a.z),this.gfx.vertex(tri.b.x,tri.b.y,tri.b.z),this.gfx.vertex(tri.c.x,tri.c.y,tri.c.z)}else this.gfx.vertex(tri.a.x,tri.a.y),this.gfx.vertex(tri.b.x,tri.b.y),this.gfx.vertex(tri.c.x,tri.c.y);(isFullShape||void 0===isFullShape)&&this.gfx.endShape()},vertex:function(v){void 0===v.z?this.gfx.vertex(v.x,v.y):this.gfx.vertex(v.x,v.y,v.z)}},module.exports=ToxiclibsSupport},{"../geom/Matrix4x4":55,"../geom/Vec3D":71,"../geom/mesh/TriangleMesh":87}],162:[function(require,module,exports){exports.datatypes=require("./util/datatypes")},{"./util/datatypes":163}],163:[function(require,module,exports){module.exports={ArraySet:require("./datatypes/ArraySet"),FloatRange:require("./datatypes/FloatRange"),UndirectedGraph:require("./datatypes/UndirectedGraph")}},{"./datatypes/ArraySet":164,"./datatypes/FloatRange":165,"./datatypes/UndirectedGraph":166}],164:[function(require,module,exports){var internals=require("../../internals"),ArraySet=function(collection){if(Array.apply(this),arguments.length>=1)for(var i=0,len=collection.length;i<len;i++){var item=collection[i];this.indexOf(item)<0&&this.push(item)}};internals.extend(ArraySet,Array),internals.mixin(ArraySet.prototype,{add:function(item){return!this.contains(item)&&(this.push(item),!0)},addAll:function(collection){for(var self=this,i=0,len=collection.length;i<len;i++)this.push(collection[i])},clear:function(){this.retainAll([])},clone:function(){return new ArraySet(this)},contains:function(item){return this.indexOf(item)>=0},containsAll:function(collection){for(var i=0,len=collection.length;i<len;i++){var val=collection[i];if(!this.contains(val))return!1}return!0},containsAny:function(collection){for(var i=0,len=collection.length;i<len;i++)if(this.contains(collection[i]))return!0;return!1},equals:function(object){return this===object},get:function(index){return this[index]},iterator:function(){return new internals.Iterator(this)},isEmpty:function(){return this.length<1},remove:function(o){var i=this.indexOf(o);return i>=0&&(this.splice(i,1),!0)},removeAll:function(){this.retainAll([])},retainAll:function(collection){for(var self=this,changed=!1,i=0;i<this.length;i++){var val=this[i];collection.indexOf(val)<0&&(this.splice(i,1),changed=!0,i--)}return changed},size:function(){return this.length},toArray:function(arr){arr=arr||[];for(var i=0;i<this.length;i++)this.hasOwnProperty()&&(arr[i]=this[i]);return arr}}),module.exports=ArraySet},{"../../internals":98}],165:[function(require,module,exports){var mathUtils=require("../../math/mathUtils"),FloatRange=function(min,max){if((min=min||0)>(max="number"==typeof max?max:1)){var t=max;max=min,min=t}this.min=min,this.max=max,this.currValue=min};FloatRange.prototype={adjustCurrentBy:function(val){return this.setCurrent(this.currValue+val)},copy:function(){var range=new FloatRange(this.min,this.max);return range.currValue=this.currValue,range},getAt:function(perc){return this.min+(this.max-this.min-mathUtils.EPS)*perc},getCurrent:function(){return this.currValue},getMedian:function(){return.5*(this.min+this.max)},getRange:function(){return this.max-this.min},isValueInRange:function(val){return val>=this.min&&val<=this.max},pickRandom:function(){return this.currValue=mathUtils.random(this.min,this.max),this.currValue},setCurrent:function(val){return this.currValue=mathUtils.clip(val,this.min,this.max),this.currValue},toArray:function(step){for(var range=[],v=this.min;v<this.max;)range.push(v),v+=step;return range},toString:function(){return"FloatRange: "+this.min+" -> "+this.max}},module.exports=FloatRange},{"../../math/mathUtils":125}],166:[function(require,module,exports){var ArraySet=require("./ArraySet"),UndirectedGraph=function(){this._nodeLinks={},this._nodeIDs=[]};UndirectedGraph.prototype={add:function(node){void 0===this._nodeLinks[node]&&(this._nodeLinks[node]=new ArraySet,this._nodeIDs.push(node))},connect:function(nodeA,nodeB){if(void 0===this._nodeLinks[nodeA])throw new Error("nodeA has not been added");if(void 0===this._nodeLinks[nodeB])throw new Error("nodeB has not been added");this._nodeLinks[nodeA].push(nodeB),this._nodeLinks[nodeB].push(nodeA)},disconnect:function(nodeA,nodeB){if(void 0===this._nodeLinks[nodeA])throw new Error("nodeA has not been added");if(void 0===this._nodeLinks[nodeB])throw new Error("nodeB has not been added");this._nodeLinks[nodeA].splice(this._nodeLinks[nodeA].indexOf(nodeB),1),this._nodeLinks[nodeB].splice(this._nodeLinks[nodeB].indexOf(nodeA),1)},getConnectedNodesFor:function(node){if(void 0===this._nodeLinks[node])throw new Error("node has not been added");return this._nodeLinks[node]},getNodes:function(){return this._nodeIDs},remove:function(node){var connections=this._nodeLinks[node];if(void 0!==connections){for(var i=0,len=connections.length;i<len;i++){var neighbor=connections[i],nodeI=neighbor.indexOf(node);neighbor.splice(nodeI,1)}delete this._nodeLinks[node];var i=this._nodeIDs.indexOf(node);this._nodeIDs.splice(node,1)}}},module.exports=UndirectedGraph},{"./ArraySet":164}]},{},[40])(40)}));